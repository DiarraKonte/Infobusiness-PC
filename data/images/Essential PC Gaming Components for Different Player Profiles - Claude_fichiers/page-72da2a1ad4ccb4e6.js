(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9537],{76905:function(e,t,n){Promise.resolve().then(n.bind(n,57329))},57329:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var s=n(27573),a=n(28803),l=n(1133),i=n(81695),o=n(48894),r=n(47082),c=n(27218),u=n(98731);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let n=Math.ceil(t/2);return"".concat(e.substring(0,n),"\n\n  [...]\n\n  ").concat(e.substring(e.length-n))}var m=n(7653),v=n(40950),f=n(71817),p=n(57271),g=n(1812),h=n(88755),x=n(51375),_=n(7680),j=n(18701),y=n(40030),b=n(82915),C=n(19834),k=n(3053),S=n(67995),w=n(53392),N=n(70354),M=n(52939),U=n(22523),E=n(45790),z=n(30833),I=n(66829),A=n(65499);function O(e){let{isModalOpen:t,currentTool:n,currentToolInput:a,handleDeny:l,handleAllow:i,handleAlwaysAllow:o}=e,{isExpanded:r,setIsExpanded:c,snappyTransition:u}=(0,A.g)(!1);if(n)return(0,s.jsxs)(M.u_,{isOpen:t,onClose:()=>l(),autoCloseOnFocusOut:!1,modalSize:"lg",title:(0,s.jsx)(E.Z,{defaultMessage:"Claude would like to use an external integration",id:"UubrzH+Qzc"}),children:[(0,s.jsx)("div",{className:"mt-4"}),(0,s.jsx)(z.qd,{isStreaming:!1,isExpanded:r,setIsExpanded:c,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,s.jsx)(U.X2,{className:"!py-0",children:(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)(w._,{letter:n.serverName,size:40}),(0,s.jsxs)("div",{className:"flex flex-col py-1",children:[(0,s.jsx)("div",{className:"text-sm text-text-400 font-mono",children:n.name}),(0,s.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:n.serverName})]})]})}),className:"!h-auto",children:(0,s.jsx)(z.jE,{isExpanded:r,snappyTransition:u,isScrollable:!0,children:(0,s.jsx)(I.K,{input:a?JSON.parse(a):""})})}),(0,s.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,s.jsx)("p",{className:"font-medium",children:(0,s.jsx)(E.Z,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,s.jsx)("p",{children:(0,s.jsx)(E.Z,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,s.jsx)(M.dm,{className:"flex justify-between",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[o&&(0,s.jsx)(N.z,{onClick:o,children:(0,s.jsx)(E.Z,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,s.jsx)(N.z,{onClick:i,autoFocus:!0,children:(0,s.jsx)(E.Z,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,s.jsx)(N.z,{onClick:l,variant:"outline",children:(0,s.jsx)(E.Z,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function D(e){var t,n;let{conversation:l,conversationUUID:o,isLoadingHarmony:r,chatInputDefaultMessage:_}=e,{currentPath:j,data:y,isLoading:w,isPlaceholderData:N}=(0,a._C)(o,{suppressError:!0}),{changeDisplayedConversationPath:M}=(0,p.p)(),{onInvokeTool:U,isModalOpen:E,currentTool:z,currentToolInput:I,handleAllow:A,handleDeny:D,handleAlwaysAllow:Q}=function(e){let{conversationUUID:t}=e,{mcpTools:n,servers:s}=(0,x.cH)(),a=(0,C.Q)(),{track:l}=(0,k.z$)(),[i,o]=(0,m.useState)(!1),[r,c]=(0,m.useState)(null),[u,d]=(0,m.useState)(null),[v,f]=(0,m.useState)(null),[p,g]=(0,m.useState)(null),h=(0,x.YB)(),{toggleMcpToolAlwaysApproved:_}=(0,x.$Y)(),{getApprovalSetting:j}=(0,x.S9)(),{alwaysAllowEnabled:y}=j(null==r?void 0:r.serverName,r),b=(0,m.useRef)(h);(0,m.useEffect)(()=>{b.current=h},[h]);let w=(0,m.useCallback)(async(e,t,l,i,r)=>{var u,m;let v=n.find(e=>e.name===t),p=(null===(u=s.find(e=>{let{name:t}=e;return t===(null==v?void 0:v.serverName)}))||void 0===u?void 0:u.uuid)||"local";if(!v||!p)return a(e,t,l,i,r);let{approvalSetting:h}=j(v.serverName,v);if("never"===h)return a(e,t,l,i,r);if("dolphin"===t){let n=(m=(0,S.I)(i))&&"object"==typeof m?"actions"in m&&Array.isArray(m.actions)?m.actions.map(e=>({type:e.action,state:"pending",coordinate:"coordinate"in e?e.coordinate:void 0,start_coordinate:"start_coordinate"in e?e.start_coordinate:void 0,text:"text"in e?e.text:void 0,scroll_direction:"scroll_direction"in e?e.scroll_direction:void 0,scroll_amount:"scroll_amount"in e?e.scroll_amount:void 0,duration:"duration"in e?e.duration:void 0})):"action"in m?[{type:m.action,state:"pending",coordinate:"coordinate"in m?m.coordinate:void 0,start_coordinate:"start_coordinate"in m?m.start_coordinate:void 0,text:"text"in m?m.text:void 0,scroll_direction:"scroll_direction"in m?m.scroll_direction:void 0,scroll_amount:"scroll_amount"in m?m.scroll_amount:void 0,duration:"duration"in m?m.duration:void 0}]:[]:[];if(1===n.length&&"screenshot"===n[0].type)return a(e,t,l,i,r);if(n.length>0)return new Promise(e=>{d(p),c(v),f(l),g(i),e()})}return b.current.includes((0,x.PQ)(p,v))?a(e,t,l,i,r):new Promise(e=>{d(p),c(v),f(l),g(i),o(!0),e()})},[s,a,n,j]),N=(0,m.useCallback)(()=>{o(!1),r&&null!==v&&null!==p&&a(t,r.name,v,p)},[t,r,v,p,a]),M=(0,m.useCallback)(()=>{if(o(!1),r&&null!==v&&null!==p){var e;a(t,r.name,v,p,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),l({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!==(e=(0,S.I)(p))&&void 0!==e?e:{}).length})}},[t,r,v,p,a,l]),U=(0,m.useCallback)(()=>{y&&(r&&u&&_(u,r,!0),o(!1),r&&null!==v&&null!==p&&a(t,r.name,v,p))},[u,t,r,v,p,a,_,y]);return{onInvokeTool:w,isModalOpen:i,currentTool:r,currentToolInput:p,handleAllow:N,handleDeny:M,handleAlwaysAllow:y?U:void 0}}({conversationUUID:o}),T=(0,C.z)(null==y?void 0:y.settings,null==l?void 0:l.project_uuid),[Z,F]=(0,m.useState)(),K=(0,m.useCallback)(e=>{F(e)},[F]),P=(0,f.pV)(o,U,T),R=(0,f.lE)(o,U,T,Z),{mutate:B}=(0,a.jl)(o),H=P.isStreaming||R.isStreaming,L=P.runStream;!function(e,t){let[n,s]=(0,m.useState)(!1),{activeOrganization:l}=(0,c.t)(),i=(0,v.Z)(),o=e?e.uuid:"",{mutate:r}=(0,a.W)(o),{mutate:f,error:p}=(0,a.j7)(o),g=(0,m.useRef)(!1);(0,m.useEffect)(()=>{var t;if(!p||(null==e?void 0:e.name))return;let n=(null==e?void 0:null===(t=e.chat_messages)||void 0===t?void 0:t[0])?(0,u.K)(e.chat_messages[0]):"";if(n){if(g.current)return;let e=n.slice(0,30),t=n.length>30?"...":"";g.current=!0,r({name:"".concat(e).concat(t)})}},[p,e,r]),(0,m.useEffect)(()=>{if(t||n||(null==e?void 0:e.name))return;let a=null==e?void 0:e.chat_messages;if(!a||a.length<2||0===(0,u.K)(a[1]).length)return;let i=["Message 1:",d((0,u.K)(a[0])),"Message 2:",d((0,u.K)(a[1]))].join("\n\n");l&&(s(!0),f({message_content:i,recent_titles:[]}))},[t,n,e,l,f,i])}(y,H),function(e){let{conversationUUID:t,isStreaming:n}=e,[s,a]=(0,m.useState)(n),{mcpClients:l}=(0,x.cH)(),i=l.dolphin,o=(0,h.Q)(),r=!!i&&o;(0,m.useEffect)(()=>{r&&(!n&&s?(a(!1),i.notification({method:"notifications/progress",params:{progress:1,total:1,progressToken:"streaming"}})):!s&&n&&(i.notification({method:"notifications/progress",params:{progress:0,total:1,progressToken:"streaming"}}),a(!0)))},[t,r,n,s,i])}({conversationUUID:o,isStreaming:H});let Y=(0,m.useCallback)(async(e,t)=>{var n,s;await L({prompt:t,attachments:e.attachments,files:null!==(s=e.files_v2)&&void 0!==s?s:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:Z,compass_mode:null===(n=e.metadata)||void 0===n?void 0:n.compass_mode})},[L,Z]),q=(0,m.useCallback)((e,t)=>{M(o,e,t,e=>B({current_leaf_message_uuid:e}))},[M,o,B]);return y||w||N||(0,i.notFound)(),(0,s.jsxs)(g.I,{settings:(null==y?void 0:y.settings)||{},children:[(0,s.jsx)(b.J,{isStreaming:H,chatInputDefaultMessage:_,conversationTitle:l?"".concat(l.name," - Claude"):"Claude",conversationUUID:o,isLoading:w||!!r,messages:j,name:null!==(n=null!==(t=null==y?void 0:y.name)&&void 0!==t?t:null==l?void 0:l.name)&&void 0!==n?n:"Untitled Chat",onSend:P.runStream,onRetry:R.runStream,projectUuid:null==y?void 0:y.project_uuid,changeDisplayedConversationPath:q,editMessage:Y,setPersonalizedStyleCallback:K,onToolAllow:A}),(0,s.jsx)(O,{isModalOpen:E,currentTool:z,currentToolInput:I,handleDeny:D,handleAllow:A,handleAlwaysAllow:Q})]})}function Q(e){let{data:t}=(0,a._C)(e.conversationUUID,{suppressError:!0}),n=(null==t?void 0:t.project_uuid)||"",{userHasHarmony:l,projectHasHarmony:i}=(0,j.Y)(n),[o,r]=(0,m.useState)(!!(l&&i)),c=(0,m.useCallback)(()=>r(!1),[]);return(0,s.jsx)(y.C,{projectUuid:n,onLoad:c,children:(0,s.jsx)(_.r,{children:(0,s.jsx)(D,{...e,isLoadingHarmony:o})})})}function T(e){var t;let{params:{uuid:n}}=e,c=(0,i.useSearchParams)(),u=null==c?void 0:c.get("q"),{data:d}=(0,a._C)(n);return(0,l.ZQ)(null!==(t=null==d?void 0:d.name)&&void 0!==t?t:""),(0,s.jsx)(r.M,{conversationUUID:n,children:(0,s.jsx)(o.d,{conversationUUID:n,children:(0,s.jsx)(Q,{conversation:d,conversationUUID:n,chatInputDefaultMessage:null!=u?u:void 0})})})}}},function(e){e.O(0,[703,7277,9906,2044,7611,4408,5790,3279,6340,1270,7879,8183,6947,3840,6971,7265,1211,1121,3097,2821,9505,1006,9833,294,3290,7376,4055,1919,2906,4494,4620,4512,6952,6053,7023,5388,8576,7396,7218,1425,3858,3959,1817,1217,9285,8222,5728,4155,1385,6999,2839,8304,7908,204,1060,2915,1293,1362,4856,1744],function(){return e(e.s=76905)}),_N_E=e.O()}]);
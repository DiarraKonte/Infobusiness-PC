(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2915],{7160:function(e,t,s){"use strict";s.d(t,{Hd:function(){return x},Hn:function(){return h},Ky:function(){return f},L1:function(){return c},ZX:function(){return d},pf:function(){return m},rC:function(){return u}});var n=s(5362),a=s(27218),i=s(13262),l=s(87033),r=s(77930),o=s(7653);let c=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,{value:s}=(0,l.FL)("publish_artifacts"),r=(0,n.WE)("/api/organizations/".concat(t,"/published_artifacts"),{staleTime:0,queryKey:[i.sB,{orgUuid:t}],enabled:s}),c=(0,o.useMemo)(()=>{var e;return null===(e=r.data)||void 0===e?void 0:e.reduce((e,t)=>(e[t.message_uuid]||(e[t.message_uuid]=[]),e[t.message_uuid].push(t),e),{})},[r.data]);return{...r,publishedArtifactsByMessageUuid:c}},d=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,s=(0,r.useQueryClient)();return(0,n.uC)("/api/organizations/".concat(t,"/publish_artifact"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:[i.sB,{orgUuid:t}]})}})},u=e=>{let{activeOrganization:t}=(0,a.t)(),s=null==t?void 0:t.uuid,l=(0,r.useQueryClient)();return(0,n.uC)("/api/organizations/".concat(s,"/published_artifacts/").concat(e),"DELETE",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.sB,{orgUuid:s}]})},enabled:!!e})},m=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid;return(0,n.WE)("/api/organizations/".concat(t,"/artifact_feedback_eligibility"),{queryKey:[i.Wj],meta:{noToast:!0}})},f=e=>{let{activeOrganization:t}=(0,a.t)(),s=null==t?void 0:t.uuid,l=(0,r.useQueryClient)();return(0,n.uC)("/api/organizations/".concat(s,"/artifact-versions/").concat(e,"/visibility"),"POST",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.x5,{artifactVersionUuid:e,orgUuid:s}]})}})},x=e=>{let{activeOrganization:t}=(0,a.t)(),s=null==t?void 0:t.uuid,l=(0,r.useQueryClient)();return(0,n.uC)("/api/organizations/".concat(s,"/artifacts/").concat(e,"/byindex"),"POST",{onSuccess:e=>{l.invalidateQueries({queryKey:[i.x5,{artifactVersionUuid:e.artifactVersionUUID,orgUuid:s}]})}})},h=e=>{let{activeOrganization:t}=(0,a.t)(),s=null==t?void 0:t.uuid;return(0,n.WE)("/api/organizations/".concat(s,"/artifact-versions/").concat(e,"/visibility"),{queryKey:[i.x5,{artifactVersionUuid:e,orgUuid:s}],enabled:!!e,meta:{noToast:!0}})}},84927:function(e,t,s){"use strict";s.d(t,{H:function(){return i}});var n=s(27573),a=s(45790);function i(e){let t,{project:s,className:i}=e;if(s.is_starter_project)t=(0,n.jsx)(a.Z,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var l;t=(null===(l=s.creator)||void 0===l?void 0:l.full_name)?(0,n.jsx)(a.Z,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,n.jsx)(a.Z,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,n.jsx)("span",{className:i,children:t})}},80700:function(e,t,s){"use strict";s.d(t,{$:function(){return c}});var n=s(27573),a=s(70354),i=s(32737),l=s(85069),r=s(88755),o=s(40950);function c(e){let{children:t,disabledReason:s,...c}=e,d=(0,r.Q)(l.t6),u=(0,o.Z)(),m={defaultMessage:t.props.defaultMessage,id:t.props.id};if(!d)return(0,n.jsx)(i.u,{tooltipContent:s,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(a.z,{...c,children:t})})});let f=u.formatMessage(m);return(0,n.jsx)(i.u,{tooltipContent:null!=s?s:f,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(a.z,{...c,size:"icon_sm"})})})}},45014:function(e,t,s){"use strict";s.d(t,{K0:function(){return eg},$G:function(){return ej}});var n=s(41596),a=s(27573),i=s(19170),l=s(34555),r=s(1146),o=s(3053),c=s(8571),d=s(27218),u=s(27895),m=s(5984),f=s(9788),x=s(70354),h=s(45033),g=s(96346),p=s(49002),v=s(10607),j=s(7653);function y(){let e=(0,n._)(["\n  z-dropdown\n  bg-bg-100\n  border-0.5\n  border-border-300\n  backdrop-blur-xl\n  rounded-lg\n  min-w-[8rem]\n  overflow-hidden\n  p-1\n  text-text-200\n  shadow-element\n"]);return y=function(){return e},e}function b(e){var t;let{children:s,open:n,defaultButtonLabel:i,onClickDefaultButton:l,onOpenChange:r,...o}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(p.fC,{open:n,onOpenChange:r,children:[(0,a.jsxs)("div",{className:"flex border border-border-300 font-medium rounded-lg overflow-hidden",children:[(0,a.jsx)("button",{className:(0,v.Z)("py-1 px-2 border-r border-border-300 hover:bg-bg-200",n&&"bg-bg-200"),onClick:l,children:i}),(0,a.jsx)(p.xz,{asChild:!0,children:(0,a.jsx)("button",{className:"py-1 px-1 hover:bg-bg-200",children:(0,a.jsx)(g.p,{size:16})})})]}),(0,a.jsx)(p.Uv,{children:(0,a.jsx)(w,{sideOffset:null!==(t=o.sideOffset)&&void 0!==t?t:4,...o,children:s})})]})})}let w=(0,f.q)(p.VY)(y());var _=s(11607),N=s(52939),C=s(32737),k=s(17582),M=s(82083),S=s(85069),E=s(87033),z=s(88755),Z=s(74133),F=s(39405),I=s(85689),T=s(7778),R=s(23525),A=s(86518),O=s(80151),D=s(62168),L=s(10794),U=s(90245),P=s(49454),B=s(13037),H=s(58183),J=s(8927),W=s(68425),q=s(29860),G=s.n(q),K=s(88146),Y=s(45790),V=s(40950),X=s(77879),Q=s(7160),$=s(95899),ee=s(32559),et=s(47082),es=s(70278),en=s(65683),ea=s(89827),ei=s(43490);function el(){let e=(0,n._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return el=function(){return e},e}function er(e){let t,{onClose:s,onSubmitRating:n,onSubmitNotes:i}=e,l=(0,V.Z)(),[r,o]=(0,j.useState)(!1),[c,d]=(0,j.useState)(""),u=e=>{n(e),o(!0)},f=()=>{s()};return t=r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("div",{className:"ml-1",children:(0,a.jsx)(Y.Z,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,a.jsx)("div",{className:"pt-1",children:(0,a.jsx)("button",{onClick:f,children:(0,a.jsx)(en.X,{size:20})})})]}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(c),f()},children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"grow",children:(0,a.jsx)(m.oi,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:c,onChange:e=>d(e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)(x.z,{variant:"primary",type:"submit",children:(0,a.jsx)(Y.Z,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(Y.Z,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,a.jsx)(ea.V,{size:20})}),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,a.jsx)(ei.L,{size:20})}),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:f,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,a.jsx)(en.X,{size:20})})]})]}),(0,a.jsxs)(eo,{children:[(0,a.jsx)("div",{className:"p-3",children:t}),(0,a.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,a.jsx)("a",{className:"hover:underline",href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,a.jsx)(Y.Z,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let eo=f.q.div(el());var ec=s(98555),ed=s(56685);let eu=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:n}=e,i=(0,j.useCallback)(()=>{n(!1)},[n]),{chatResourceState:{artifacts:l},dispatchChatResource:r}=(0,et.Y)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),c=(0,j.useRef)(t),d=(0,j.useRef)(!1),u=e=>{d.current=!0,i();let t=o[e];c.current=t,m(t)},m=(0,j.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUUID:e.versions[e.versions.length-1].uuid})})},[r]);(0,j.useEffect)(()=>{let e=c.current;return()=>{e&&!d.current&&(null==t?void 0:t.id)!==e.id&&m(e),d.current=!1}},[]);let f=(0,ec.i)(),h=(0,V.Z)();return o.length<2?null:(0,a.jsxs)(p.fC,{open:s,onOpenChange:e=>n(e),children:[(0,a.jsx)(p.xz,{asChild:!0,children:(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,a.jsx)(C.u,{side:"right",className:"ml-2",tooltipContent:s?"":h.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,a.jsx)(ed.b,{size:20})})})}),(0,a.jsx)(p.VY,{align:"start",asChild:!0,style:{maxHeight:"var(--radix-dropdown-menu-content-available-height)"},children:(0,a.jsx)("ul",{className:"flex flex-col gap-1 relative z-30 py-2 pr-3 overflow-y-auto",onMouseLeave:()=>c.current&&m(c.current),children:o.map((e,t)=>{var s;let n=e.type?f[e.type]:null,i=(null===(s=c.current)||void 0===s?void 0:s.id)===e.id,l=h.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),r=e.versions.length>1?"".concat(e.versions.length):"",o=e.versions.length>1&&n?" \xb7 ":"";return(0,a.jsx)(W.E.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,a.jsxs)(p.ck,{className:(0,v.Z)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",i?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>u(t),onMouseEnter:()=>{m(e)},"aria-label":"".concat(e.title).concat(n?", ".concat(n):"").concat(r?", ".concat(r," ").concat(l):""),children:[(0,a.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,a.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,a.jsxs)(a.Fragment,{children:[r," ",l]}):null,o?(0,a.jsx)(a.Fragment,{children:o}):null,n]})]},e.id)},e.id)})})})]})};async function em(e){if(e.type!==M.JP.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return new Promise((s,n)=>{try{var a;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null===(a=l.contentWindow)||void 0===a?void 0:a.document);if(!r){document.body.removeChild(l),n(Error("Could not access iframe document"));return}let o=(null==e?void 0:e.title)||"Artifact";r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(o,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                * Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(t.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let c=document.title,d=()=>{try{document.title=c,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var t;document.title="".concat((null==e?void 0:e.title)||"Markdown Artifact"),null===(t=l.contentWindow)||void 0===t||t.print(),setTimeout(()=>{d(),s()},100)}catch(e){d(),n(e)}},l.onerror=e=>{d(),n(e)}}catch(e){n(e)}})}let ef=(e,t)=>{let[s,n]=(0,j.useState)(""),[a,i]=(0,j.useState)("");return(0,j.useEffect)(()=>{var s;let a=null!==(s=e.versions[t].resultState)&&void 0!==s?s:"",l=(0,M.VA)(e),r=new Blob([a],{type:"text/plain"}),o=URL.createObjectURL(r);return n(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:a}};function ex(){let e=(0,n._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return ex=function(){return e},e}function eh(){let e=(0,n._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return eh=function(){return e},e}let eg=e=>{var t,s,n,c,u,m,f,x,h,g;let{onClose:p,artifact:y,isStreaming:b,selectedArtifactMessageUUID:w,selectedArtifactVersionUUID:_,setSelectedArtifactVersionUUID:N,projectUuid:C,selectDoc:k,disablePublishing:S,sendMessage:z,richSandboxCapabilities:Z,isOpen:F}=e,{account:I}=(0,d.t)(),T=(0,o.z$)(),[R,A]=(0,j.useState)("normal"),O=(0,j.useRef)(null),D=(0,d.Cf)(),[L,U]=(0,j.useState)(!0),{value:P}=(0,E.FL)("publish_artifacts"),{data:B}=(0,ee.Yc)(C),H=!S&&P&&!D,{value:q,setTrue:G,setFalse:K}=(0,X.kt)(!1),Y=(0,j.useCallback)(()=>{U(!1)},[]),{data:V}=(0,Q.L1)(),$=b&&!(null==y?void 0:null===(t=y.versions[y.versions.length-1])||void 0===t?void 0:t.isClosed),es=(0,j.useMemo)(()=>{if(!y)return 0;if(!$&&_&&w!==r.FC){let e=y.versions.findIndex(e=>e.uuid===_);if(-1!==e)return e}return!$&&w&&w!==r.FC?y.versions.findIndex(e=>e.message===w):y.versions.length-1},[w,_,$,y]),{value:en}=(0,E.FL)("apps_artifacts_sh"),ea=null==y?void 0:null===(s=y.versions[es])||void 0===s?void 0:s.uuid;(0,j.useEffect)(()=>{ea&&ea!==_&&N(ea),A("normal")},[null==y?void 0:y.id,ea,N,_]);let ei=en&&D,{value:el,setTrue:eo,setFalse:ec}=(0,X.kt)(!1),ed=y&&(null==V?void 0:null===(n=V.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===y.id&&s===y.versions[es].message}))||void 0===n?void 0:n.published_artifact_uuid),eu=null!==(f=null==V?void 0:V.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ed&&s}))&&void 0!==f&&f,em=null==y?void 0:null===(c=y.versions[es])||void 0===c?void 0:c.message,[ef,ex]=(0,j.useState)(!1);(0,j.useEffect)(()=>ex(ef||b),[ef,b]);let[eh,eg]=(0,j.useState)(!1);(0,j.useEffect)(()=>eg(!1),[w,em]);let[ev,ej]=(0,j.useState)(!1),{data:ew}=(0,Q.pf)(),{mutate:e_}=(0,i.Ck)(),{track:eN}=(0,o.z$)(),eC=null!==(x=(0,et.Y)().chatResourceState.conversationUUID)&&void 0!==x?x:"",{mutateAsync:ek}=(0,Q.Hd)(eC),eM=(0,j.useCallback)(async()=>{if(!_)try{var e;let{artifactVersionUUID:t}=await ek({version_index:es,artifact_identifier:null!==(e=null==y?void 0:y.id)&&void 0!==e?e:""});N(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}eN({event_key:"artifact.share_button_clicked",message_uuid:em,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),eo()},[_,eo,ek,es,null==y?void 0:y.id,N,eN,em,null==y?void 0:y.type,null==y?void 0:y.language]),eS=(0,j.useCallback)(()=>{eN({event_key:"artifact.publish_button_clicked",message_uuid:em,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),G()},[G,eN,em,null==y?void 0:y.type,null==y?void 0:y.language]),eE=(null==y?void 0:y.type)===M.JP.Text,ez=(null==y?void 0:y.type)===M.JP.Markdown||(null==y?void 0:y.type)===M.JP.Code,eZ=(null==y?void 0:y.type)===M.JP.Html||(null==y?void 0:y.type)===M.JP.React,eF=(null==y?void 0:y.type)!==M.JP.Text&&!($&&((null==y?void 0:y.type)===M.JP.Svg||(null==y?void 0:y.type)===M.JP.Mermaid||(null==y?void 0:y.type)===M.JP.React||(null==y?void 0:y.type)===M.JP.Html)),eI=!eF||"raw"===R,eT=eh||ef&&!b&&!ev&&!(null==I?void 0:I.settings.dismissed_artifact_feedback_form)&&ew,eR=null!==(h=null==y?void 0:y.versions.length)&&void 0!==h?h:0,[eA,eO]=(0,j.useState)(!1),eD=C&&y?{show:!$&&!(null==B?void 0:B.is_starter_project),artifact:y,projectUuid:C,selectedVersion:es,selectDoc:k}:void 0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,v.Z)(y?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eA&&eO(!1),children:[(0,a.jsx)(ep,{versionCount:eR,selectedVersion:es,artifact:y,canRenderNormal:eF,canOnlyRenderRaw:eE,canOnlyRenderNormal:ez,viewing:R,setViewing:A,showRaw:eI,canRefresh:eZ,isSandboxLoading:L,handleRefresh:()=>{U(!0),O.current&&O.current.refresh()},canShare:ei,handleOpenShareModal:eM,isStreaming:b,onClose:p,hasMenuOpen:eA,setHasMenuOpen:eO,canPublish:H,wasUnpublished:eu,publishedArtifactUuid:ed,openPublishModal:eS,projectParams:eD,richSandboxRef:O,handleVersionSelect:e=>{let t=null==y?void 0:y.versions[e].uuid;t&&N(t)}}),(0,a.jsx)(l.B8,{isOpen:F,content:null!==(g=null==y?void 0:null===(u=y.versions[es])||void 0===u?void 0:u.resultState)&&void 0!==g?g:"",type:null==y?void 0:y.type,citations:null==y?void 0:null===(m=y.versions[es])||void 0===m?void 0:m.citations,language:void 0===y?void 0:y.language||M.yc[y.type].syntaxName,showRaw:eI,richSandboxRef:O,isCurrentStreaming:$,isChatStreaming:b,onSandboxConfirmation:Y,sendMessage:z,richSandboxCapabilities:Z,isLatestVersion:!!y&&es===y.versions.length-1,artifactId:null==y?void 0:y.id,artifactVersion:es,onArtifactRuntimeError:e=>{T.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==_?void 0:_.toString(),error_type:e.type,source:null==y?void 0:y.versions[es].source})},artifact:y,hasMenuOpen:eA}),(0,a.jsx)(J.M,{children:eT&&(0,a.jsx)(W.E.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,a.jsx)("div",{children:(0,a.jsx)(er,{onSubmitNotes:e=>{eN({event_key:"artifact.feedback.note",note:e,message_uuid:em,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),eg(!1)},onSubmitRating:e=>{eN({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:em,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),e_({...null==I?void 0:I.settings,dismissed_artifact_feedback_form:!0}),eg(!0)},onClose:()=>{ej(!0),e_({...null==I?void 0:I.settings,dismissed_artifact_feedback_form:!0}),eg(!1)}})})})})]}),(null==y?void 0:y.versions[es])&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb,{messageUuid:y.versions[es].message,isOpen:q&&!eu,onClose:K,artifact:y,selectedVersion:es,publishedArtifactUuid:ed}),ei&&_&&(0,a.jsx)(ey,{isOpen:el,onClose:ec,artifactVersionUuid:_,artifact:y,messageUuid:y.versions[es].message,isProjectArtifact:!!(null==B?void 0:B.is_private)})]})]})};function ep(e){var t;let{versionCount:s,selectedVersion:n,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:c,setViewing:d,showRaw:f,canRefresh:p,isSandboxLoading:y,handleRefresh:w,canShare:N,handleOpenShareModal:E,isStreaming:D,canPublish:L,wasUnpublished:U,publishedArtifactUuid:P,projectParams:B,onClose:J,openPublishModal:W,handleVersionSelect:q,hasMenuOpen:K,setHasMenuOpen:X,richSandboxRef:Q}=e,ee=(0,V.Z)(),et=(0,z.Q)(S.t6),{copyToClipboard:en,didCopy:ea}=(0,k.m)(),{client:ei}=(0,H.useStatsigClient)(),{copyToProject:el,isCopiedToProject:er}=function(e){let{projectUuid:t,artifact:s,selectedVersion:n}=e,[i,l]=(0,j.useState)(!1),{mutateAsync:r,data:o}=(0,$.u3)(null!=t?t:""),{addError:c}=(0,u.e)();return(0,j.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(M.yc[s.type].extension()),content:null!==(e=s.versions[n].resultState)&&void 0!==e?e:""})}catch(e){c((0,a.jsx)(Y.Z,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}))}},isCopiedToProject:i}}({artifact:i,projectUuid:null!==(t=null==B?void 0:B.projectUuid)&&void 0!==t?t:"",selectedVersion:n});async function eo(){var e,t;if(!i)return;let s=i.type===M.JP.Markdown,a=i.type===M.JP.React,l=null!==(e=i.versions[n].resultState)&&void 0!==e?e:"";if(a&&Q.current){let e=await (null===(t=Q.current)||void 0===t?void 0:t.copyHtmlContent());e?await en({text:e,html:e}):await en(l)}else if(s)try{let e=(0,es.c)(l);await en({text:l,html:e})}catch(e){await en(l)}else await en(l)}let{ref:ec,width:ed}=function(){let e=(0,j.useRef)(null),[t,s]=(0,j.useState)(()=>{var t,s;return null!==(s=null===(t=e.current)||void 0===t?void 0:t.offsetWidth)&&void 0!==s?s:null});return(0,j.useEffect)(()=>{let t=G()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),n=new ResizeObserver(t);if(e.current){let s=e.current;return t(),n.observe(s),()=>n.disconnect()}},[]),{ref:e,width:t}}(),ef=ed&&ed<480,ex=!f&&p,{addError:eh}=(0,u.e)(),eg=(null==i?void 0:i.type)===M.JP.Markdown&&"raw"!==c?(0,a.jsx)(h.hP,{onSelect:async()=>{try{await em(i)}catch(e){eh((0,a.jsx)(Y.Z,{defaultMessage:"Error saving as PDF",id:"kemaiSh7+2"}))}},children:(0,a.jsx)(Y.Z,{defaultMessage:"Save as PDF",id:"rv9NrWszM1"})},"saveAsPdf"):null,ep=i?(0,a.jsx)(h.hP,{asChild:!0,"data-testid":"export-download",children:(0,a.jsx)(ev,{artifact:i,selectedVersion:n})},"download"):null;return(0,a.jsxs)("div",{ref:ec,className:(0,v.Z)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",et?[S.eM,S.Gg,"draggable"]:"py-2"),children:[i&&(0,a.jsx)(eu,{currentArtifact:i,hasMenuOpen:K,setHasMenuOpen:X}),K?(0,a.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,a.jsx)(Y.Z,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!f&&ex&&y?(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,a.jsx)(_.Loading,{size:"sm"})}):null]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center flex-1 gap-2",children:[!(!l||r||o)&&(0,a.jsx)(m.sY,{options:[{key:"normal",label:(0,a.jsx)(R.b,{size:16}),ariaLabel:ee.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,a.jsx)(A.E,{size:16}),ariaLabel:ee.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===c?"normal":"code",onSelect:e=>{d("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===c?"normal":"code"),s>1?(0,a.jsx)(h.Lt,{align:"start",trigger:(0,a.jsxs)(x.z,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",n+1,ef||n!==s-1?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"∙"}),(0,a.jsx)(Y.Z,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,a.jsx)(g.p,{size:12,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),className:"max-h-[calc(100vh-104px)] overflow-y-auto",children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,a.jsxs)(h.hP,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>q(e-1),children:[(0,a.jsx)(Y.Z,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,a.jsxs)(a.Fragment,{children:[" - ",(0,a.jsx)(Y.Z,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===n?(0,a.jsx)(I.J,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,a.jsxs)("div",{className:(0,v.Z)("flex gap-2 items-center text-sm"),children:[ef?(0,a.jsxs)(h.Lt,{align:"end",trigger:(0,a.jsx)(x.z,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger",children:(0,a.jsx)(T.F,{size:18,weight:"bold"})}),children:[ex&&(0,a.jsx)(h.hP,{disabled:y,onSelect:w,children:(0,a.jsx)(Y.Z,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),(0,a.jsx)(h.hP,{onSelect:eo,children:(0,a.jsx)(Y.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),N?(0,a.jsx)(h.hP,{onSelect:E,children:(0,a.jsx)(Y.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,U?(0,a.jsx)(h.hP,{disabled:!0,onSelect:W,children:(0,a.jsx)(Y.Z,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):L?(0,a.jsx)(h.hP,{onSelect:W,children:(0,a.jsx)(Y.Z,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,ep,eg]}):(()=>{let e=ei.getExperiment("move_publish_button").get("move_button",!1),t=!f&&ex&&(y?(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,a.jsx)(_.Loading,{size:"sm"})}):(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:w,children:(0,a.jsx)(Z._,{size:18})})),s=N&&(0,a.jsx)(x.z,{onClick:E,variant:e?"primary":"ghost",size:"sm",disabled:D,prepend:(0,a.jsx)(F.D,{size:18,weight:"light"}),className:(0,v.Z)("font-medium !text-sm",!e&&"!text-text-100"),children:(0,a.jsx)(Y.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),n=L&&(0,a.jsx)(C.u,{open:!!U&&void 0,tooltipContent:(0,a.jsx)(Y.Z,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,a.jsx)(x.z,{onClick:W,variant:e?"primary":"ghost",size:"sm",disabled:U||D,prepend:(0,a.jsx)(F.D,{size:16}),className:(0,v.Z)("font-medium !text-sm",!e&&"!text-text-100",U&&"!pointer-events-auto"),children:void 0===P||U?(0,a.jsx)(Y.Z,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,a.jsx)(Y.Z,{defaultMessage:"Published",id:"w7tf2zwi6+"})})}),i=(0,a.jsxs)(b,{align:"end",defaultButtonLabel:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:(0,v.Z)(ea?"invisible":""),children:(0,a.jsx)(Y.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),ea?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(I.J,{size:18})}):null]}),onClickDefaultButton:eo,children:[(null==B?void 0:B.show)?er?(0,a.jsx)(h.hP,{disabled:!0,children:(0,a.jsx)(Y.Z,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,a.jsx)(h.hP,{onSelect:el,children:(0,a.jsx)(Y.Z,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,ep,eg]});return e?(0,a.jsxs)(a.Fragment,{children:[t,i,s,n]}):(0,a.jsxs)(a.Fragment,{children:[t,s,n,i]})})(),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:J,children:(0,a.jsx)(O.X,{size:18})})]})]})]})}function ev(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:n,filename:i}=ef(t,s),l=function(e){switch(e.type){case M.JP.Markdown:return"Markdown";case M.JP.Html:return"HTML";case M.JP.React:return"TSX";case M.JP.Svg:return"SVG";case M.JP.Text:return"TXT";case M.JP.Mermaid:return"Mermaid";case M.JP.Code:var t;return null!==(t=M.yc[e.type].extension(e))&&void 0!==t?t:null;default:return null}}(t);return(0,a.jsx)("a",{href:n,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000",children:l?(0,a.jsx)(Y.Z,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,a.jsx)(Y.Z,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}let ej=f.q.div(ex());f.q.div(eh());let ey=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:n,artifact:i,messageUuid:l,isProjectArtifact:r}=e,c=(0,V.Z)(),{track:d}=(0,o.z$)(),{mutateAsync:u,isPending:m}=(0,Q.Ky)(n),{data:f,isLoading:h}=(0,Q.Hn)(n),g=(null==f?void 0:f.visibility)==="shared",p=m||h,[v,y]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>y(""),5e3);return()=>clearTimeout(e)},[v]);let b="".concat(window.location.origin,"/artifacts/").concat(n),{copyToClipboard:w,didCopy:_}=(0,k.m)(),C=p?"loading":g?"shared":"private",M=(0,j.useRef)(C);M.current!==C&&("loading"!==M.current&&"private"===C&&y(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),M.current=C);let S=e=>{"private"===e&&g&&u({visibility:"private"}).then(()=>t()),"shared"!==e||g||u({visibility:"shared"}).then(()=>w(b))};return(0,a.jsx)(N.u_,{title:(0,a.jsx)("span",{className:"text-text-200 font-tiempos text-xl font-medium",children:g?(0,a.jsx)(Y.Z,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,a.jsx)(Y.Z,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:s,onClose:t,modalSize:"lg",hasCloseButton:!0,children:(0,a.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(U.T,{className:"mt-1",size:18})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Y.Z,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,a.jsx)("p",{className:"text-text-300 tracking-tight",children:r?(0,a.jsx)(Y.Z,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,a.jsx)(Y.Z,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(K.default,{className:"text-text-300 truncate text-sm",href:b,children:b}),(0,a.jsx)(x.z,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{w(b)},prepend:_?(0,a.jsx)(D.f,{size:16}):(0,a.jsx)(L.r,{size:16}),children:_?(0,a.jsx)(Y.Z,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(Y.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)(x.z,{size:"lg",variant:"secondary",loading:p,onClick:()=>S("private"),children:(0,a.jsx)(Y.Z,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}),!g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:r?(0,a.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,a.jsx)(P.k,{size:18,className:"mt-0.5 shrink-0"}),(0,a.jsx)(Y.Z,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,a.jsx)("p",{children:(0,a.jsx)(Y.Z,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,a.jsx)(B.H,{className:"mt-0.5",size:18}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Y.Z,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,a.jsx)("p",{className:"text-text tracking-tight-300",children:(0,a.jsx)(Y.Z,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(x.z,{size:"lg",loading:p,onClick:()=>{S("shared"),d({event_key:"artifact.share.modal.share_button_clicked",message_uuid:l,artifact_type:i.type,artifact_language:i.language})},children:(0,a.jsx)(Y.Z,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})]})})},eb=e=>{let{onClose:t,isOpen:s,artifact:n,selectedVersion:i,messageUuid:l,publishedArtifactUuid:r}=e,d=(0,V.Z)(),{track:u}=(0,o.z$)(),{mutateAsync:m,isPending:f}=(0,Q.ZX)(),{publishedArtifactsBaseUrl:h}=(0,c.m)(),g=!!r,{mutateAsync:p,isPending:v}=(0,Q.rC)(r),y=f||v,[b,w]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===b)return;let e=setTimeout(()=>w(""),5e3);return()=>clearTimeout(e)},[b]);let _="".concat(h,"/public/artifacts/").concat(r),{copyToClipboard:C,didCopy:M}=(0,k.m)(),S=y?"loading":g?"shared":"private",E=(0,j.useRef)(S);E.current!==S&&("loading"!==E.current&&"private"===S&&w(d.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),E.current=S);let z=e=>{if("private"===e&&g&&p({}).then(()=>t()),"shared"===e&&!g){var s;m({title:n.title,artifact_type:n.type,code_language:n.language,message_uuid:l,artifact_identifier:n.id,content:null!==(s=n.versions[i].resultState)&&void 0!==s?s:""}).then(e=>{let{published_artifact_uuid:t}=e;return C("".concat(h,"/public/artifacts/").concat(t))})}};return(0,a.jsx)(N.u_,{title:(0,a.jsx)("span",{className:"text-text-200 font-tiempos text-xl font-medium",children:g?(0,a.jsx)(Y.Z,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}):(0,a.jsx)(Y.Z,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),isOpen:s,onClose:t,modalSize:"lg",hasCloseButton:!0,children:(0,a.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(U.T,{className:"mt-1",size:18})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Y.Z,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,a.jsx)("p",{className:"text-text-300 tracking-tight",children:(0,a.jsx)(Y.Z,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(K.default,{className:"text-text-300 truncate text-sm",href:_,children:_}),(0,a.jsx)(x.z,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{C(_)},prepend:M?(0,a.jsx)(D.f,{size:16}):(0,a.jsx)(L.r,{size:16}),children:M?(0,a.jsx)(Y.Z,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(Y.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(x.z,{size:"lg",variant:"secondary",loading:y,onClick:()=>z("private"),children:(0,a.jsx)(Y.Z,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,a.jsxs)("p",{className:"text-text-400 text-xs tracking-tight",children:[(0,a.jsx)(Y.Z,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,a.jsx)("br",{}),(0,a.jsx)(Y.Z,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]}),!g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:[(0,a.jsx)("p",{children:(0,a.jsx)(Y.Z,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet. Your chat will remain private.",id:"OMUnb5GMFX"})}),(0,a.jsx)("p",{children:(0,a.jsx)(Y.Z,{defaultMessage:"Be sure the Artifact you’re publishing doesn’t include any personal or confidential information.",id:"yw0cqcvv5N"})})]}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,a.jsx)(B.H,{className:"mt-0.5",size:18}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Y.Z,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})}),(0,a.jsx)("p",{className:"text-text tracking-tight-300",children:(0,a.jsx)(Y.Z,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,a.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,a.jsx)(P.k,{size:18,className:"mt-0.5 shrink-0"}),(0,a.jsx)("span",{children:(0,a.jsx)(Y.Z,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content.",id:"smjnmsNRKL",values:{link:e=>(0,a.jsx)(K.default,{href:"https://www.anthropic.com/legal/aup",target:"_blank",className:"underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(x.z,{size:"lg",loading:y,onClick:()=>{z("shared"),u({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:l,artifact_type:null==n?void 0:n.type,artifact_language:null==n?void 0:n.language})},children:(0,a.jsx)(Y.Z,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})]})})}},74550:function(e,t,s){"use strict";s.d(t,{c:function(){return d}});var n=s(27573),a=s(82274),i=s(2130),l=s(70354),r=s(47666),o=s(80151),c=s(7653);let d=e=>{let{attachment:t,goBack:s,onClose:d}=e,u=(0,c.useMemo)(()=>(0,i.G)(t),[t]);return(0,n.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,n.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,n.jsx)(l.z,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,n.jsx)(r.X,{size:20})}),(0,n.jsx)("h2",{className:"font-styrene-display flex-1 truncate text-lg font-medium",children:u.title}),(0,n.jsx)(l.z,{variant:"ghost",size:"icon",className:"-mr-2",onClick:d,"data-testid":"close-file-preview",children:(0,n.jsx)(o.X,{size:20})})]}),(0,n.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,n.jsx)(a.R,{metaData:u.metaData}),(0,n.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},5492:function(e,t,s){"use strict";s.d(t,{g:function(){return X}});var n=s(27573),a=s(39527),i=s(80727),l=s(10607),r=s(7653),o=s(77879),c=s(80204),d=s(28803),u=s(70354),m=s(85069),f=s(88755),x=s(38459),h=s(88146),g=s(45790),p=s(89469),v=s(37607),j=s(3053),y=s(32737),b=s(78636),w=s(39405),_=s(40950),N=s(80700),C=s(47082),k=s(48894),M=s(79285),S=s(27218),E=s(27895),z=s(45033),Z=s(11607),F=s(52939),I=s(17582),T=s(16963),R=s(11510),A=s(62168),O=s(10794),D=s(425),L=s(7533),U=s(22027),P=s(40845),B=s(11852),H=s(32559);function J(e){let{conversationUUID:t,snapshot:s,closeShareModal:a,showShareModal:i,disabled:l,disabledReason:o}=e,c=(0,_.Z)(),m=!!s,{addError:f}=(0,E.e)(),{account:x,activeOrganization:h}=(0,S.t)(),p=(0,S.Cf)(),v=(0,d.cE)(t),y=null==v?void 0:v.project_uuid,{data:b}=(0,H.Yc)(y),w=(null==s?void 0:s.uuid)?W(s.uuid):"",{copyToClipboard:N,didCopy:C}=(0,I.m)(),{mutateAsync:k,isPending:z}=(0,d.PD)(t),{mutate:D,isPending:L}=(0,d.Ls)(t,null==s?void 0:s.uuid),U=(0,r.useCallback)(async()=>{try{await k({project_uuid:null==v?void 0:v.project_uuid})}catch(e){f(c.formatMessage({defaultMessage:"Something went wrong while sharing this conversation. Please refresh the page.",id:"bMqfGRVujK"}))}},[k,f,null==v?void 0:v.project_uuid,c]),{track:P}=(0,j.z$)(),B=(0,r.useCallback)(()=>{m?(P({event_key:"chat.share.modal.unshare_button.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),D()):(P({event_key:"chat.share.modal.share_button.clicked",conversation_uuid:t}),U())},[m,D,U,P,t,null==s?void 0:s.uuid]);return(0,n.jsx)(F.u_,{title:(0,n.jsx)("div",{className:"text-text-200 font-copernicus text-xl font-medium tracking-tight",children:m?c.formatMessage({defaultMessage:"Chat shared",id:"svB/EMJSZy"}):c.formatMessage({defaultMessage:"Share chat",id:"bXa+lJhlYV"})}),isOpen:i,onClose:a,modalSize:"lg",hasCloseButton:!0,children:x?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("div",{children:(0,n.jsx)(K,{upToDate:null==s?void 0:s.up_to_date,upsertSnapshot:U,isShared:!!m,disabled:l,disabledReason:o,isRaven:p})}),(0,n.jsx)(q,{isShared:m,project:b,orgName:null==h?void 0:h.name,toggleShare:B,isRaven:p}),m&&(0,n.jsxs)("button",{className:"w-full flex items-center justify-between bg-inherit h-auto text-text-300 border border-border-300 rounded-md px-3 py-2 cursor-pointer hover:bg-bg-300/50",onClick:()=>{P({event_key:"chat.share.open_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),window.open(W((null==s?void 0:s.uuid)||""),"_blank")},children:[(0,n.jsx)("span",{className:"truncate",children:W((null==s?void 0:s.uuid)||"")}),(0,n.jsx)(T.G,{size:16})]}),!p&&(0,n.jsxs)("div",{className:"flex flex-row gap-1.5 rounded-lg bg-bg-400 p-2 text-text-300 text-xs",children:[(0,n.jsx)(R.k,{size:16,className:"shrink-0"}),(0,n.jsx)("div",{children:(0,n.jsx)(g.Z,{defaultMessage:"Don’t share personal information or third-party content without permission, and see our <usagePolicyLink>Usage Policy</usagePolicyLink>.",id:"RkAGrm1doc",values:{usagePolicyLink:e=>(0,n.jsx)(M.LegalLink,{type:"aup",className:"hover:text-text-100 underline",children:e})}})})]}),(0,n.jsx)("div",{className:"mt-2 flex w-full items-center gap-2",children:m?(0,n.jsx)(u.z,{size:"lg",variant:C?"outline":"primary",onClick:()=>{P({event_key:"chat.share.copy_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),N(w)},prepend:C?(0,n.jsx)(A.f,{size:16}):(0,n.jsx)(O.r,{size:16}),children:C?(0,n.jsx)(g.Z,{defaultMessage:"Copied",id:"p556q3uvbn"}):(0,n.jsx)(g.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}):(0,n.jsx)(u.z,{size:"lg",loading:z||L,onClick:B,children:(0,n.jsx)(g.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})]}):(0,n.jsx)("div",{className:"mb-4 mt-8 flex h-full w-full items-center justify-center",children:(0,n.jsx)(Z.Loading,{})})})}let W=e=>new URL("/share/".concat(e),window.location.origin).toString();function q(e){let{isShared:t,orgName:s,project:a,toggleShare:i,isRaven:r}=e,o=(0,n.jsxs)("button",{className:(0,l.Z)("border-border-300 relative flex flex-row items-center justify-between gap-2 w-full rounded-xl border text-left !py-2 !px-3",t?"!bg-bg-000 text-text-000 cursor-pointer":"text-text-300 cursor-default"),children:[(0,n.jsx)(G,{state:t?"shared":"private",orgName:s,project:a,isRaven:r}),t&&(0,n.jsx)(x.p,{size:14,className:"right-3.5 top-3.5 text-text-000"})]});return t?(0,n.jsxs)(z.Lt,{align:"start",trigger:o,children:[(0,n.jsx)(z.hP,{onSelect:i,className:"!gap-0",children:(0,n.jsx)(G,{state:"private",isCurrentState:!t,orgName:s,project:a,isRaven:r})}),(0,n.jsx)(z.hP,{onSelect:i,className:"!gap-0",children:(0,n.jsx)(G,{state:"shared",isCurrentState:t,orgName:s,project:a,isRaven:r})})]}):(0,n.jsx)("div",{children:o})}function G(e){let{state:t,isCurrentState:s,orgName:a,project:i,isRaven:r}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{className:"inline-flex flex-row items-center justify-between gap-3 max-w-full overflow-hidden",children:[(0,n.jsxs)("span",{className:"inline-flex flex-row items-center gap-1.5 max-w-full",children:[(0,n.jsxs)("span",{className:"text-text-300 shrink-0",children:["private"===t&&(0,n.jsx)(D.H,{size:18}),"shared"===t&&r&&(0,n.jsx)(L.$,{size:18}),"shared"===t&&!r&&(0,n.jsx)(U.T,{size:18})]}),(0,n.jsxs)("p",{className:(0,l.Z)("text-ellipsis overflow-hidden",s&&"font-medium text-text-000"),children:["private"===t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{defaultMessage:"Private (only you have access)",id:"EsW/fizDS4"}),"\xa0",s&&"private"!==t&&(0,n.jsx)("span",{className:"text-text-300 text-sm font-normal",children:(0,n.jsx)(g.Z,{defaultMessage:"(Unshare this chat)",id:"EZEp1AdoRv"})})]}),"shared"===t&&r&&(0,n.jsx)(g.Z,{defaultMessage:"Shared (anyone in {scope} can view)",id:"mG1NQd3Jzv",values:{scope:(null==i?void 0:i.is_private)?i.name:a}}),"shared"===t&&!r&&(0,n.jsx)(g.Z,{defaultMessage:"Public (anyone on the web can view)",id:"no0TFMuRD0"})]})]}),s&&(0,n.jsx)(B.J,{size:16,weight:"bold",className:"text-accent-secondary-100 shrink-0"})]})})}function K(e){let{upToDate:t,isShared:s,upsertSnapshot:a,disabled:i,disabledReason:l="",isRaven:r}=e;return(0,n.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,n.jsx)("div",{className:"text-text-300 flex flex-row items-center gap-1 text-sm",children:s?(0,n.jsx)(n.Fragment,{children:r&&(t?(0,n.jsx)(g.Z,{defaultMessage:"Future messages aren’t included",id:"YiRN6e1JBr"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{defaultMessage:"New messages since last shared",id:"RnySEeXsUF"}),(0,n.jsx)(y.u,{tooltipContent:i?l:(0,n.jsx)(g.Z,{defaultMessage:"Share the most recent chat content",id:"oAf7Y+LN9j"}),children:(0,n.jsx)(u.z,{variant:"underline",size:"unset",className:"ml-1 gap-1",onClick:a,prepend:(0,n.jsx)(P.t,{}),disabled:i,children:(0,n.jsx)(g.Z,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})]}))}):(0,n.jsx)(g.Z,{defaultMessage:"Only messages up until now will be shared",id:"OUOkOQvr8p"})})})}function Y(e){let{controlsSidebarIsOpen:t,closeControlsSidebar:s,openControlsSidebar:a,conversationUUID:i,isStreaming:o}=e,c=(0,_.Z)(),x=(0,f.Q)(m.t6),h=function(e){let{track:t}=(0,j.z$)(),{data:s}=(0,d.Cy)(e.conversationUUID),[n,a]=(0,r.useState)(!1),i=(0,r.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUUID}),a(!0)},[t,e.conversationUUID]),l=!!(null==s?void 0:s.snapshot),o=l||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),c=e.isStreaming||!l&&!(null==s?void 0:s.shareable);return{conversationUUID:e.conversationUUID,showShareModal:n,openShareModal:i,closeShareModal:()=>a(!1),isShared:l,showShareFlow:o,disabled:c,...s}}({conversationUUID:i,isStreaming:o}),{chatResourceState:{artifacts:p,selectedItem:v},dispatchChatResource:M}=(0,C.Y)(),{setIsDrawerExpanded:S}=(0,k.b)(),E=!!a&&!!s&&!t;return(0,n.jsxs)("div",{className:(0,l.Z)("flex items-center gap-1","transition-opacity duration-300",t?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!E&&"hidden"),children:[h.showShareFlow&&(0,n.jsx)(N.$,{variant:"ghost",className:"font-medium text-sm !text-text-100",onClick:h.openShareModal,disabled:h.disabled||!E,prepend:(0,n.jsx)(w.D,{size:18,weight:"light"}),disabledReason:h.disabled_reason,children:(0,n.jsx)(g.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),p&&Object.values(p).length>0?(0,n.jsx)(y.u,{tooltipContent:c.formatMessage({defaultMessage:"Open artifacts",id:"qsF1KKbjFR"}),delayDuration:500,side:"bottom",children:(0,n.jsx)(u.z,{variant:"ghost",size:x?"icon_sm":"icon",onClick:()=>{if(p){if(v&&(null==v?void 0:v.type)==="artifact")S(!0);else{let e=Object.values(p).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()})[0],t=e.versions[e.versions.length-1].uuid;M({type:"SELECT_ARTIFACT",id:e.id,versionUUID:t}),setTimeout(()=>{S(!0)},50)}}},disabled:!E,children:(0,n.jsx)(b.G3,{size:18})})}):null,x&&(0,n.jsx)(N.$,{href:"/new",prepend:(0,n.jsx)(b.yc,{size:16}),variant:"flat",disabled:!E,className:"ml-1",children:(0,n.jsx)(g.Z,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),h.showShareFlow&&(0,n.jsx)(J,{...h})]})}let V=(0,r.memo)(function(e){let{conversationUUID:t,name:s,isInteractive:a=!0,sharedBy:i,project:r,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:j,isStreaming:y,isSharedChat:b}=e,{data:w}=(0,d._C)(t,{enabled:!b}),_=!!r&&!r.is_harmony_project,N=(0,f.Q)(m.t6);return(0,n.jsxs)(v.PageHeader,{className:(0,l.Z)("h-12",!N&&"-mb-6"),contentClassName:"gap-6 pr-2",sticky:!0,children:[(0,n.jsxs)("div",{className:"flex min-w-0 flex-1 shrink flex-col md:flex-row md:items-center",children:[_&&(0,n.jsx)(h.default,{href:"/project/".concat(r.uuid),className:"text-sm text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 max-md:text-xs tracking-tight",children:(0,n.jsxs)("div",{className:"truncate",children:[r.name," ",(0,n.jsx)("span",{className:"opacity-50",children:"/"})]})}),(0,n.jsx)("div",{className:"flex min-w-0 shrink-1 items-center max-md:text-sm",children:a&&w?(0,n.jsx)(p.p,{conversation:w,initialName:s,trigger:(0,n.jsx)(u.z,{variant:"ghost",size:"default",className:"!text-text-000 !shrink gap-1 !px-1 !py-0 !scale-100 !h-7",append:(0,n.jsx)(x.p,{size:12,weight:"bold"}),"data-testid":"chat-menu-trigger",children:(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)("div",{className:"truncate tracking-tight font-normal font-styrene",children:s.length>0?s:(0,n.jsx)(g.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}):(0,n.jsx)("div",{className:"truncate tracking-tight font-normal font-styrene text-sm",children:s.length>0?s:(0,n.jsx)(g.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,n.jsxs)("div",{className:"right-3 flex gap-2",children:[i&&(0,n.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 text-sm",children:(0,n.jsx)(g.Z,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!b&&(0,n.jsx)(Y,{conversationUUID:t,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:j,isStreaming:y})]})]})});function X(e){let{headerProps:t,mainElement:s,drawerElement:d,auxilaryElement:u,isDrawerOpen:m,autoscrollRef:f,autoscrollDisabled:x}=e,[h,g]=(0,r.useState)(!1),p=(0,r.useRef)(null),v=(0,r.useRef)(null),j=(0,r.useRef)(null),y=(0,r.useRef)(null),b=(0,r.useRef)({interacted:!1}),{setIsDrawerExpanded:w}=(0,k.b)(),_=(0,i.Z)("md");return(0,r.useEffect)(function(){let e=!0;if(!j.current||!v.current||!p.current||!y.current)return;let t=v.current,s=j.current,n=y.current;if(_){let e=m?window.innerWidth/2-c.u:s.getBoundingClientRect().width;n.style.width="".concat(e,"px")}let a=Date.now(),i=m?0:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return m&&(requestAnimationFrame(function i(){if(!e)return;let l=(Date.now()-a)/220,r=50*l;if(l>=1||!_){t.style.flex=String(50),s.style.flex=String(50),n.style.width="auto";return}t.style.flex=String(100-r),s.style.flex=String(r),requestAnimationFrame(i)}),b.current.interacted=!0),!m&&b.current.interacted&&requestAnimationFrame(function l(){if(!e)return;let r=(Date.now()-a)/220,o=i-r*i;if(r>=1||!_){t.style.flex=String(100),s.style.flex=String(0),n.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(l)}),()=>{e=!1}},[m]),(0,o.yU)({ref:p,onResize(){if(!j.current||!v.current||!p.current)return;let e=p.current.getBoundingClientRect(),t=v.current.getBoundingClientRect();if(window.innerWidth<768||t.width>420)return;let s=420/e.width*100;v.current.style.flex=String(s),j.current.style.flex=String(100-s)}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,l.Z)("flex flex-1 h-screen w-full overflow-hidden relative",h&&"select-none"),ref:p,onMouseUp:function(){g(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{if(!h||!j.current||!v.current||!p.current)return;let t=p.current.getBoundingClientRect(),s=v.current.getBoundingClientRect(),n=Math.min(Math.max(e.clientX-s.left,420),t.width-240)/t.width*100;v.current.style.flex=String(n),j.current.style.flex=String(100-n)},children:[(0,n.jsxs)("div",{ref:v,className:"h-screen flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,n.jsx)(V,{...t}),(0,n.jsx)(a.l,{ref:f,disabled:x,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,n.jsxs)("div",{className:(0,l.Z)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!m&&"hidden"),onMouseDown:function(){g(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,n.jsx)("div",{className:(0,l.Z)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",h&&"!bg-accent-secondary-000")}),(0,n.jsx)("div",{className:(0,l.Z)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",h&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,n.jsx)("div",{ref:j,className:(0,l.Z)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",m?"max-md:flex-1":"max-md:hidden",h&&"pointer-events-none"),style:{flex:"0 0"},children:(0,n.jsxs)("div",{ref:y,className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"h-12 md:hidden bg-bg-500 bg-opacity-60",onClick:()=>{w(!1)}}),(0,n.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:d})]})})]}),null!=u?u:null]})}},66983:function(e,t,s){"use strict";s.d(t,{J:function(){return to},U:function(){return tc}});var n=s(41596),a=s(27573),i=s(7653),l=s(87757),r=s(84571);r.Z.blockRegex;let o=r.Z.defaultRules,c=r.Z.parserFor;r.Z.defaultBlockParse;let d=r.Z.outputFor,u=e=>d(e,"react");var m=s(61995);let f={fence:{...o.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,a.jsx)(m.M.code,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...o.blockQuote,react:(e,t,s)=>(0,a.jsx)(m.M.blockQuote,{children:t(e.content,s)})},list:{...o.list,react:(e,t,s)=>{let n=e.ordered?m.M.ol:m.M.ul;return(0,a.jsx)(n,{children:e.items.map((e,n)=>(0,a.jsx)(m.M.li,{children:t(e,s)},n))},s.key)}},newline:o.newline,paragraph:{...o.paragraph,react:(e,t,s)=>(0,a.jsx)(m.M.p,{children:t(e.content,s)},s.key)},u:o.u,del:o.del,inlineCode:{...o.inlineCode,react:e=>{let t=e.content;if(t&&l.Oy.test(t)){var s;if((null===(s=t.match(l.Oy))||void 0===s?void 0:s[0])===t)return(0,a.jsxs)(m.M.code,{inline:!0,children:[(0,a.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,a.jsx)(l.ZQ,{color:t})}),t]})}return(0,a.jsx)(m.M.code,{inline:!0,children:t})}},text:{...o.text,react:e=>(0,l.TB)(e.content)},url:o.url,link:{...o.link,match:(e,t)=>null},em:o.em,strong:o.strong},x=(e,t)=>c(t)(e,{inline:!1}),h=(0,i.memo)(e=>{let{text:t}=e,s=x(t,f);return u(f)(s)});h.displayName="AnthropicMarkDown";var g=s(16282),p=s(18916),v=s(9788),j=s(70354),y=s(87033),b=s(30070),w=s(33995),_=s(11510),N=s(40950),C=s(45790),k=s(2717);function M(){let e=(0,n._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return M=function(){return e},e}function S(){let e=(0,n._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return S=function(){return e},e}function E(){let e=(0,n._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return E=function(){return e},e}function z(){let e=(0,n._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return z=function(){return e},e}let Z=v.q.div(M()),F=(0,v.q)(Z)(S()),I=(0,v.q)(Z)(E()),T=(0,v.q)(Z)(z()),R=(0,i.memo)(function(e){var t;let{message:s,messageWarningPropsFromParent:n,hasLink:l,hasCode:r,hasDriveDocWithImages:o,onRetry:c,onSendContinue:d,conversationSettings:u,isLastMessage:m}=e,f=(0,N.Z)(),{value:x}=null!==(t=(0,y.FL)("hatch_use_web_fetcher"))&&void 0!==t&&t,{value:h}=(0,p.h)(null!=u?u:{}),g=null==u?void 0:u.enabled_web_search,v=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,a.jsx)("a",{...s,className:"underline"})}}),[]);if((null==n?void 0:n.style)==="prominent")return(0,a.jsxs)(I,{"data-testid":"message-warning",children:[(0,a.jsx)(b.v,{className:"shrink-0",size:16}),(0,a.jsx)(k.D,{components:v,children:n.contentMarkdown})]});let M="human"===s.sender;if(!M&&"error"===s.stop_reason&&c)return(0,a.jsxs)(T,{"data-testid":"message-warning",onClick:()=>c(s.parent_message_uuid),children:[(0,a.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,a.jsx)(b.v,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,a.jsx)(w.y,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,a.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,a.jsx)(C.Z,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!M&&m&&"max_tokens"===s.stop_reason&&d)return(0,a.jsx)(F,{"data-testid":"message-warning",children:(0,a.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.k,{className:"shrink-0",size:16}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(C.Z,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,a.jsx)("div",{className:"ml-6",children:(0,a.jsx)(j.z,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==d?void 0:d(),"aria-label":f.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,a.jsx)(C.Z,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});let S=[];return(M?(!l||x||g||S.push(f.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"})),o&&S.push(f.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(l&&!g&&S.push(f.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"})),r&&!h&&S.push(f.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),"max_tokens"===s.stop_reason&&S.push(f.formatMessage({defaultMessage:"Claude hit the max length for a message and has paused its response. You can write Continue to keep the chat going.",id:"BVx/hgGTMA"})),"conversation_length_limit"===s.stop_reason&&S.push(f.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),n&&S.push(n.contentMarkdown)),0===S.length)?null:(0,a.jsxs)(F,{"data-testid":"message-warning",children:[(0,a.jsx)(_.k,{className:"shrink-0",size:16}),(0,a.jsx)(k.D,{components:v,children:S.reverse().join(" ")})]})});var A=s(2210),O=s(405),D=s(27218),L=s(835),U=s(5984),P=s(82083),B=s(96707),H=s(10228),J=s(53462),W=s(10607),q=s(68425),G=s(43290),K=s(2949),Y=s(35102),V=s(84575),X=s(76220),Q=s(1812),$=s(17582),ee=s(98731),et=s(19984),es=s(91588),en=s(37141),ea=s(8927),ei=s(41270),el=s(59016),er=s(85465),eo=s(91217),ec=s(5362);let ed=(e,t)=>{let{activeOrganization:s}=(0,D.t)(),n=null==s?void 0:s.uuid;return(0,ec.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")};var eu=s(20147),em=s(45033),ef=s(11607),ex=s(52939),eh=s(77003),eg=s(41668),ep=s(19834);function ev(e){let{isOpen:t,onClose:s,conversationUUID:n,messageUUID:i,text:l}=e;return(0,a.jsx)(ex.u_,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,children:(0,a.jsx)(ej,{conversationUUID:n,messageUUID:i,text:l})})}function ej(e){let{conversationUUID:t,messageUUID:s,text:n}=e,{data:l,isPending:r,mutateAsync:o}=ed(t,s),{model:c}=(0,eo.r)(),d=(0,er.gE)("paprika_mode"),u=(0,Q.T)(),m=(0,ep.z)(u||{}),{codeStyle:f}=(0,eu.o)(),x=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let n=JSON.parse(s);e.logs.api_usage[t]=n}catch(e){}return e}(l),null,2):"";(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:c,tools:m(),personalized_styles:[],paprika_mode:d})})()},[o,c,m,d]);let{didCopy:h,copyToClipboard:g}=(0,$.m)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(ex.dm,{layout:"left",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("h2",{className:"font-styrene-display text-accent-pro-000 text-xl font-medium",children:[(0,a.jsx)(C.Z,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),"\xa0",(0,a.jsx)("span",{className:"ml-1 text-sm font-medium text-danger-000",children:(0,a.jsx)(C.Z,{defaultMessage:"FOR INTERNAL USE ONLY",id:"ISVSjyq5f9"})})]})}),(0,a.jsxs)(j.z,{variant:"ghost",onClick:()=>{g(x)},disabled:r,children:[(0,a.jsx)($.f,{didCopy:h,size:16,className:"mr-2"}),(0,a.jsx)(C.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})]}),(0,a.jsx)(ey,{text:n})]}),r?(0,a.jsx)("div",{className:"my-2 flex h-full w-full items-center justify-center",children:(0,a.jsx)(ef.Loading,{})}):(0,a.jsx)(eg.Z,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:f,children:x})]})}let ey=e=>{let{text:t}=e,{copyToClipboard:s}=(0,$.m)();return(0,a.jsx)(em.Lt,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,a.jsx)(j.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(eh.x,{size:20})}),children:(0,a.jsx)(em.hP,{className:"text-md",onSelect:()=>{s(t)},children:(0,a.jsx)("div",{className:"flex items-center justify-between gap-1",children:(0,a.jsx)("div",{className:"flex grow items-center",children:(0,a.jsx)(C.Z,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})})})})})};var eb=s(35707),ew=s(77056),e_=s(5751);function eN(e){var t,s;let{conversationUuid:n,message:l}=e,[r,o]=(0,i.useState)(void 0),[c,d]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o("flag"):"upvote"!==r&&o("upvote"),d(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote"),children:(0,a.jsx)(eb.V,{size:16,weight:(null===(t=l.chat_feedback)||void 0===t?void 0:t.type.includes("upvote"))?"fill":"regular"})}),(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag"),children:(0,a.jsx)(ew.L,{size:16,weight:(null===(s=l.chat_feedback)||void 0===s?void 0:s.type.includes("flag"))?"fill":"regular"})}),(0,a.jsx)(e_.r,{conversationUuid:n,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:c,onClose:()=>d(!1)})]})}var eC=s(69321),ek=s(30131),eM=s(96346);function eS(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:n,parentMessageUUID:l,setPaprikaModeState:r}=e,[o,c]=(0,i.useState)(!1),d=(0,ek.dI)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{n(e,t),r(t)},[n,r]);return(0,a.jsxs)(em.Lt,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:c,trigger:(0,a.jsxs)(j.z,{variant:"unstyled",size:"unset",className:"flex flex-row items-center gap-1 rounded-md p-2 py-1.5 text-sm transition-opacity delay-100 hover:bg-bg-300 select-none",children:[(0,a.jsx)(C.Z,{defaultMessage:"Retry",id:"62nsdyMyIO"}),(0,a.jsx)(eM.p,{size:12,className:"text-text-500 shrink-0"})]}),children:[(0,a.jsx)(em.hP,{className:"text-sm",onClick:()=>n(l),children:(0,a.jsx)(C.Z,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),d.map(e=>(0,a.jsx)(em.hP,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,a.jsx)(C.Z,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,a.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,a.jsx)(eC.d7,{id:e.description_key}):e.description})]})},e.id))]})}var eE=s(70278);let ez={default:{allowed:"never"}},eZ=ei.z.record(ei.z.object({allowed:ei.z.enum(["never","first_turn","always"])}));function eF(e){var t,s,n,l,r,o,c,d;let{message:u,conversationUUID:m,isStreaming:f,onRetry:x,isLastMessage:h,isLastHumanMessage:g=!1,isInteractive:p=!0,changeDisplayedConversationPath:v,editMessage:j,isFirstAssistantMessage:b,isResearchPending:w}=e,[_,N]=(0,i.useState)(!1),k=null!==(r=null===(t=(0,Q.T)())||void 0===t?void 0:t.preview_feature_uses_artifacts)&&void 0!==r&&r,M="human"===u.sender,S="assistant"===u.sender,E=f&&h,{value:z}=(0,y.FL)("anthropic_internal_only_expose_chat_debug"),Z=!f&&(null!==(o=u.nOptions)&&void 0!==o?o:0)>1&&v,F=!f&&!w&&j&&u.parent_message_uuid&&p,I=null==u?void 0:null===(s=u.content)||void 0===s?void 0:s.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),T=!f&&!w&&p&&!I,R=(0,ee.K)(u),{didCopy:A,copyToClipboard:O}=(0,$.m)(),D=async()=>{let e=(k?(0,P.w0)(R):R).trim();try{let t=(0,eE.c)(e);await O({text:e,html:t})}catch(t){await O(e)}},L=(0,el.hb)(),{toggleConversationSetting:U}=(0,er.M0)(),B=(0,er.gE)("paprika_mode"),{model:H}=(0,eo.r)(),{allModelOptions:J}=(0,X.uL)(),W=(0,y.xQ)("claude_ai_paprika_retry",ez,eZ),q=null!==(d=null!==(c=H&&(null===(n=W[H])||void 0===n?void 0:n.allowed))&&void 0!==c?c:null===(l=W.default)||void 0===l?void 0:l.allowed)&&void 0!==d?d:"never";if(M&&!F&&!Z)return null;let G=J.find(e=>e.model===H),K=null==G?void 0:G.paprika_modes,Y=K&&K.length>0&&!B&&("always"===q||"first_turn"===q&&b);return(0,a.jsx)(eI,{isStreaming:E,isLastMessage:h||g,isInteractive:p,isAssistant:S,children:(0,a.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[S&&z&&(0,a.jsx)(V.w,{Icon:et.J,tooltipContent:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(C.Z,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),(0,a.jsx)("div",{className:"px-1 py-px -mr-0.5 text-xs bg-always-white/20 rounded",children:(0,a.jsx)(C.Z,{defaultMessage:"Internal",id:"2KtWqT5Nl+"})})]}),onClick:()=>N(!0),isAssistant:S}),S&&z&&(0,a.jsx)(ev,{isOpen:_,onClose:()=>N(!1),messageUUID:u.uuid,text:R,conversationUUID:m}),M&&F&&(0,a.jsx)(V.w,{onClick:()=>j(u,"test edit message"),isAssistant:S,children:(0,a.jsx)(C.Z,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),S&&(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),onClick:D,isAssistant:S,children:(0,a.jsx)("div",{children:(0,a.jsx)($.f,{size:16,"data-testid":"action-bar-copy",didCopy:A})})}),S&&!E&&!w&&p&&"error"!==u.stop_reason&&L&&(0,a.jsx)(eN,{conversationUuid:m,message:u}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5",children:[Z&&(0,a.jsx)(eT,{message:u,changeDisplayedConversationPath:v,isAssistant:S}),S&&T&&(Y?(0,a.jsx)(eS,{paprikaMode:B,supportedPaprikaModes:K,onRetry:x,parentMessageUUID:u.parent_message_uuid,setPaprikaModeState:e=>{U("paprika_mode",null!=e?e:null)}}):(0,a.jsx)(V.w,{onClick:()=>x(u.parent_message_uuid),isAssistant:S,children:(0,a.jsx)(C.Z,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})}let eI=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:n,isAssistant:i,children:l}=e;return(0,a.jsx)(ea.M,{children:!t&&(0,a.jsx)(q.E.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,a.jsx)("div",{className:(0,W.Z)("rounded-lg transition min-w-max pointer-events-auto",!i&&"translate-y-4 bg-bg-300/90 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",i&&"translate-x-2",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})};function eT(e){var t;let{message:s,changeDisplayedConversationPath:n,isAssistant:i}=e,l=(null!==(t=s.selectedOption)&&void 0!==t?t:0)+1,r=l===s.nOptions;return(0,a.jsxs)("div",{className:"flex text-xs",children:[(0,a.jsx)(V.w,{className:(0,W.Z)("px-0.5 mr-1",1===l&&"opacity-50 pointer-events-none"),onClick:()=>n(s,-1),isAssistant:i,children:(0,a.jsx)(es.W,{})}),(0,a.jsx)("span",{className:"self-center shrink-0 select-none",children:(0,a.jsx)(C.Z,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:l,totalOptions:s.nOptions}})}),(0,a.jsx)(V.w,{className:(0,W.Z)("px-0.5 ml-1",r&&"opacity-50 pointer-events-none"),onClick:()=>n(s,1),isAssistant:i,children:(0,a.jsx)(en.T,{})})]})}var eR=s(3053),eA=s(32006),eO=s(54328);let eD=()=>{let e=(0,eR.z$)(),{initDriveAuth:t}=(0,K.nC)({});return(0,a.jsx)(eL,{title:(0,a.jsx)(C.Z,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,a.jsx)(eO.v,{size:18}),cta:(0,a.jsxs)(j.z,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,a.jsx)(eA.k6,{size:16,className:"mr-1"}),(0,a.jsx)(C.Z,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eL=e=>{let{title:t,icon:s,cta:n}=e;return(0,a.jsx)(q.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,a.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,a.jsx)("div",{className:"px-2.5 py-2.5",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,a.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),n]})})})})},eU=e=>{let{previousMessage:t}=e,s=(0,K.Aj)(),{isDriveAuthenticated:n}=(0,K.nC)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,y.FL)("pumpernickel_enabled");return r&&s&&!n&&l?(0,a.jsx)(eD,{}):null};var eP=s(48912);let eB=e=>{let{title:t,text:s}=e,n=(0,N.Z)();t=t||n.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,$.m)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,eE.c)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,a.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-message",children:[(0,a.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,a.jsx)("span",{className:"flex-1",children:t}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,a.jsx)($.f,{didCopy:i,size:16})})]}),(0,a.jsx)(eP.U,{className:"px-4 pt-2 pb-4",children:s})]})};var eH=s(89799),eJ=s(1146);let eW=e=>{let{size:t=32,className:s}=e;return(0,a.jsxs)("svg",{width:t,height:t,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:s,children:[(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0121 5.17898C14.6561 5.0615 15.3204 5 16 5C22.0751 5 27 9.92487 27 16C27 22.0751 22.0751 27 16 27C15.8588 27 15.7183 26.9973 15.5785 26.9921C15.0266 26.9713 14.5624 27.4019 14.5416 27.9538C14.5209 28.5057 14.9514 28.9699 15.5033 28.9907C15.6681 28.9969 15.8337 29 16 29C23.1797 29 29 23.1797 29 16C29 8.8203 23.1797 3 16 3C15.1995 3 14.4151 3.07246 13.6532 3.21144C13.1099 3.31055 12.7498 3.83134 12.8489 4.37466C12.948 4.91798 13.4688 5.27808 14.0121 5.17898ZM10.6328 5.5356C10.556 5.24904 10.396 4.99168 10.1729 4.79607C9.94988 4.60046 9.67384 4.47539 9.3797 4.43667C9.08557 4.39794 8.78656 4.44731 8.52048 4.57852C8.25441 4.70974 8.03321 4.91691 7.88488 5.17383C7.73654 5.43076 7.66772 5.7259 7.68713 6.02194C7.70653 6.31797 7.81328 6.60161 7.99389 6.83697C8.17449 7.07234 8.42083 7.24886 8.70176 7.34423C8.98268 7.43959 9.28558 7.4495 9.57214 7.37272C9.95641 7.26976 10.284 7.01836 10.483 6.67383C10.6819 6.3293 10.7358 5.91987 10.6328 5.5356ZM6.60273 8.85853C6.82578 9.05414 6.98581 9.3115 7.0626 9.59807C7.16556 9.98234 7.11166 10.3918 6.91274 10.7363C6.71383 11.0808 6.3862 11.3322 6.00194 11.4352C5.71537 11.512 5.41248 11.5021 5.13155 11.4067C4.85062 11.3113 4.60428 11.1348 4.42368 10.8994C4.24307 10.6641 4.13632 10.3804 4.11692 10.0844C4.09752 9.78836 4.16633 9.49322 4.31467 9.2363C4.46301 8.97937 4.6842 8.7722 4.95027 8.64099C5.21635 8.50977 5.51536 8.4604 5.8095 8.49913C6.10363 8.53785 6.37968 8.66293 6.60273 8.85853ZM4.86963 13.9817C5.09268 14.1773 5.25272 14.4346 5.3295 14.7212C5.43247 15.1055 5.37857 15.5149 5.17965 15.8594C4.98074 16.2039 4.65311 16.4553 4.26884 16.5583C3.98228 16.6351 3.67938 16.6252 3.39846 16.5298C3.11753 16.4344 2.87119 16.2579 2.69059 16.0226C2.50998 15.7872 2.40323 15.5036 2.38383 15.2075C2.36442 14.9115 2.43324 14.6163 2.58158 14.3594C2.72991 14.1025 2.95111 13.8953 3.21718 13.7641C3.48326 13.6329 3.78227 13.5835 4.07641 13.6223C4.37054 13.661 4.64658 13.786 4.86963 13.9817Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M15 9.00012V16.0001C15 16.2653 15.1054 16.5197 15.2929 16.7072C15.4804 16.8948 15.7348 17.0001 16 17.0001H23C23.2652 17.0001 23.5196 16.8948 23.7071 16.7072C23.8946 16.5197 24 16.2653 24 16.0001C24 15.7349 23.8946 15.4806 23.7071 15.293C23.5196 15.1055 23.2652 15.0001 23 15.0001H17V9.00012C17 8.73491 16.8946 8.48055 16.7071 8.29302C16.5196 8.10548 16.2652 8.00012 16 8.00012C15.7348 8.00012 15.4804 8.10548 15.2929 8.29302C15.1054 8.48055 15 8.73491 15 9.00012Z",fill:"currentColor"}),(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 21C8 20.4477 7.55228 20 7 20C6.44772 20 6 20.4477 6 21V24H3C2.44772 24 2 24.4477 2 25C2 25.5523 2.44772 26 3 26H6V29C6 29.5523 6.44772 30 7 30C7.55228 30 8 29.5523 8 29V26H11C11.5523 26 12 25.5523 12 25C12 24.4477 11.5523 24 11 24H8V21Z",fill:"currentColor"})]})};var eq=s(49148);let eG=["year","month","day","hour","minute","second","millisecond"],eK=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=eq.nL.fromDurationLike(t);return e.formatList(eG.filter(e=>0!==a["".concat(e,"s")]).map(t=>e.formatNumber(a["".concat(t,"s")],{...n,style:"unit",unit:t})),{...n,style:s})}((0,N.Z)(),t,s)};var eY=s(49454),eV=s(88146),eX=s(30833),eQ=s(65499);function e$(){let e=(0,n._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 text-xs mx-4 mb-4 font-styrene tracking-tight"]);return e$=function(){return e},e}function e0(e,t){if(e)return(t?G.ou.fromISO(t):G.ou.now()).diff(G.ou.fromISO(e),["hours","minutes","seconds"])}let e1=v.q.div(e$()),e2=()=>(0,a.jsxs)(e1,{"data-testid":"message-warning",children:[(0,a.jsx)(eY.k,{className:"shrink-0",size:16}),(0,a.jsx)(C.Z,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,a.jsx)(eV.default,{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),e5=e=>{let{text:t,cutOff:s}=e,{value:n}=(0,y.FL)("use_in_house_latex_transformer");return(0,a.jsxs)("div",{className:"text-text-300 text-sm font-normal leading-[21px] gap-0.5 relative font-tiempos",children:[(0,a.jsx)(A.ux,{className:"p-3 pt-0 pr-8",text:t,useInHouseLatexPlugin:n}),!0!==s?null:(0,a.jsx)(e2,{})]})},e3=e=>{let{text:t,cutOff:s=!1,startTimestamp:n,stopTimestamp:l,isStreaming:r,mostRecentSummary:o,onToggle:c,messageUuid:d,isFirstBlockOfMessage:u,isLastBlockOfMessage:m}=e,{isExpanded:f,setIsExpanded:x,snappyTransition:h}=(0,eQ.g)(r),g=(0,eR.z$)(),p=(0,N.Z)(),[v,j]=(0,i.useState)(()=>e0(n,l)),y=(0,i.useRef)(),b=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eJ.Ef)(d)&&b.current.length>0&&(b.current.forEach(e=>{g.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:d,timestamp:e.timestamp})}),b.current=[])},[d,g]),(0,i.useEffect)(()=>{let e=()=>{let e=e0(n,void 0);y.current=e,j(e)};if(r){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!y.current&&l&&j(e0(n,l))},[n,l,r]);let w=p.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),_=p.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),C=(null==o?void 0:o.summary)||(r?w:_);return(0,a.jsx)(eX.qd,{isStreaming:r,isExpanded:f,setIsExpanded:()=>{let e=new Date().toISOString();(0,eJ.Ef)(d)?g.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!f,is_streaming:r,chat_message_uuid:d,timestamp:e}):b.current.push({isOpening:!f,wasStreamingWhenClicked:r,timestamp:e}),x(!f)},isFirstBlockOfMessage:u,isLastBlockOfMessage:m,text:f?_:r||y.current?(0,a.jsx)(ea.M,{mode:"wait",children:(0,a.jsx)(q.E.p,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:"text-left relative text-sm font-tiempos leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:C},C)}):(0,a.jsx)("span",{className:"text-left relative text-sm font-tiempos leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:C}),secondaryText:v?(0,a.jsxs)("div",{className:"flex items-center gap-1 transition-opacity",children:[(0,a.jsx)(eW,{className:(0,W.Z)("text-text-300 transition-all duration-300 ease-in-out opacity-50",r?"!opacity-0 scale-50":"scale-100 opacity-100"),size:14}),(0,a.jsx)("span",{className:"text-text-500 font-styrene text-xs tabular-nums whitespace-nowrap",children:(0,a.jsx)(eK,{value:v,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,children:(0,a.jsx)(eX.jE,{isExpanded:f,snappyTransition:h,onTransitionEnd:c,isScrollable:!0,children:(0,a.jsx)(e5,{text:t,cutOff:s})})})};var e4=s(81353);function e6(){let e=(0,n._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return e6=function(){return e},e}function e7(){let e=(0,n._)(["\n  group\n  relative\n  -tracking-[0.015em]\n"]);return e7=function(){return e},e}function e8(){let e=(0,n._)(["\n  font-claude-message\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&>div>div>:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&>div>div>:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return e8=function(){return e},e}let e9={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},te={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},tt={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},ts=[],tn=e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0},ta=(e,t,s)=>{var n,a,i,l;let r,o,c;let d=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=tn(s.partial_json)):r=null===(a=s.input)||void 0===a?void 0:a.id,u&&(o=null==e?void 0:null===(i=e.input)||void 0===i?void 0:i.id),!d||(null==t?void 0:t.partial_json)||(c=null==t?void 0:null===(l=t.input)||void 0===l?void 0:l.id);let m=r===o,f=r===c,x="individual_cell_create",h=null===(n=s.input)||void 0===n?void 0:n.command;return(h&&(x=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),d||u)?d&&u?m||f?m&&!f?"multi_edit_last":"multi_edit_not_last":x:d&&!u?f?"multi_edit_not_last":x:!d&&u&&m?"multi_edit_last":x:x},ti=(e,t)=>{let s=(0,B.X)(),n=(0,i.useCallback)(e=>{if("text"!==e.type)return e;let n=e.text;return s&&e.citations&&e.citations.length>0&&(n=(0,O.NM)(e.citations,n)),n=t?(0,P.An)(n):(0,P.w0)(n),{...e,text:n}},[t,s]);return(0,i.useMemo)(()=>{var t;let s=e.content,a=null===(t=e.content)||void 0===t?void 0:t[0];(null==a?void 0:a.type)==="text"&&""===a.text.trim()&&(s=null==s?void 0:s.slice(1));let i=(null==s?void 0:s.map(e=>n(e)))||[];return{...e,content:i}},[e,n])},tl=e=>{var t,s,n;let{block:l,message:r,updatedMessage:o,index:c,isShared:d,isStreaming:u,isLastMessage:m,publishedArtifacts:f,isFirstBlockOfMessage:x,isLastBlockOfMessage:h}=e,{renderToolUseCell:g}=(0,e4.I)(),p=(0,J.n)(l),v=l.name,j=l.id,y=l.context,b=null===(t=o.content)||void 0===t?void 0:t[c+1],w=(null==b?void 0:b.type)==="tool_result"?b:void 0,_={integrationName:l.integration_name,integrationIcon:l.integration_icon_url,message:(null==w?void 0:w.message)||l.message,input:l.display_content,result:null==w?void 0:w.display_content},N=!!o.content&&o.content.length<=c+1&&u,C=ta(null===(s=o.content)||void 0===s?void 0:s[c-2],null===(n=o.content)||void 0===n?void 0:n[c+2],l);if(!g)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let k=g({toolUseId:j,input:p,isLastMessage:m,message:r,publishedArtifacts:f,shouldStream:N,toolName:v,toolResult:w,displayData:_,artifactCellType:C,isFirstBlockOfMessage:x,isLastBlockOfMessage:h,isShared:d,context:y});return(0,a.jsx)(i.Fragment,{children:k})},tr=e=>{var t,s,n;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,textAreaRef:c,finishEdit:d,cancelEdit:u,author:m,loggedInAccount:f,message:x,selectAttachment:h,showSharedImageMissing:p=!1,showSharedFileMissing:v=!1}=e;(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),u()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===c.current){var t;null===(t=c.current)||void 0===t||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,u,c]);let y=null!==(n=x.files_v2)&&void 0!==n?n:x.files,b=p||v||x.attachments.length+y.length+((null==x?void 0:null===(t=x.sync_sources)||void 0===t?void 0:t.length)||0)>0;return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[b&&(0,a.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[y.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e},t)),x.attachments.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e,onClick:()=>null==h?void 0:h(e)},t)),null==x?void 0:null===(s=x.sync_sources)||void 0===s?void 0:s.map(e=>(0,a.jsx)(eH.Q,{uuid:e.uuid,syncSource:e},e.uuid)),p&&(0,a.jsx)(g.Xz,{}),v&&!p&&(0,a.jsx)(g.kD,{})]}),(0,a.jsx)(td,{...l&&te,className:"w-full",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"flex shrink-0 items-center",children:(0,a.jsx)(L.q,{name:m||(null==f?void 0:f.full_name)||"",size:"sm"})}),(0,a.jsxs)("div",{className:"font-user-message mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,a.jsx)(U.Kx,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:c}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,a.jsx)(_.k,{"aria-hidden":"true",className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(C.Z,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(j.z,{onClick:u,variant:"secondary",children:(0,a.jsx)(C.Z,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(j.z,{type:"submit",disabled:0===r.length,children:(0,a.jsx)(C.Z,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})},to=(0,i.memo)(function(e){var t,s,n,l,r,o,c,d;let{lastHumanMessageRef:u,lastAssistantMessageRef:m,isLastMessage:f,isLastHumanMessage:x,selectAttachment:p,author:v,isInteractive:j=!0,onOpenArtifact:b,onResize:w,editable:_,conversationSettings:N,publishedArtifacts:C=ts,messageWarningProps:k,showSharedImageMissing:M=!1,showSharedFileMissing:S=!1,isFirstAssistantMessage:E,isShared:z,actionEmitter:Z,onSendContinue:F,isResearchPending:I=!1,...T}=e,{previousMessage:O,message:U,isStreaming:P,conversationUUID:B}=T,[J,G]=(0,i.useState)(!1),[V,X]=(0,i.useState)(""),Q=(0,i.useRef)(null),$=(0,i.useRef)(1);(0,i.useEffect)(()=>{f||($.current+=1)});let ee=null!==(d=U.files_v2)&&void 0!==d?d:U.files,et=ti(U,b),es="",en=null===(t=et.content)||void 0===t?void 0:t.find(e=>"text"===e.type);en&&"text"in en&&(es=en.text);let ea=(0,i.useRef)(!1),ei=(0,i.useRef)(!1),{account:el,activeOrganization:er}=(0,D.t)(),{value:eo}=(0,y.FL)("use_in_house_latex_transformer"),ec=(0,i.useCallback)((e,t)=>{null==Z||Z.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[Z]),ed=_?()=>{X(es),G(!0)}:void 0,eu=(0,i.useCallback)(()=>{0!==V.length&&Z&&(Z.emit("edit",{message:et,text:V}),G(!1),X(""))},[V,Z,et]),em=(0,i.useCallback)(e=>null==b?void 0:b(e,et.uuid),[b,et.uuid]),ef="human"===et.sender,ex="assistant"===et.sender,eh=null===(s=et.content)||void 0===s?void 0:s.some(e=>"text"===e.type&&""!==e.text),eg=f&&P,ep=M||S||et.attachments.length+ee.length+((null==et?void 0:null===(n=et.sync_sources)||void 0===n?void 0:n.length)||0)>0,ev=(0,i.useMemo)(()=>{var e,t;return null!==(t=null===(e=U.sync_sources)||void 0===e?void 0:e.filter(e=>e.type===H.Fg.GDRIVE).map(e=>e.config.uri))&&void 0!==t?t:[]},[U.sync_sources]),ej=(0,K.mD)(ev),ey=(0,i.useMemo)(()=>ej.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[ej]);(0,Y.jL)();let eb="voice"===et.input_mode||"speech_input"===et.input_mode;return J?(0,a.jsx)(tr,{isStreaming:P,currentEdit:V,setCurrentEdit:X,textAreaRef:Q,finishEdit:eu,cancelEdit:()=>{G(!1),X("")},author:v,loggedInAccount:el,message:et,selectAttachment:p,showSharedImageMissing:M,showSharedFileMissing:S}):(0,a.jsxs)("div",{ref:x?u:f?m:null,"data-test-render-count":$.current,children:[ef&&(0,a.jsxs)("div",{className:"mb-1 mt-1",children:[ep&&(0,a.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[ee.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e},t)),et.attachments.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e,onClick:()=>null==p?void 0:p(e)},t)),null==et?void 0:null===(l=et.sync_sources)||void 0===l?void 0:l.map(e=>(0,a.jsx)(eH.Q,{uuid:e.uuid,syncSource:e},e.uuid)),M&&(0,a.jsx)(g.Xz,{}),S&&!M&&(0,a.jsx)(g.kD,{})]}),(0,a.jsxs)(td,{className:eh?"pr-6":"pr-[2.5px]",...P&&te,children:[(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"shrink-0",children:(0,a.jsx)(L.q,{name:v||(null==el?void 0:el.full_name)||"",size:"sm"})}),(0,a.jsx)("div",{"data-testid":"user-message",className:(0,W.Z)("font-user-message grid grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",{italic:eb}),children:null===(r=et.content)||void 0===r?void 0:r.map((e,t)=>"text"!==e.type?null:(0,a.jsx)(h,{text:e.text},t))})]}),(0,a.jsx)(R,{message:U,isLastMessage:f,hasLink:ea.current,hasDriveDocWithImages:ey,conversationSettings:N,messageWarningPropsFromParent:k}),(0,a.jsx)(eF,{isLastMessage:f,isInteractive:j,editMessage:ed,onRetry:ec,isResearchPending:I,...T})]})]}),ex&&(0,a.jsx)(a.Fragment,{children:et.content&&et.content[0]&&(0,a.jsx)(q.E.div,{style:{height:"auto"},...P&&tt,children:(0,a.jsxs)(tu,{"data-is-streaming":eg,...P&&e9,className:f?"pb-3":"pb-8",children:[null,(0,a.jsx)(tm,{children:null===(o=et.content)||void 0===o?void 0:o.map((e,t)=>{var s,n,l;let r=null===(s=et.content)||void 0===s?void 0:s[t+1],o=(null==r?void 0:r.type)==="tool_result",c=0===t,d=null!==(n=et.content)&&void 0!==n&&!!n.length&&t===et.content.length-1-(o?1:0);return"thinking"===e.type?(0,a.jsx)(e3,{text:e.thinking,cutOff:e.cut_off,startTimestamp:e.start_timestamp,stopTimestamp:e.stop_timestamp,isStreaming:eg&&!e.stop_timestamp,mostRecentSummary:null===(l=e.summaries)||void 0===l?void 0:l.at(-1),messageUuid:et.uuid,onToggle:()=>{w&&w()},isFirstBlockOfMessage:c,isLastBlockOfMessage:d},t):"tool_use"===e.type?(0,a.jsx)(tl,{block:e,message:U,updatedMessage:et,index:t,isShared:z,isStreaming:P,isLastMessage:f,publishedArtifacts:C,isFirstBlockOfMessage:c,isLastBlockOfMessage:d},t):"text"===e.type?0===t&&""===e.text?null:(0,a.jsxs)(i.Fragment,{children:[(0,a.jsx)(A.ux,{text:e.text,blockCitations:e.citations,hasLinkRef:ea,hasCodeRef:ei,isStreaming:P,onOpenArtifact:em,isLastMessage:f,publishedArtifacts:eg?void 0:C,useInHouseLatexPlugin:eo}),!eg&&""]},"".concat(t,"-").concat(eg?"streaming":"static")):void 0})}),null===(c=et.content)||void 0===c?void 0:c.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,a.jsx)(eB,{text:e.text,title:e.title},t)}),!P&&f&&(0,a.jsx)(eU,{previousMessage:O}),(0,a.jsx)(eF,{isLastMessage:f,isInteractive:j,isFirstAssistantMessage:E,onRetry:ec,isResearchPending:I,...T}),(0,a.jsx)(R,{message:U,isLastMessage:f,messageWarningPropsFromParent:k,conversationSettings:N,hasLink:ea.current,hasCode:ei.current,onRetry:ec,onSendContinue:F})]})})})]})}),tc=()=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,a.jsx)(td,{children:(0,a.jsx)("div",{className:(0,W.Z)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})}),td=(0,v.q)(q.E.div)(e6()),tu=(0,v.q)(q.E.div)(e7()),tm=v.q.div(e8())},81353:function(e,t,s){"use strict";s.d(t,{I:function(){return l},w:function(){return r}});var n=s(27573),a=s(7653);let i=a.createContext({renderToolUseCell:void 0}),l=()=>a.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,a.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,n.jsx)(i.Provider,{value:l,children:s})}},82915:function(e,t,s){"use strict";s.d(t,{k:function(){return sj},J:function(){return sv}});var n=s(41596),a=s(27573),i=s(28803),l=s(51789),r=s(1146),o=s(71817),c=s(76220),d=s(15281),u=s(66557),m=s(27218),f=s(1812),x=s(48410),h=s(9788),g=s(72538),p=s(32737),v=s(82083),j=s(87033),y=s(98649),b=s(10607),w=s(68425),_=s(2457),N=s.n(_),C=s(43290),k=s(5289),M=s(88146),S=s(81695),E=s(7653),z=s(40950),Z=s(45790),F=s(41270),I=s(7160),T=s(95899),R=s(32559),A=s(23098),O=s(95586),D=s(35102),L=s(8304),U=s(66983),P=s(60757),B=s(63690),H=s(7680),J=s(37458),W=s(47082),q=s(28346),G=s(95566),K=s(80762),Y=s(13927),V=s(35204);let X=e=>V.RI[e](),Q={js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",py:"python",rb:"ruby",java:"java",cpp:"cpp",cs:"csharp",php:"php",go:"go",rs:"rust",html:"html",css:"css",md:"markdown",json:"json",xml:"xml",yaml:"yaml",yml:"yaml",sh:"shell",sql:"sql"};var $=s(52902);let ee=e=>{if((0,$.Wx)(e)){let{pathComponents:t}=(0,$.Xp)(e);if(!t.length)throw Error("Invalid file uri");return t[t.length-1]}return e},et=new Y.F6,es=new Y.F6,en=[et.of([]),es.of([])],ea=(e,t,s)=>{let n=(0,q.Z)({original:t,gutter:!1});if(e.dispatch({effects:et.reconfigure(n)}),s){let s=(0,q.Z)({original:t,collapseUnchanged:{margin:3,minSize:4},gutter:!1});requestAnimationFrame(()=>{e.dispatch({effects:et.reconfigure(s)})})}},ei=e=>{var t,s;let{fetchFileContent:n,isStreaming:i,selectedContentId:l,readOnly:r,theme:o,onUpdate:c,onCreateEditor:d,collapseUnchanged:u=!0}=e,m=(0,E.useRef)(null),{registerEditor:f,unregisterEditor:x,getInstance:h,setMergeState:g}=(0,H.s)(),[p,v]=(0,E.useState)(void 0),[j,y]=(0,E.useState)(!1);(0,E.useEffect)(()=>()=>{j&&x(l)},[l,x,j]),(0,E.useEffect)(()=>{n(l).then(e=>{v(e)})},[l,p,n]);let b=null!==(s=null===(t=h(l))||void 0===t?void 0:t.mergeState)&&void 0!==s?s:{isActive:!1};(0,E.useEffect)(()=>{var e;let t=null===(e=m.current)||void 0===e?void 0:e.view;t&&(b.isActive&&"diffSource"in b?ea(t,b.diffSource,u):t.dispatch({effects:et.reconfigure([])}))},[b.isActive,u,i]);let w=(0,E.useCallback)(e=>{if(null==c||c(e),b.isActive){let t=(0,q.Sk)(e.state),s=!t||0===t.chunks.length;e.transactions.some(e=>e.effects.some(e=>e.is(q.kP)))&&s&&b.isActive&&(K.f("All changes accepted, deactivating merge view"),g(l,{isActive:!1}))}},[b.isActive,c,l,g]),_=function(e){let t=(0,E.useMemo)(()=>{var t;return Q[(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())||""]||"javascript"},[e]);return(0,E.useMemo)(()=>X(t),[t])}(ee(l)||"Unnamed File"),N=(0,E.useCallback)(e=>{f(l,e),y(!0),e.dispatch({effects:es.reconfigure(_||[])}),null==d||d(e)},[_,d,f,l]);return(0,a.jsx)(G.ZP,{ref:m,value:p,theme:o,readOnly:r,extensions:en,onUpdate:w,onCreateEditor:N,basicSetup:{foldGutter:!1,autocompletion:!1,lineNumbers:!1}})};function el(e,t){switch(t.type){case"create":case"update":if(t.newText!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t.newText},annotations:[G.YW.addToHistory.of(!1)]});try{ea(e,(0,q.gO)(e.state).toString(),"update"===t.type)}catch(e){}}break;case"delete":e.dispatch({changes:{from:0,to:e.state.doc.length,insert:""},annotations:[G.YW.addToHistory.of(!1)]})}}var er=s(28096),eo=s(18701);let ec=F.z.object({path:F.z.string().optional(),new_str:F.z.string().optional(),old_str:F.z.string().optional(),original_hash:F.z.string().optional(),file_text:F.z.string().optional()}),ed="antDocumentUpdate";RegExp("".concat("<".concat(ed),"(?:\\s+([^>]*)>|(?!>)\\S*)([\\s\\S]*?)(?:").concat("</".concat(ed,">"),"|$)"),"g");var eu=s(40030),em=s(10690),ef=s(16173),ex=s(53949),eh=s(37199),eg=s(84165),ep=s(45014),ev=s(59821),ej=s(70354),ey=s(43566),eb=(s(17582),s(28386)),ew=s(91588),e_=s(43116),eN=s(80151),eC=s(37141),ek=s(7992),eM=s(35919),eS=s.n(eM),eE=s(30833),ez=s(21273);let eZ=e=>{let t=new Map;for(let s of e)for(let e of s.annotated_snippets)for(let s of e.tool_calls)if("web_search"===s.tool_name&&s.metadata&&Array.isArray(s.metadata)){for(let e of s.metadata)if("string"==typeof e)try{let s=new URL(e).hostname,n=t.get(s);t.set(s,{count:((null==n?void 0:n.count)||0)+1,icon:(null==n?void 0:n.icon)||(0,a.jsx)(ev.s,{url:"https://".concat(s),size:14})})}catch(e){}}else if(s.output){let e=B.Fd[s.tool_name]||s.tool_name,n="rich_content"===s.output.type?s.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+n,icon:(null==i?void 0:i.icon)||(0,a.jsx)(B.xD,{name:e,size:14})})}return Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4)},eF=e=>{let{onClose:t,onBack:s,onDebug:n,title:i,isHidden:l,className:r}=e;return(0,a.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,a.jsx)(ej.z,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,a.jsx)(ew.W,{size:16})}),(0,a.jsx)("h2",{className:(0,b.Z)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!n&&(0,a.jsx)(ej.z,{variant:"ghost",size:"icon_sm",onClick:n,disabled:l,children:(0,a.jsx)(e_.t,{size:16})})]}),(0,a.jsx)(ej.z,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,a.jsx)(eN.X,{size:16})})]})};function eI(e){let{compassStatus:t}=e,s=eZ(t.agents),n=s.length>0?s[0][1].count:0;return 0===s.length?null:(0,a.jsx)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:s.map((e,t)=>{let[s,{count:i,icon:l}]=e;return(0,a.jsxs)("div",{className:"flex items-center text-xs",children:[(0,a.jsx)("div",{className:"h-3.5 w-3.5 mr-2",children:l}),(0,a.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-300 pr-2",title:s,children:s.replace(/^www\./,"")}),(0,a.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,a.jsx)(Z.Z,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:i}})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(w.E.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(i/n*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)})})}function eT(e){let{compassStatus:t,onOpenSources:s}=e;return t.total_sources?(0,a.jsxs)("button",{className:"transition-all w-full flex flex-col gap-3 p-4 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:[(0,a.jsx)(eI,{compassStatus:t}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1 font-medium text-text-300 text-xs",children:[(0,a.jsx)(Z.Z,{defaultMessage:"View all sources",id:"3mrUVg1r+J"}),(0,a.jsx)(eC.T,{size:12})]})]}):null}let eR=e=>{let{title:t,complete:s,className:n}=e;return(0,a.jsx)(w.E.h3,{className:(0,b.Z)("text-base text-text-100 font-tiempos",n),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,a.jsx)(ey.g,{children:t})},t)};function eA(e){let{title:t,description:s,tool_calls:n,onClick:i,complete:l}=e,r=n.reduce((e,t)=>{var s,n;return e+("web_fetch"===t.tool_name?t.tool_input&&(null===(s=t.metadata)||void 0===s?void 0:s[0])?1:0:t.output?(null===(n=t.output)||void 0===n?void 0:n.type)==="rich_content"?t.output.content.length:1:0)},0);return(0,a.jsxs)(w.E.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,a.jsx)(eR,{title:null!=s?s:t,complete:l}),(0,a.jsxs)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:[0===r?(0,a.jsx)(Z.Z,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,a.jsx)(Z.Z,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:r}}),(0,a.jsx)(eC.T,{size:12,className:"text-text-300"})]})]})}function eO(e){let{status:t,allSnippets:s,onOpenSources:n}=e,[i,l]=(0,E.useState)([]);return(0,E.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,B.eB)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,a.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,a.jsx)(eT,{compassStatus:t,onOpenSources:()=>n(!0)}),s&&s.length>0&&(0,a.jsx)("div",{className:"flex flex-col gap-3",children:(0,a.jsx)(w.E.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,a.jsx)(eA,{...e,onClick:()=>n(!0,e.globalAgentIndex)},t))})})]})}function eD(e){let{data:t,onClose:s}=e,[n,i]=(0,E.useState)(!1),[l,r]=(0,E.useState)({sourcesOpen:!1}),{conversationUUID:o,organizationUUID:c,isShared:d,taskId:u}=t,{compassStatus:m}=(0,B.Oz)({organizationUUID:c,conversationUUID:o,taskId:u,isShared:d});if(!m)return null;let f=(e,t)=>{r({sourcesOpen:e,index:t})},x=void 0,h=l.sourcesOpen||n;return(0,a.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,a.jsx)(w.E.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,a.jsx)(eL,{compassStatus:m,onClose:s,onDebug:x,handleOpenSources:f})}),(0,a.jsx)("div",{className:(0,b.Z)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,a.jsx)(w.E.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:eb.J.snappyOut},className:(0,b.Z)("absolute top-0 left-0 right-0 bottom-0"),children:(0,a.jsx)(eB,{isHidden:!h,compassStatus:m,onBack:n?()=>i(!1):()=>f(!1),onClose:s,onDebug:x,isDebug:n,agentIndex:l.index})})]})}function eL(e){let{compassStatus:t,onClose:s,onDebug:n,handleOpenSources:i}=e,l=(0,z.Z)(),r=(0,B.ii)(t),o=t.status,c=(0,B.PF)(t),d=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1}))),m=y.on.indexOf(o),f=[{title:o===y.IN.Starting||o===y.IN.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:c?(0,a.jsx)(B.xL,{thought:c,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!c},{title:o===y.IN.InitiatingAgents||o===y.IN.Searching?0===d?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:d}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:d}),titleIcons:(0,a.jsx)(B.AS,{hrefs:(0,B.eB)({agents:t.agents,n:3})}),children:t.agents.length>1?(0,a.jsx)(eO,{allSnippets:u,status:t,onOpenSources:i}):void 0,shown:m>=2,expandable:u.length>0},{title:o===y.IN.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:m>=4,expandable:!1}],x=f.filter(e=>e.expandable).length,h=f.findLastIndex(e=>!!e.expandable),g=(0,E.useRef)(h),[p,v]=(0,E.useState)(h),[j,b]=(0,E.useState)(!0),w=(0,E.useCallback)((e,t,s)=>{b(s),t?v(e):v(0===e?1:0)},[b,v]);(0,E.useEffect)(()=>{h!==g.current&&w(h,!0,!1)},[w,h]);let _=[y.IN.Cancelled,y.IN.Failed,y.IN.TimedOut].includes(t.status),N=f.filter(e=>e.shown).length;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,a.jsx)(eF,{onClose:s,onDebug:n,title:r,className:"font-medium"}),(0,a.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[f.map((e,s)=>{let{expandable:n,shown:i,title:l,titleIcons:r,children:o}=e,c=_||s<N-1||t.status===y.IN.Completed;return(0,a.jsx)(eU,{title:l,titleIcons:r,noShimmer:c||_,complete:c,isExpanded:n&&p===s,snappyTransition:j,showLine:s<N-1||_||p===s,handleExpand:e=>w(s,e,!0),expandable:n,collapsible:x>1,shown:i,children:o},s)}),_&&(0,a.jsx)(eU,{title:t.status===y.IN.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:eS(),shown:_})]})]})}function eU(e){let{title:t,titleIcons:s,complete:n,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:c,snappyTransition:d,noShimmer:u,isError:m,showLine:f,children:x}=e;return!!r&&(0,a.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,a.jsx)("div",{className:(0,b.Z)("transition-all w-2.5 h-2.5 rounded-full shrink-0",m?"bg-danger-200":n?"bg-text-500":"bg-accent-main-200")}),f&&(0,a.jsx)("div",{className:(0,b.Z)("transition-all h-full -mb-1 w-[1px]",n?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>c(!o),disabled:!i||o&&!l,children:(0,a.jsxs)("h4",{className:(0,b.Z)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",m&&"!text-danger-200"),children:[u?t:(0,a.jsx)(ey.g,{children:t}),!!s&&(0,a.jsx)("div",{className:(0,b.Z)("transition-all",o?"opacity-0":"opacity-100"),children:s})]})}),(0,a.jsx)(eE.jE,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:d,className:"!max-h-none w-full",setIsExpanded:c,children:x})]})]})}function eP(e){var t;let{group:s,isHidden:n}=e;if("web_fetch"===s.toolName){let e=s.query;return(0,a.jsx)(eE.hZ,{isDisabled:n,isStreaming:!1,icon:(0,a.jsx)(ev.s,{fadeInOnLoad:!0,url:e,size:16}),text:(0,a.jsx)(Z.Z,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:e,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryIcon:(0,a.jsx)(ek.O,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return(0,a.jsx)(ez.i,{integrationName:s.toolName,icon:(0,a.jsx)(B.xD,{name:s.toolName}),message:s.query,isExpandingDisabled:n,result:s.output,isStreaming:!1,isError:!1,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null===(t=s.output)||void 0===t?void 0:t.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0})}function eB(e){var t;let{isHidden:s,compassStatus:n,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:c}=e,d=(0,E.useRef)(null),u=(0,z.Z)(),m=c?!!(null===(t=n.agents[c])||void 0===t?void 0:t.completed_at):n.status===y.IN.Completed,f=void 0===c?null:n.agents[c].description||n.agents[c].name,{queryGroups:x,totalSourcesCount:h}=function(e,t){let s=[],n=0;for(let i of t?[e.agents[t]]:e.agents)for(let e of i.annotated_snippets)for(let t of e.tool_calls)try{if(t.output)n+="rich_content"===t.output.type?t.output.content.length:1,s.push({query:t.tool_name,timestamp:e.complete&&i.completed_at||i.started_at,output:t.output,toolName:t.tool_name});else if("web_fetch"===t.tool_name&&t.tool_input){var a;let l=null===(a=t.metadata)||void 0===a?void 0:a[0];l&&(s.push({query:l,timestamp:e.complete&&i.completed_at||i.started_at,toolName:t.tool_name}),n++)}}catch(e){}return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),{queryGroups:s,totalSourcesCount:void 0===t?e.total_sources:n}}(n,c);return(0,a.jsxs)("div",{inert:s?"":void 0,className:(0,b.Z)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,a.jsx)(eF,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:m?"":(0,a.jsx)(Z.Z,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{d.current&&(d.current.scrollTop=0)},500),r()}}),(0,a.jsxs)("div",{ref:d,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!f&&(0,a.jsx)(eR,{title:f,complete:m,className:"pt-1 pb-5"}),x.length>0?(0,a.jsx)("div",{className:"flex flex-col gap-4",children:x.map((e,t)=>(0,a.jsx)(eP,{group:e,isHidden:s},t))}):(0,a.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,a.jsx)(Z.Z,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}s(18187);var eH=s(22269);s(71844),s(5161),s(58865);var eJ=s(3053),eW=s(27895);s(1679);var eq=s(5984),eG=s(45033),eK=s(52939),eY=s(96346),eV=s(85689),eX=s(58183),eQ=s(89846),e$=s.n(eQ),e0=s(67587),e1=s(98753),e2=s(87150),e5=s(18999),e3=s(77879),e4=s(48894);let e6=e=>{let{contentId:t,showFullPath:s=!0}=e;if(!(0,$.Wx)(t))return null;let{pathComponents:n}=(0,$.Xp)(t);return s?(0,a.jsx)("span",{className:"flex gap-0.5 items-center",children:n.map((e,t)=>(0,a.jsxs)(E.Fragment,{children:[0!==t&&(0,a.jsx)(eC.T,{size:"10",className:"mt-0.5 text-text-500"}),(0,a.jsx)("span",{className:(0,b.Z)(t<n.length-1&&"opacity-70"),children:e})]},"".concat(e,"-").concat(t)))}):(0,a.jsx)(p.u,{tooltipContent:n.join("/"),children:(0,a.jsx)("span",{children:n[n.length-1]})})};var e7=s(11607),e8=s(8927),e9=s(87590),te=s.n(e9),tt=s(34326),ts=s(8628);function tn(e,t){let s=0;if(!e.children&&(0,tt.VG)(t,e.path))return 1;if(e.children)for(let n of e.children.values())s+=tn(n,t);return s}let ta=e=>{let{directoryName:t,listFiles:s,openedFiles:n,onSubmit:i}=e,[l,r]=(0,E.useState)(),[o,c]=(0,E.useState)("/"),d=(0,E.useMemo)(()=>{let e={};for(let t of n)if("string"==typeof t){let{pathComponents:s}=(0,$.Xp)(t);e["/"+s.join("/")]="include"}return e},[n]),[u,m]=(0,E.useState)(d),f=(0,E.useMemo)(()=>!te()(d,u),[d,u]);(0,E.useEffect)(()=>{s().then(e=>{r(function(e){let t={name:"",path:"/",size:0,children:new Map};for(let s of e){let{pathComponents:e}=(0,$.Xp)(s);if(0===e.length||1===e.length&&s.endsWith("/"))continue;let n=t;for(let t=0;t<e.length;t++){let a=e[t];if(!a)continue;let i=t===e.length-1,l="/"+e.slice(0,t+1).join("/");i?s.endsWith("/")||n.children.set(a,{name:a,path:l,size:0}):(n.children.has(a)||n.children.set(a,{name:a,path:l.endsWith("/")?l:l+"/",size:0,children:new Map}),n=n.children.get(a))}}return t}(e))})},[s]);let x=(0,E.useCallback)(()=>{if(!l)return;let e=function e(t,s){let n=[];if(!t.children&&(0,tt.VG)(s,t.path)&&n.push(t.path),t.children)for(let a of t.children.values())n.push(...e(a,s));return n}(l,u),t=n[0],{projectUuid:s,directoryUuid:a,directoryName:r}=(0,$.Xp)(t);i(e.map(e=>"file://".concat(s,"/").concat(a,"/").concat(r).concat(e)))},[l,u,n,i]);return l?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"rounded-xl border-0.5 border-border-300 bg-bg-000 shadow-sm h-[600px] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 px-4 border-b-0.5 border-border-300 h-16",children:[(0,a.jsx)("p",{className:"text-sm text-text-400",children:"Select which files to include..."}),(0,a.jsx)(e8.M,{children:f&&(0,a.jsx)(w.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",damping:20,stiffness:400},children:(0,a.jsx)(ej.z,{size:"sm",onClick:x,children:"Update"})})})]}),(0,a.jsx)(ts.o,{repo:t,rootNode:l,filters:u,setFilters:m,currentDirectory:o,setCurrentDirectory:c}),(0,a.jsx)("div",{className:"flex text-xs items-center justify-between border-border-300 border-t-0.5 py-2 px-4 text-text-300",children:l&&u&&Object.keys(u).length>0?(0,a.jsxs)("p",{children:[tn(l,u)," ",(0,a.jsx)(Z.Z,{defaultMessage:"{count, plural, one {file} other {files}}",id:"pGWzhe74G/",values:{count:tn(l,u)}})," ","selected"]}):(0,a.jsx)("p",{children:"Select files to add to chat context"})})]})}):(0,a.jsx)(ti,{})},ti=()=>(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 h-full bg-bg-000 shadow-sm text-sm text-text-300",children:[(0,a.jsx)("div",{children:(0,a.jsx)(e7.Loading,{size:"sm"})}),"Fetching directory contents..."]});var tl=s(82780);let tr=e=>{let{contentId:t,fetchFileContent:s,latestHash:n,className:i}=e,{getInstance:l}=(0,H.s)(),[r,o]=(0,E.useState)(),[c,d]=(0,E.useState)(!0),u=l(t);return((0,E.useEffect)(()=>{let e=!0,n=async()=>{d(!0);let n=await s(t);e&&o(n),e&&d(!1)};return u&&(0,er.oI)(u)?n():d(!1),()=>{e=!1}},[t,s,u,n]),!u||c)?null:(0,er.oI)(u)?r!==u.baseContent?(0,a.jsx)(p.u,{tooltipContent:"File has changed",children:(0,a.jsx)("span",{className:(0,b.Z)("text-danger-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,a.jsx)(tl.o,{size:32,weight:"duotone"})})}):(0,a.jsx)(p.u,{tooltipContent:"Unsaved changes",children:(0,a.jsx)("div",{className:(0,b.Z)("text-accent-secondary-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,a.jsx)(tl.o,{size:32,weight:"duotone"})})}):null},to=e=>{let{directoryName:t,isStreaming:s,changesMode:n,selectedContentId:i,fetchFileContent:l,saveContent:r,onCreateEditor:o,canEdit:c,latestHash:d,onOpen:u,onClose:m,onCreateNewFile:f,openedFiles:x,listFiles:h}=e,{mode:g}=(0,e0.F)(),{getInstance:p,setBaseContent:v}=(0,H.s)(),j=p(i),y=!!j&&(0,er.oI)(j),[w,_]=(0,E.useState)(!1),N=(0,E.useCallback)(()=>{_(!!j&&(0,er.oI)(j))},[j]);(0,E.useEffect)(()=>{N()},[N,y]);let C=(0,E.useCallback)(e=>{j&&e.docChanged&&N()},[N,j]),{dispatchChatResource:k}=(0,W.Y)(),M=(0,E.useRef)(""),S=(0,E.useCallback)(async()=>{let e=await l(i);if(!w){let t=null==j?void 0:j.view;t&&e!==(0,er.li)(j)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:e}})}e&&v(i,e)},[l,j,i,v,w]),z=(0,E.useCallback)(()=>{_(!1),r(i).then(e=>{e||_(!0)})},[r,i]),Z=(0,E.useCallback)(()=>{j&&j.view.dispatch({changes:{from:0,to:j.view.state.doc.length,insert:j.baseContent}})},[j]),{value:F,toggle:I}=(0,e3.kt)(!1),T=(0,E.useCallback)(I,[I]),{setIsDrawerExpanded:R}=(0,e4.b)(),A=(0,E.useCallback)(e=>{let t=x.filter(t=>!e.includes(t)),s=e.filter(e=>!x.includes(e));Promise.all([...t.map(e=>m(e)),...s.map(e=>u(e))]).then(()=>{I()})},[u,m,x,I]);return(0,E.useEffect)(()=>{if(!c)return;let e=new AbortController;return(async()=>{if("string"!=typeof d){K.v("latestHash is not a string",d);return}M.current||(M.current=""),M.current===d&&d||w||(await S(),e.signal.aborted||(M.current=d))})(),()=>{e.abort()}},[c,S,j,d,i,w]),(0,a.jsxs)("div",{className:"flex flex-col min-h-0 min-w-0 bg-bg-300 w-full",children:[(0,a.jsxs)("div",{className:(0,b.W)("flex-none w-full flex items-center justify-between pl-3 pr-2 py-2 border-b-0.5 border-border-300 text-sm font-mono",{"h-12":!n}),children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[n?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)(eG.Lt,{align:"start",trigger:(0,a.jsxs)(ej.z,{size:"icon_sm",variant:"ghost",className:"overflow-visible",children:[(0,a.jsx)(e1.a,{}),(0,a.jsx)("div",{className:"border-0.5 border-border-300 bg-bg-100 text-text-400 absolute -right-0.5 -top-0.5 flex h-[1.15rem] min-w-[1.15rem] items-center justify-center rounded-full px-[0.15rem] text-center text-[0.5rem] font-medium",children:x.length})]}),children:[x.map(e=>(0,a.jsxs)(eG.hP,{onSelect:()=>{if((0,$.Wx)(e))return k({type:"SELECT_SYNCED_DIRECTORY",id:e})},children:[(0,a.jsxs)("div",{className:"flex gap-1.5 items-center text-sm font-mono w-full",children:[(0,a.jsx)("div",{className:"w-4 h-4",children:e===i&&(0,a.jsx)(eV.J,{})}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-between gap-2 text-xs h-6",children:(0,a.jsx)(e6,{contentId:e})})]}),(0,a.jsx)("div",{className:"flex items-center justify-center h-6",children:(0,a.jsx)(tr,{className:"m-2",contentId:e,fetchFileContent:l})})]},e)),(0,a.jsx)(eG.u2,{}),(0,a.jsx)(eG.hP,{className:"text-sm",onSelect:()=>f(),children:(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,a.jsx)(e2.F,{}),"Create new file..."]})}),(0,a.jsx)(eG.hP,{className:"text-sm",onSelect:T,children:(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,a.jsx)(e2.F,{}),"Add existing file..."]})})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"font-mono text-xs",children:(0,a.jsx)(e6,{contentId:i})}),(0,a.jsx)(tr,{className:"ml-2",fetchFileContent:l,contentId:i,latestHash:d})]})]}),(0,a.jsx)("div",{className:"flex gap-1 items-center",children:n?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)(a.Fragment,{children:[w&&(0,a.jsx)(ej.z,{variant:"primary",size:"sm",className:"text-xs rounded-md px-2 py-1",onClick:z,disabled:!c,children:"Save"}),(0,a.jsxs)(eG.Lt,{align:"end",trigger:(0,a.jsx)(ej.z,{size:"icon_sm",variant:"ghost",children:(0,a.jsx)(e5.x,{})}),children:[(0,a.jsx)(eG.hP,{className:"text-sm",onClick:Z,disabled:!w||!c,children:"Discard unsaved changes"}),(0,a.jsx)(eG.hP,{className:"text-sm",onClick:()=>m(i),disabled:!c,children:"Remove this file"})]}),(0,a.jsx)(ej.z,{size:"icon_sm",variant:"ghost",onClick:()=>R(!1),children:(0,a.jsx)(eN.X,{})})]})})]}),(0,a.jsx)("div",{className:"flex flex-1 min-h-0 min-w-0 relative font-mono",children:(0,a.jsx)(ei,{fetchFileContent:l,isStreaming:s,selectedContentId:i,readOnly:!c,theme:"auto"===g?"dark":g,onUpdate:C,onCreateEditor:e=>null==o?void 0:o(i,e)})}),(0,a.jsx)(eK.u_,{isOpen:F,onClose:I,hasCloseButton:!0,autoCloseOnFocusOut:!1,title:"Add a file from ".concat(t),subtitle:"Selected files will be included in the conversation",modalSize:"xl",children:(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(ta,{listFiles:h,openedFiles:x,directoryName:t,onSubmit:A})})})]})};var tc=s(44506);let td=e=>{let{openContentIds:t,fetchFileContent:s}=e,{syncedDirectories:n,projectDocs:a}=(0,eu.b)(),[i,l]=(0,E.useState)(new Map),[r,o]=(0,E.useState)(!0);return(0,E.useEffect)(()=>{r&&(async()=>{o(!1);let e=new Map;for(let n of t){let t=await s(n);if(void 0===t)continue;let a=await (0,tc.G)(t||"");e.set(n,a)}l(e)})()},[t,r,n,a,s]),(0,E.useEffect)(()=>{let e=()=>{o(!0)};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),{latestHashes:i,refreshHashes:()=>o(!0)}},tu=e=>{let{directoryName:t,isStreaming:s,selectedContentId:n,openedFiles:i,onOpen:l,onSaveAllContents:r,onSaveContent:o,onCloseFile:c,fetchFileContent:d,listFiles:u,children:m}=e,f=(0,eX.useDynamicConfig)("harmony_product_strings"),{getInstance:x,setBaseContent:h,unregisterEditor:g,changesMode:p,activeEditors:v,acceptAllChanges:j,rejectAllChanges:y,deactivateChangesMode:w}=(0,H.s)(),[_,N]=(0,E.useState)(new Map),[C,k]=(0,E.useState)(!1),[M,S]=(0,E.useState)(""),{dispatchChatResource:z}=(0,W.Y)();(0,E.useEffect)(()=>{N(e=>{let t=new Map(e);for(let e of i)t.delete(e);return t})},[i]);let Z=(0,E.useMemo)(()=>e$()([...i,...Array.from(_.keys())]),[i,_]),[F,I]=(0,E.useState)(!1),{latestHashes:T,refreshHashes:R}=td({fetchFileContent:d,openContentIds:new Set(Z)}),A=(0,E.useMemo)(()=>n&&T.get(n)||"",[T,n]),O=(0,E.useMemo)(()=>!!n&&Z.includes(n),[Z,n]),D=async e=>{if(!Z.includes(e)){I(!0);try{await l(e)}finally{I(!1)}}},L=async e=>{let t=x(e);if(!t)throw Error("Instance not found for file: ".concat(e));if(_.has(e)){window.confirm(f.get("editor_unsaved",""))&&(g(e),N(t=>{let s=new Map(t);return s.delete(e),s}));return}if(!(0,er.oI)(t)||window.confirm(f.get("editor_unsaved",""))){I(!0);try{g(e),await c(e)}finally{I(!1)}}},{saveContent:U,saveAllContents:P}=function(e){let{setLoading:t,refreshHashes:s,getInstance:n,setBaseContent:a}=e,i=(0,E.useRef)({pendingOperation:null,contentToUpdate:new Map}),l=(0,E.useCallback)(async(e,n)=>{let{pendingOperation:l}=i.current;l&&(l.abort(),K.f("Aborting previous save operation"));let r=new AbortController;i.current={pendingOperation:r,contentToUpdate:n},t(!0);let o=await Promise.race([e(),new Promise((e,t)=>{r.signal.addEventListener("abort",()=>t(Error("Save aborted")))})]);for(let[e,t]of(K.f("Save operation completed",{filesProcessed:n.size,results:o}),o))if(t){let t=n.get(e);t&&a(e,t)}return!r.signal.aborted&&s&&setTimeout(s,1),t(!1),i.current.pendingOperation===r&&(i.current.pendingOperation=null),o},[t,a,s]);return{saveContent:(0,E.useCallback)(async(e,t)=>{let s=n(e);return s?l(async()=>new Map([[e,await t()]]),new Map([[e,(0,er.li)(s)]])):new Map([[e,!1]])},[l,n]),saveAllContents:(0,E.useCallback)(async(e,t)=>{if(!e||0===e.size)return K.v("No save options provided"),new Map;let s=new Map,a=new Map;for(let[t,i]of e.entries()){if(!n(t)||!i.content){K.v("No instance or content found for contentId ".concat(t,". Skipping."));continue}s.set(t,i.content),a.set(t,i)}if(0===s.size)return K.v("No valid files to save"),new Map;let i=await l(()=>t(a),s);return K.f("Save all operation completed",{success:i,filesProcessed:s.size,totalFiles:e.size}),i},[l,n])}}({setLoading:I,refreshHashes:R,getInstance:x,setBaseContent:h}),B=(0,E.useCallback)(e=>{let{projectUuid:t,directoryUuid:s,directoryName:n}=(0,$.Xp)(i[0]);if(!e){k(!0);return}if(!e)return;if(/[<>:"\\|?*\x00-\x1F]/.test(e)){alert("Filename contains invalid characters");return}if(e.startsWith(".")||e.startsWith("~")||"CON"===e||"PRN"===e||"AUX"===e||"NUL"===e){alert("Invalid filename");return}if(e.length>255){alert("Filename is too long");return}let a="file://".concat(t,"/").concat(s,"/").concat(n,"/").concat(e);if(i.includes(a)){alert("A file with this name already exists");return}N(e=>{let t=new Map(e);return t.set(a,""),t}),z({type:"SELECT_SYNCED_DIRECTORY",id:a})},[z,i]),J=async(e,t)=>{void 0===await d(e)&&_.has(e)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:_.get(e)},annotations:[G.YW.addToHistory.of(!1)]})},q=async e=>{let t;let s=new Map;if(e.forEach(e=>{let t=x(e);if(t&&(0,er.oI)(t))s.set(e,{content:(0,er.li)(t),baseContent:t.baseContent,isDeletedFile:t.filePendingDeletion});else if(!t)throw Error("Instance not found for file: ".concat(e))}),0===s.size)return new Map;if(1===e.length){let n=e[0];t=await U(n,()=>o(n,s.get(n)))}else t=await P(s,r);return await Promise.all(t.entries().map(async e=>{let[t,n]=e;n||void 0!==await d(t)||N(e=>{var n,a;let i=new Map(e);return i.set(t,null!==(a=null===(n=s.get(t))||void 0===n?void 0:n.content)&&void 0!==a?a:""),i})})),t},Y=async()=>{if(!n)throw Error("No content selected to save");return(await q([n])).get(n)},V=async()=>{for(let e of(j(),v)){let t=x(e);t&&void 0===await d(e)&&N(s=>{let n=new Map(s);return n.set(e,(0,er.li)(t)),n})}w()};tm(async()=>await q(Z),q,n);let X=(0,a.jsxs)(ej.z,{variant:"primary",size:"sm",disabled:s,children:["Review changes ",(0,a.jsx)(eY.p,{})]}),Q=e=>{let{Icon:t,title:s,description:n}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-0.5 w-64 p-0.5 pb-1",children:[(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[t&&(0,a.jsx)(t,{size:16}),(0,a.jsx)("div",{className:"text-sm font-light",children:s})]}),(0,a.jsxs)("div",{className:"flex gap-1.5 items-start",children:[(0,a.jsx)("div",{className:"h-1 w-4 flex-shrink-0",children:"\xa0"}),(0,a.jsx)("div",{className:"text-xs text-text-500 whitespace-normal",children:n})]})]})},ee=E.Children.toArray(m).find(e=>(0,E.isValidElement)(e)&&e.type===tu.Footer);return(0,a.jsxs)("div",{className:(0,b.Z)("flex flex-col w-full h-full max-h-full bg-bg-200",{hidden:!p&&!O}),children:[(0,a.jsxs)("div",{className:"relative flex-1 flex flex-col overflow-hidden",children:[p&&(0,a.jsxs)("div",{className:"flex-none flex items-center border-b-0.5 border-border-300 sticky top-0 z-10",children:[(0,a.jsx)("div",{className:"flex items-center flex-1 pl-1.5 gap-1.5",children:f.get("editor_changes_title","")}),(0,a.jsx)("div",{className:"flex gap-2 items-center p-2",children:(0,a.jsxs)(eG.Lt,{unstyledTrigger:!0,trigger:X,align:"end",children:[(0,a.jsx)(eG.hP,{onSelect:()=>{j(),q(v).finally(w)},children:(0,a.jsx)(Q,{Icon:eV.J,title:f.get("editor_changes_save_cta",""),description:f.get("editor_changes_save_description","")})}),(0,a.jsx)(eG.hP,{onSelect:V,children:(0,a.jsx)(Q,{Icon:eV.J,title:f.get("editor_changes_apply_cta",""),description:f.get("editor_changes_apply_description","")})}),(0,a.jsx)(eG.u2,{}),(0,a.jsx)(eG.hP,{onSelect:()=>{y(),w()},children:(0,a.jsx)(Q,{Icon:eN.X,title:f.get("editor_changes_decline_cta",""),description:f.get("editor_changes_decline_description","")})})]})})]}),(0,a.jsx)("div",{className:(0,b.Z)("flex-1 flex min-h-0 w-full flex-col",p&&"p-3 gap-3 overflow-y-scroll"),children:Z.map(e=>(0,a.jsx)("div",{className:(0,b.Z)("w-full",p?"flex-none overflow-hidden border-border-400 border rounded-xl":"flex h-full",{hidden:p&&!v.includes(e)||!p&&n!==e}),children:(0,a.jsx)(to,{directoryName:t,isStreaming:s,changesMode:p,selectedContentId:e,saveContent:Y,onCreateEditor:J,canEdit:!F,latestHash:A,fetchFileContent:d,listFiles:u,onOpen:D,onClose:L,onCreateNewFile:B,openedFiles:Z})},e))})]}),ee,(0,a.jsx)(eK.u_,{isOpen:C,onClose:()=>{k(!1),S("")},title:f.get("editor_new_file_title","Create New File"),modalSize:"sm",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 mt-3",children:[(0,a.jsx)(eq.oi,{autoFocus:!0,value:M,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key&&M&&(B(M),k(!1),S(""))},placeholder:f.get("editor_new_file_placeholder","Enter file name")}),(0,a.jsxs)(eK.dm,{children:[(0,a.jsx)(ej.z,{variant:"secondary",onClick:()=>{k(!1),S("")},children:f.get("editor_new_file_cancel","Cancel")}),(0,a.jsx)(ej.z,{variant:"primary",disabled:!M,onClick:()=>{B(M),k(!1),S("")},children:f.get("editor_new_file_create","Create")})]})]})})]})};tu.Footer=e=>{let{children:t,className:s}=e;return(0,a.jsx)(ep.$G,{className:s,children:t})};let tm=(e,t,s)=>{(0,E.useEffect)(()=>{let n=n=>{n.metaKey&&"s"===n.key&&(n.preventDefault(),n.shiftKey?e():s&&t([s]))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,t,s])};function tf(e,t){let{projectUuid:s,directoryUuid:n}=(0,$.Xp)(t);return(0,$.wq)(e,s,n)}async function tx(e,t,s){let n=tf(e,t);return await (0,$.cn)(n,t,s),"NewFileCreated"}async function th(e,t){try{let s=tf(e,t);return await (0,$._I)(s,t),"FileDeleted"}catch(e){return"NoChange"}}async function tg(e,t,s){let{isDeletedFile:n,content:a,baseContent:i}=s,{file:l}=(0,$.sy)(e,t);if(l){if(n)return await th(e,t);{if(!a||!i)throw Error("Content and base content is required for existing file");let s=await (0,em.Jl)(e,t);return s&&i!==s&&!confirm("The file content has changed since you’ve last edited. Do you want to overwrite it?")?"NoChange":(await (0,$.NC)(l,a),"ExistingFileEdited")}}if(n)throw Error("File to delete does not exist");if(void 0===a)throw Error("Content is required for new file");return await tx(e,t,a)}var tp=s(85017);let tv=e=>{let{isStreaming:t,directoryUri:s,selectUri:n,onClose:i,suggestedChanges:l}=e,{track:r}=(0,eJ.z$)(),{addError:o}=(0,eW.e)(),{openedFiles:c,projectDocs:d,projectUuid:u,syncedDirectories:m}=(0,eu.b)(),{mutateAsync:f}=(0,T.u3)(u),{mutateAsync:x}=(0,T.Zy)(u),{mutateAsync:h}=(0,T.ER)(u),{directoryUuid:g,directoryName:p,pathComponents:v}=(0,E.useMemo)(()=>{if(!s)return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]};try{return(0,$.Xp)(s)}catch(e){return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]}}},[s]),j=(0,E.useMemo)(()=>v.length>1||1===v.length&&""!==v[0]?s:void 0,[s,v]),y=(0,E.useCallback)(async e=>{if(!(0,$.Wx)(e))throw Error("Not a local file: ".concat(e));await (0,em.xF)(m,d,f,x,e)},[m,d,f,x]),b=(0,E.useCallback)(async e=>{if(!(0,$.Wx)(e))throw Error("Not a local file: ".concat(e));if(j===e){let t=c.find(t=>t!==e);if(t)n(t);else{let{projectUuid:t,directoryUuid:s,directoryName:a}=(0,$.Xp)(e);n("file://".concat(t,"/").concat(s,"/").concat(a,"/"))}}await (0,em.cM)(d,e,h)},[j,d,h,c,n]),w=(0,E.useCallback)(async(e,t)=>{if(!(0,$.Wx)(e))throw Error("Not a local file: ".concat(e));try{let s=await tg(m,e,t);if(r({event_key:"harmony.file.saved",save_result:s}),"NewFileCreated"===s){let{directoryUuid:t}=(0,$.Xp)(e),s=m.find(e=>e.uuid===t);s&&await (0,tp.U4)(s),await y(e)}else"FileDeleted"===s&&await b(e);return"NoChange"!==s}catch(t){if(t&&"object"==typeof t&&"name"in t&&(null==t?void 0:t.name)==="AbortError")throw t;return o((0,a.jsxs)(a.Fragment,{children:["Unable to save"," ",(0,a.jsx)("span",{className:"font-bold ml-2",children:ee(e)})]})),!1}},[m,r,y,b,o]),_=(0,E.useMemo)(()=>Array.from(new Set([...c,...Array.from(l.values()).flat().filter(e=>"create"===e.type).map(e=>e.contentId)])),[c,l]),N=(0,E.useCallback)(async e=>{let t=new Map;for(let s of _)try{let n=e.get(s);if(!n){K.v("No save options found for contentId ".concat(s,". Skipping save.")),t.set(s,!1);continue}let a=await w(s,n);t.set(s,a)}catch(e){K.v("Error handling file ".concat(s,":"),e),t.set(s,!1)}for(let e of m)await (0,tp.U4)(e);return t},[_,w,m]),C=(0,E.useCallback)(async e=>{if(!(0,$.Wx)(e))throw Error("Not a local file: ".concat(e));try{var t;return null!==(t=await (0,em.Jl)(m,e))&&void 0!==t?t:void 0}catch(e){return}},[m]),k=(0,E.useCallback)(async()=>{if(!g)throw Error("No directoryUuid");let e=await (0,tp.sN)(g);if(!e)throw Error("No syncedDirectory");return(await (0,$.O)(e)).map(e=>e.uri)},[g]);return(0,a.jsx)(tu,{directoryName:null!=p?p:"",isStreaming:t,selectedContentId:j,onClose:i,openedFiles:_,onOpen:y,onSaveContent:w,onSaveAllContents:N,onCloseFile:b,fetchFileContent:C,listFiles:k,children:(0,a.jsx)(tu.Footer,{children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(eH.n,{projectUuid:u,size:"small",tooltipContent:"Total code included in context is currently limited to Claude’s maximum context window size."})})})})};var tj=s(74550),ty=s(69735),tb=s(49167),tw=s(50106),t_=s(21535),tN=s(22027),tC=s(86518);let tk=e=>{let{type:t,size:s,className:n,isLoading:i=!1}=e;return(0,a.jsx)("div",{className:(0,b.Z)("bg-bg-100 text-text-500 flex items-center justify-center rounded-l-[inherit]","default"===s&&"w-14","sm"===s&&"w-11",n),children:i?(0,a.jsx)(e7.Loading,{size:"sm"}):(0,a.jsx)(()=>{switch(t){case v.JP.Markdown:return(0,a.jsx)(tw.X,{size:24});case v.JP.Svg:return(0,a.jsx)(t_.j,{size:24});case v.JP.Html:return(0,a.jsx)(tN.T,{size:24});case v.JP.Code:case v.JP.Text:default:return(0,a.jsx)(tC.E,{size:24})}},{})})};var tM=s(98555);let tS=e=>{let{artifact:t,onClick:s,size:n="default"}=e,i=(0,tM.t)(),l=(0,a.jsx)(Z.Z,{defaultMessage:"Click to open {artifactType} • {versionCount, plural, one {# version} other {# versions}}",id:"fBoEKmAB/j",values:{artifactType:i[t.type],versionCount:t.versions.length}});return(0,a.jsx)(tE,{previewContent:(0,a.jsx)(tk,{type:t.type,size:n}),title:t.title||(0,a.jsx)(Z.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}),metaContent:l,onClick:s,size:n,index:0})},tE=e=>{let{previewContent:t,title:s,metaContent:n,size:i,onClick:l,onRemove:r,index:o}=e,c=(0,z.Z)(),d=l?"button":"div";return(0,a.jsxs)("div",{className:(0,b.Z)("relative","sm"===i&&"max-w-[16rem]"),children:[r&&(0,a.jsx)("button",{className:"bg-bg-000 hover:bg-bg-300 shadow-element absolute right-0 top-0 z-10 -translate-y-2 translate-x-2 cursor-pointer rounded-full p-1",onClick:e=>{e.stopPropagation(),r(o)},children:(0,a.jsx)(eN.X,{size:11,weight:"bold"})}),(0,a.jsxs)(d,{className:(0,b.Z)("border-0.5 border-border-300 bg-bg-000 flex flex-1 items-stretch overflow-hidden rounded-lg text-left transition-all","default"===i&&"w-full",!r&&"hover:border-border-200 hover:drop-shadow-sm",!r&&l&&"active:scale-[0.9875]"),onClick:l,disabled:!l,"aria-label":c.formatMessage({defaultMessage:"Preview contents",id:"hmKJSoIQ4a"}),children:[t,(0,a.jsxs)("div",{className:(0,b.Z)("padding min-w-0 flex-1 pl-3 pr-2","default"===i&&"py-3","sm"===i&&"py-2"),children:[(0,a.jsx)("div",{className:(0,b.Z)("break-words text-sm font-medium leading-tight","default"===i&&"line-clamp-2 font-medium","sm"===i&&"line-clamp-1"),children:s}),n&&(0,a.jsx)("div",{className:"text-text-400 line-clamp-1 text-xs",children:n})]})]})]})};var tz=s(52165),tZ=s(56971),tF=s(45571),tI=s(62576),tT=s(84927),tR=s(62676),tA=s(6092),tO=s(26608),tD=s(74884);let tL=e=>{let{directoryUri:t,removeSyncedDirectory:s,isExpanded:n,setIsExpanded:i}=e,{directoryName:l}=(0,$.Xp)(t),{files:r}=(0,eu.b)(),o=r.filter(e=>(0,$.zE)(e)&&e.uri.startsWith(t)).length,c=e=>{e.stopPropagation(),i(e=>!e)};return(0,a.jsxs)("div",{className:(0,b.Z)("group flex items-center gap-2 rounded-lg py-0.5 transition-colors ","lg:hover:bg-bg-500/10"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 text-left pl-2",onClick:c,children:[(0,a.jsx)(ej.z,{variant:"unstyled",size:"icon_xs",onClick:c,children:n?(0,a.jsx)(tR.P,{size:16}):(0,a.jsx)(tA.g,{size:16})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1 flex flex-col gap-0.5",children:[(0,a.jsx)("div",{className:"line-clamp-2 break-words text-sm",children:l}),(0,a.jsx)("p",{className:"text-xs text-text-400",children:(0,a.jsx)(Z.Z,{defaultMessage:"{count, plural, one {# file} other {# files}}",id:"Lf81FX5U/k",values:{count:o}})})]})]}),(0,a.jsx)("div",{className:(0,b.Z)("transition-opacity group-hover:opacity-100","lg:opacity-0"),children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(p.u,{tooltipContent:"Remove directory",children:(0,a.jsx)(ej.z,{size:"icon_sm",variant:"ghost",onClick:()=>s(t),"aria-label":"Remove directory",children:(0,a.jsx)(tO.r,{size:16})})})})})]})},tU=e=>{let{file:t,onSelect:s,closeFile:n}=e,{pathComponents:i}=(0,$.Xp)(t);return(0,a.jsxs)("div",{className:"group flex items-center flex-1 pl-8 lg:pr-3",children:[(0,a.jsxs)(ej.z,{size:"unset",variant:"unstyled",className:"flex items-center gap-2 flex-1 w-full !justify-start",onClick:s,children:[(0,a.jsx)(tD.E,{}),(0,a.jsx)("div",{className:"text-sm text-text-200 flex items-center gap-[1px]",children:i.map((e,t)=>{let s=i.length-1===t;return(0,a.jsxs)(E.Fragment,{children:[(0,a.jsx)("span",{className:s?"":"text-text-500",children:e},e),!s&&(0,a.jsx)("span",{className:"text-text-400",children:"/"})]},"".concat(e,"-").concat(t))})})]}),(0,a.jsx)("div",{className:(0,b.Z)("transition-opacity group-hover:opacity-100 flex items-center gap-2","lg:opacity-0"),children:(0,a.jsx)(p.u,{tooltipContent:"Close file",children:(0,a.jsx)(ej.z,{size:"icon_sm",variant:"ghost",onClick:n,"aria-label":"Close file",children:(0,a.jsx)(eN.X,{size:16})})})})]})},tP=e=>{let{directory:t,removeSyncedDirectory:s,closeFile:n,onSelect:i}=e,[l,r]=(0,E.useState)(!1),{projectDocs:o}=(0,eu.b)(),c=(0,E.useMemo)(()=>o.filter(e=>(0,em.lz)(e,t)),[t,o]);return(0,a.jsxs)(w.E.li,{className:"overflow-hidden",exit:{height:0,opacity:0},animate:{height:"auto",opacity:1},children:[(0,a.jsx)(tL,{directoryUri:t.uri,removeSyncedDirectory:s,isExpanded:l,setIsExpanded:r}),(0,a.jsx)(e8.M,{children:l&&c.length>0&&(0,a.jsx)(w.E.ul,{className:"flex flex-col",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:c.map((e,t)=>(0,a.jsx)(w.E.li,{className:"overflow-hidden flex items-center gap-2 py-2 rounded-lg lg:hover:bg-bg-500/10",initial:{opacity:0,y:-2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{delay:.025*t},children:(0,a.jsx)(tU,{file:e.file_name,onSelect:()=>null==i?void 0:i(e.file_name),closeFile:()=>n(e.file_name)})},e.uuid))})})]},t.uri)},tB=e=>{let{projectUuid:t,syncedDirectories:s,removeSyncedDirectory:n,onSelect:i}=e,{projectDocs:l}=(0,eu.b)(),{mutateAsync:r}=(0,T.ER)(t),o=(0,E.useCallback)(async e=>{await (0,em.cM)(l,e,r)},[l,r]);return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(tP,{directory:e,removeSyncedDirectory:n,closeFile:o,onSelect:i},e.uri))})};function tH(e){let{dispatchChatResource:t}=e,{projectDocs:s,projectUuid:n,setFiles:i,syncedDirectories:l,setSyncedDirectories:r}=(0,eu.b)(),{mutateAsync:o}=(0,T.ER)(n);return(0,a.jsx)(tB,{projectUuid:n,syncedDirectories:l,removeSyncedDirectory:async e=>{let t=await (0,em.wC)(l,s,o,e);r(()=>t),i(await (0,em.bE)(n))},onSelect:e=>{t({type:"SELECT_SYNCED_DIRECTORY",id:e})}})}let tJ=e=>{let{projectUuid:t,dispatchChatResource:s,docUpdates:n}=e,{value:i,setTrue:l,setFalse:r}=(0,e3.kt)(!1),{syncedDirectories:o}=(0,eu.b)(),{data:c}=(0,R.Yc)(t);return c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:c.is_harmony_project?(0,a.jsx)(Z.Z,{defaultMessage:"Local code",id:"kQFHMn6wNL"}):(0,a.jsx)(Z.Z,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,a.jsxs)("div",{className:(0,b.W)("border-border-400 rounded-lg border",c.is_harmony_project?"px-1 pt-0.5 pb-2":"px-3 py-4"),children:[!c.is_harmony_project&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(M.default,{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,a.jsx)(t_.j,{size:16,className:"text-text-300 shrink-0"}),(0,a.jsx)("div",{className:"font-tiempos text-text-200 leading-tight tracking-tight",children:c.name})]}),(0,a.jsx)("div",{children:(0,a.jsx)(tT.H,{project:c,className:"text-text-400 text-xs"})})]}),(0,a.jsx)("ul",{className:"mt-2 flex flex-col",children:o.length>0?(0,a.jsx)(tH,{dispatchChatResource:s}):(0,a.jsx)(tI.U,{isEditable:!1,project:c,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]}),""]}):null};function tW(e){let{conversationUUID:t,onClose:s,projectUuid:n}=e,{allModelOptions:i}=(0,c.uL)(),{chatResourceState:{artifacts:l,attachments:r,files:d,syncSources:u,docUpdates:m},dispatchChatResource:f}=(0,W.Y)(),x=(0,o.wN)(t),h=i.find(e=>e.model===x),{modelConfig:g}=(0,c.Ve)(x),p=g.image_in,{imageFiles:v,sanitizedDocumentFiles:y,blobFiles:b}=(0,E.useMemo)(()=>d.reduce((e,t)=>{switch(t.file_kind){case ex.Y.Image:e.imageFiles.push(t);break;case ex.Y.Blob:e.blobFiles.push(t);break;case ex.Y.SanitizedDocument:e.sanitizedDocumentFiles.push(t)}return e},{imageFiles:[],blobFiles:[],sanitizedDocumentFiles:[]}),[d]),w=Object.values(l),{value:_}=(0,j.FL)("conversation_export"),N=(0,a.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-5 text-center",children:[(0,a.jsx)("div",{className:"font-tiempos mb-1",children:(0,a.jsx)(Z.Z,{defaultMessage:"No content added yet",id:"KWvxczfvCc"})}),(0,a.jsx)("div",{className:"text-text-300 mb-1 text-xs",children:p?(0,a.jsx)(Z.Z,{defaultMessage:"Add images, PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"HJx5jgEsVM"}):(0,a.jsx)(Z.Z,{defaultMessage:"Add PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"J0WpDuvvlE"})})]});return(0,a.jsx)(tb.$,{children:(0,a.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,a.jsxs)("div",{className:"flex items-center draggable pl-7 md:pl-1 pr-0.5",children:[(0,a.jsx)("h2",{className:"font-styrene-display flex-1 text-lg font-medium",children:(0,a.jsx)(Z.Z,{defaultMessage:"Chat controls",id:"nBvhDBTi6q"})}),(0,a.jsx)(ej.z,{variant:"ghost",size:"icon",className:"-mr-2",onClick:s,children:(0,a.jsx)(eN.X,{size:20})})]}),h&&(0,a.jsxs)("div",{className:"my-2",children:[(0,a.jsx)("div",{className:"text-text-200 text-lg",children:(0,a.jsx)(tz.u,{model:h})}),(0,a.jsxs)("p",{className:"text-text-300 text-sm",children:[h.description,"\xa0",(0,a.jsx)("a",{className:"hover:text-text-000 underline",href:"https://www.anthropic.com/product",target:"_blank",rel:"noopener",children:(0,a.jsx)(Z.Z,{defaultMessage:"Learn more",id:"TdTXXf940t"})})]})]}),w.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,a.jsx)(Z.Z,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,a.jsx)("ul",{className:"mt-2 flex flex-col gap-2",children:w.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(tS,{artifact:e,onClick:()=>f({type:"SELECT_ARTIFACT",id:e.id})})},"artifact-".concat(t)))})]}),n&&(0,a.jsx)(tJ,{projectUuid:n,dispatchChatResource:f,docUpdates:m}),(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,a.jsx)(Z.Z,{defaultMessage:"Content",id:"Jq3FDzj0/T"})}),v.length+b.length+y.length+r.length+u.length>0?(0,a.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[[...v,...b,...y].map((e,t)=>(0,a.jsx)(ty.mB,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),r.map((e,t)=>(0,a.jsx)(ty.mB,{size:"stretch",file:e,handleClick:()=>f({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),u.map(e=>(0,a.jsx)(tZ.n4,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]}):N,_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-5 text-sm font-medium",children:(0,a.jsx)(Z.Z,{defaultMessage:"Export conversation",id:"GZQU9SwGHT"})}),(0,a.jsx)(tF.Dy,{conversationUUID:t})]})]})})}let tq=e=>{let{docUuid:t,projectUuid:s,goBack:n,onClose:i}=e,{data:l}=(0,T.tR)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:ex.i.UserUpload};return(0,a.jsx)(tj.c,{attachment:r,goBack:n,onClose:i})},tG=(0,E.memo)(function(e){let{conversationUUID:t,onClose:s,isStreaming:n,projectUuid:i,sendMessage:l,isOpen:r}=e,{activeOrganization:o}=(0,m.t)(),{chatResourceState:{selectedItem:c,artifacts:d,activeMessageUUID:u,docUpdates:f,attachments:x,fileEdits:h,files:g},dispatchChatResource:p}=(0,W.Y)(),{value:v}=(0,j.FL)("apps_use_turmeric"),y=null==o?void 0:o.uuid,b=(0,E.useCallback)(e=>p({type:"SELECT_SYNCED_DIRECTORY",id:e}),[p]),w=(0,E.useCallback)(e=>(0,eg.C)(e,v,y),[v,y]),_=(0,eh.i)(x,g,y,i),N=(0,E.useMemo)(()=>({claudeComplete:w,getFile:_}),[w,_]),C=(0,E.useCallback)(()=>{s()},[s]),k=(0,E.useCallback)(e=>{(null==c?void 0:c.type)==="artifact"&&p({type:"SELECT_ARTIFACT",id:c.id,versionUUID:e})},[c,p]),{changesMode:M}=(0,H.s)(),S=(0,E.useCallback)(e=>p({type:"SELECT_DOC",id:e}),[p]),z=(0,E.useCallback)(()=>p({type:"CLEAR_SELECTED"}),[p]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ep.K0,{isStreaming:n,artifact:(null==c?void 0:c.type)!=="artifact"||M?void 0:d[c.id],selectedArtifactMessageUUID:u,selectedArtifactVersionUUID:(null==c?void 0:c.type)==="artifact"?c.versionUUID:void 0,setSelectedArtifactVersionUUID:k,onClose:s,projectUuid:i,selectDoc:S,sendMessage:l,richSandboxCapabilities:N,isOpen:r}),i&&(0,a.jsx)(tv,{isStreaming:n,directoryUri:c&&"id"in c?c.id:void 0,selectUri:b,onClose:C,suggestedChanges:h}),(null==c?void 0:c.type)==="artifact"&&d[c.id]?null:(null==c?void 0:c.type)==="syncedDirectory"||M?null:(null==c?void 0:c.type)==="attachment"?(0,a.jsx)(tj.c,{goBack:()=>p({type:"CLEAR_SELECTED"}),attachment:c.attachment,onClose:s}):(null==c?void 0:c.type)==="compass"?(0,a.jsx)(eD,{data:c.data,onClose:s,goBack:z}):i&&(null==c?void 0:c.type)==="doc"?(0,a.jsx)(tq,{docUuid:c.id,projectUuid:i,onClose:s,goBack:()=>p({type:"CLEAR_SELECTED"})}):(0,a.jsx)(tW,{conversationUUID:t,onClose:s,projectUuid:i})]})});var tK=s(5751);function tY(e){let{conversationUuid:t,message:s}=e,n=(0,S.useRouter)(),i=(0,eW.e)(),[l,r]=(0,E.useState)(!1);return(0,a.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-styrene z-10 p-6 ",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,a.jsx)("div",{className:"text-lg",children:(0,a.jsx)(Z.Z,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(ej.z,{onClick:()=>n.push("/new"),children:(0,a.jsx)(Z.Z,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,a.jsx)(ej.z,{variant:"secondary",onClick:()=>r(!0),children:(0,a.jsx)(Z.Z,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,a.jsx)(tK.r,{conversationUuid:t,message:s,requestedFeedbackType:"chat_ended",setRequestedFeedbackType:()=>{},isOpen:l,onClose:()=>{r(!1)},onSuccess:()=>i.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var tV=s(91217),tX=s(7418),tQ=s(5362),t$=s(98731),t0=s(5492),t1=s(81353),t2=s(8571),t5=s(6385),t3=s(59016);function t4(){let e=(0,n._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return t4=function(){return e},e}let t6=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],t7=e=>{let{long:t}=e;return(0,a.jsx)("a",{className:"underline",href:t5.jW,target:"_blank",rel:"noreferrer",children:t?(0,a.jsx)(Z.Z,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,a.jsx)(Z.Z,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},t8={consumer_restricted_mode:[{isDismissible:!1,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,a.jsx)(t7,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,a.jsx)(t7,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,a.jsx)(t7,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Z.Z,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Z.Z,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Z.Z,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function t9(e){let{isClaudeDot:t,content:s,isDismissible:n,handleDismiss:i}=e;return(0,a.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,a.jsx)(st,{$isFloating:t,children:(0,a.jsxs)("div",{className:"items-top flex justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:s}),n&&i&&(0,a.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,a.jsx)(eN.X,{size:24})})]})})})}function se(e){let{conversationUuid:t}=e,s=(0,eJ.z$)(),n=(0,t2.Z)(),{account:i,activeOrganization:l}=(0,m.t)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:c}=(0,t3.CQ)(),{data:d}=(0,t3.$r)(null==l?void 0:l.uuid),u=(0,t2.m)().ipCountry,f=(null==d?void 0:d.active_flags)&&(null==d?void 0:d.active_flags.map(e=>e.type)),{shownFlagType:x,shownFlagDetails:h}=function(e,t){let s=t6.findIndex(e=>null==t?void 0:t.includes(e)),n=t6[s];if(!n)return{shownFlagType:null,shownFlagDetails:null};let a=t8[n].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===a.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:n,shownFlagDetails:a[0]}}(u,f);if((0,E.useEffect)(()=>{r&&o&&x&&s.track({event_key:"ts.banner.shown",flag_type:x,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,x,t,r,o,u]),!x||!h)return;let{isDismissible:g,content:p}=h,v=async()=>{if(!g)return;let e=[x];"consumer_second_warning"===x&&(null==f?void 0:f.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>c({flagType:e})))};return(0,a.jsx)(t9,{isClaudeDot:n,content:p,isDismissible:g,handleDismiss:v})}let st=h.q.div(t4(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast"),ss=e=>{var t,s,n,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:c,invalidator:d}=e,[u,m]=(0,E.useState)(0),f=(0,E.useCallback)(()=>{var e,t,s,n;let a=(null===(e=l.lastAssistantMessage.current)||void 0===e?void 0:e.clientHeight)||0,i=(null===(t=l.lastHumanMessage.current)||void 0===t?void 0:t.clientHeight)||0,r=(null===(s=l.chatInput.current)||void 0===s?void 0:s.clientHeight)||0,o=(null===(n=l.extras.current)||void 0===n?void 0:n.clientHeight)||0,c=Math.max(window.innerHeight-i-a-o-r-110,0);c!==u&&m(c)},[l,u]);return(0,E.useLayoutEffect)(()=>{f()},[d,f,null===(t=l.lastAssistantMessage.current)||void 0===t?void 0:t.clientHeight,null===(s=l.lastHumanMessage.current)||void 0===s?void 0:s.clientHeight,null===(n=l.extras.current)||void 0===n?void 0:n.clientHeight,null===(i=l.chatInput.current)||void 0===i?void 0:i.clientHeight]),(0,E.useLayoutEffect)(()=>(window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)),[f]),(0,E.useLayoutEffect)(()=>{r&&(setTimeout(()=>{var e;null===(e=c.current)||void 0===e||e.scrollToBottomIfPinned("smooth")},0),o(!1))},[r,o,c]),(0,E.useEffect)(()=>{var e;null===(e=c.current)||void 0===e||e.scrollToBottomIfPinned("instant")},[c]),(0,a.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function sn(){return(0,a.jsx)(w.E.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-500 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,a.jsxs)("h2",{className:"font-tiempos leading-12 flex flex-col items-center justify-center gap-2 text-2xl font-medium tracking-tighter sm:flex-row sm:text-3xl",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(g.p,{state:"waiting"})}),(0,a.jsx)(Z.Z,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var sa=s(44512);let si="/Spark/",sl=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],sr="".concat(si,"/Check.svg"),so=F.z.object({changeTitle:F.z.boolean().optional(),titleDelayMs:F.z.number().optional(),changeFavicon:F.z.boolean().optional(),faviconDelayMs:F.z.number().optional(),playSound:F.z.boolean().optional()}),sc={},sd=()=>{let e=(0,E.useRef)(null),t=(0,E.useRef)(!1);(0,E.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,E.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null===(s=e.current)||void 0===s||s.play()}}},[]),n=(0,E.useCallback)(()=>{t.current=!1},[]);return(0,E.useMemo)(()=>({playSound:s,resetSound:n}),[s,n])},su=(e,t,s)=>{let n=(0,E.useRef)(null),a=(0,E.useCallback)(()=>{n.current&&(clearInterval(n.current),n.current=null),document.title="Working on it..."},[]),i=(0,E.useCallback)(()=>{if(n.current)return;let t=0;n.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,E.useCallback)(()=>{n.current&&(clearInterval(n.current),n.current=null),document.title=t},[t]);return(0,E.useMemo)(()=>({setThinkingTitle:a,setReceivedTitle:i,resetTitle:l}),[a,i,l])},sm=e=>{let t=(0,E.useRef)(null),s=(0,E.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),n=(0,E.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),a=(0,E.useCallback)(()=>{if(t.current)return;let n=0;t.current=setInterval(()=>{s("".concat(si,"/").concat(sl[n],".svg")),n=(n+1)%sl.length},e)},[e,s]),i=(0,E.useCallback)(()=>{n(),s(sr)},[s,n]);return(0,E.useMemo)(()=>({setWritingFavicon:a,setCompleteFavicon:i,resetFavicon:n}),[a,i,n])},sf=(e,t,s)=>{let n=(0,j.Zr)("claude_ai_tabbed_out_notifications","features",sc,so),a=(0,sa.xK)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=su(["Ready to chat",e],e,n.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:c,resetFavicon:d}=sm(n.faviconDelayMs||100),{playSound:u,resetSound:m}=sd(),f=(0,E.useRef)(!1);(0,E.useEffect)(()=>{let e=t&&s,x=!t&&s,h=!t&&!s;e&&!f.current&&(f.current=!0);let g=h&&f.current;if(g&&(f.current=!1),a){n.changeTitle&&r(),n.changeFavicon&&d();return}n.changeTitle&&(e||x?i():g&&l()),n.changeFavicon&&(x?o():g&&(c(),f.current=!1)),n.playSound&&(e?m():g&&u())},[n,t,s,a,i,l,r,o,c,d,u,m])};var sx=s(213),sh=s(64452);function sg(){let e=(0,n._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return sg=function(){return e},e}let sp=()=>{let[e,t]=(0,E.useState)(""),s=(0,z.Z)(),n=(0,E.useMemo)(()=>[s.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),s.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),s.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[s]),i=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[s]),l=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[s]);return(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(n[Math.floor(Math.random()*n.length)])},5e3);return()=>clearTimeout(e)},[n]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(i)},15e3);return()=>clearTimeout(e)},[i]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(l)},3e4);return()=>clearTimeout(e)},[l]),(0,a.jsx)(w.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-tiempos text-text-300 ml-2 pb-1.5 text-sm italic",children:e})};function sv(e){var t,s,n,h,w,_;let{changeDisplayedConversationPath:K,conversationTitle:Y,conversationUUID:V,editMessage:X,isStreaming:Q,isLoading:ee,messages:et,name:es,onRetry:en,onSend:ei,customFileUploadHandler:ed,projectUuid:ex,setPersonalizedStyleCallback:eh,onToolAllow:eg}=e,{account:ep,activeOrganization:ev}=(0,m.t)(),{selectedTier:ej}=(0,x.i)(),ey=(0,f.T)(),eb=(0,z.Z)(),{value:ew}=(0,j.FL)("new_scroll_behavior"),e_=(0,E.useRef)(null),eN=(0,E.useRef)();eN.current=null===(t=et[et.length-1])||void 0===t?void 0:t.uuid;let{projectHasHarmony:eC}=(0,eo.Y)(ex),{openedFiles:ek,projectDocs:eM}=(0,eu.b)(),{getInstance:eS}=(0,H.s)(),{chatResourceState:eE,dispatchChatResource:ez}=(0,W.Y)(),{mutateAsync:eZ}=(0,T.u3)(ex),{mutateAsync:eF}=(0,T.Zy)(ex),{serverLastChatMessageWarningProps:eI,updateServerLastChatMessageWarningPropsForNewMessage:eT}=function(e,t){let[s,n]=(0,E.useState)(null),a=function(e){let{activeOrganization:t}=(0,m.t)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:n}=(0,tQ.uC)(s,"POST",{meta:{noToast:!0}});return(0,E.useCallback)(async e=>{let t=await n(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[n])}(e),i=(0,E.useCallback)(e=>{async function t(){try{n(await a(e))}catch(e){}}n(null),t()},[a]),l=(0,E.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==r.QC?s:null}})},[i]);return function(e){let{chatMessages:t,onLastMessageLoaded:s}=e,n=(0,E.useRef)(t.filter(e=>"human"===e.sender).pop());(0,E.useEffect)(()=>{if(!n.current)return;let e=(0,t$.K)(n.current);e&&s({uuid:n.current.uuid,messageText:e})},[s])}({chatMessages:t,onLastMessageLoaded:(0,E.useCallback)(e=>{let{uuid:t,messageText:s}=e;i({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[i])}),{serverLastChatMessageWarningProps:s,updateServerLastChatMessageWarningPropsForNewMessage:l}}(V,et),{setSandboxState:eR}=(0,l.r)(),eA=(0,S.useSearchParams)(),[eO,eD]=(0,E.useState)(!1),[eL,eU]=(0,E.useState)(null),eP={lastAssistantMessage:(0,E.useRef)(null),lastHumanMessage:(0,E.useRef)(null),chatInput:(0,E.useRef)(null),extras:(0,E.useRef)(null),extraSpace:(0,E.useRef)(null)},eB=(0,ef.g)(),eH=(0,E.useMemo)(()=>{},[eB,null==ev?void 0:ev.uuid,V]),eJ=(0,E.useRef)(null),eW=(0,E.useCallback)(async e=>{let{prompt:t,attachments:s,files:n,syncSources:a,personalized_style:i,compass_mode:l}=e;if(Q)return;ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eT({messageText:t,parentMessageUuid:eN.current}),eR(V,{conversationFiles:[...eE.files,...n],allAttachments:[...eE.attachments,...s],projectUuid:ex});let o={prompt:t,attachments:s,files:n,syncSources:a,rethrowErrors:!0,parent_message_uuid:eN.current||r.QC,personalized_style:i,org_type_override:null!=ej?ej:void 0,compass_mode:l};eD(!0),await ei(o)},[Q,ez,eT,eR,V,eE.files,eE.attachments,ei,ex,ej]),eq=(0,E.useCallback)(async()=>{eC&&ex&&await (0,em.ec)(ek,ex,eM,eZ,eF,eS)},[eC,ek,ex,eM,eZ,eF,eS]),eG=(0,E.useCallback)(async(e,t)=>{ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),await eq(),eR(V,{conversationFiles:eE.files,allAttachments:eE.attachments,projectUuid:ex}),en(e,t)},[ez,eq,eR,V,eE.files,eE.attachments,en,ex]),eK=(0,E.useCallback)(async()=>{if(Q)return;let e=eb.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await ei({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eN.current||r.QC})},[eb,Q,eN,ei]),eY=(0,E.useCallback)(async(e,t)=>{X&&(ez({type:"CLEAR_SELECTED"}),await eq(),X(e,t),eT({messageText:t,parentMessageUuid:e.parent_message_uuid}))},[eq,ez,X,eT]),eV=(0,E.useMemo)(()=>(0,k.Z)(),[]);(0,E.useEffect)(()=>(eV.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;eG(t,s)}),eV.on("edit",e=>{let{message:t,text:s}=e;eY(t,s)}),()=>{eV.off("retry"),eV.off("edit")}),[eV,eG,eY]);let[eX,eQ]=(0,E.useState)("");(0,E.useEffect)(()=>{Q||eQ(et.map(e=>(0,i.OD)(e)).join(" "))},[et,Q]);let e$=(0,u.c)(eX),{files:e0,attachments:e1,artifacts:e2}=eE,{isDrawerExpanded:e5,setIsDrawerExpanded:e3}=(0,e4.b)(),e6=(0,E.useCallback)(()=>{ez({type:"CLEAR_SELECTED"}),e3(!0)},[ez,e3]),e7=(0,E.useCallback)(()=>{e3(!1)},[e3]),e8=(0,sh.D)(et);(0,E.useEffect)(()=>{ez({type:"UPDATE_FILES",files:e8})},[e8,ez]),(0,E.useEffect)(()=>{ez({type:"UPDATE_ATTACHMENTS",attachments:et.flatMap(e=>e.attachments)})},[ez,et]),(0,E.useEffect)(()=>{ez({type:"UPDATE_SYNC_SOURCES",syncSources:et.flatMap(e=>e.sync_sources)})},[ez,et]);let e9=(0,E.useCallback)(e=>{e6(),ez({type:"SELECT_ATTACHMENT",attachment:e})},[ez,e6]),te=(null==ey?void 0:ey.preview_feature_uses_artifacts)||!!(null==ey?void 0:ey.compass_mode),tt=(0,E.useCallback)((e,t,s)=>{e6(),ez({type:"SELECT_ARTIFACT",id:e,versionUUID:s}),ez({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[ez,e6]),ts=et[et.length-1];(0,E.useEffect)(()=>{if(!te)return;let e={};et.forEach(t=>{(0,v.HZ)(t).forEach(t=>{var s,n,a;let{id:i,currentVersion:l,type:r,title:o,language:c}=t,d=(0,v.tE)(l,null===(a=e[i])||void 0===a?void 0:null===(n=a.versions)||void 0===n?void 0:null===(s=n.slice(-1)[0])||void 0===s?void 0:s.resultState),u={...l,resultState:d};e[i]?e[i].versions.push(u):e[i]={id:i,type:r||"document",title:o||"Untitled",language:c||void 0,versions:[u]}})}),ez({type:"UPDATE_ARTIFACTS",artifacts:e})},[et,te,ts,ez]);let tn=ts?(0,v.HZ)(ts):[],ta=null!==(w=N()(tn))&&void 0!==w?w:null,ti=null!==(_=null==ta?void 0:ta.id)&&void 0!==_?_:null,tl=(0,E.useRef)({lastOpenedArtifactId:null});(0,E.useEffect)(()=>{let e=tl.current.lastOpenedArtifactId===ti;Q&&ti&&!e&&(tl.current.lastOpenedArtifactId=ti,tt(ti))},[Q,ti,tt]),(0,E.useEffect)(()=>{let e=eA.get("artifactId");e&&(e6(),ez({type:"SELECT_ARTIFACT",id:e}))},[]),function(e){let{lastMessage:t,projectUuid:s}=e,{getInstance:n,setMergeState:a,rejectAllChanges:i}=(0,H.s)(),{projectHasHarmony:l}=(0,eo.Y)(s),{dispatchChatResource:o}=(0,W.Y)(),c=(0,E.useRef)(""),d=(0,E.useRef)(0),u=(0,E.useRef)(!1),m=(0,E.useMemo)(()=>{var e;return(null==t?void 0:null===(e=t.content)||void 0===e?void 0:e.filter(e=>"tool_use"===e.type&&["str_replace","update_file","create_file","delete_file"].includes(e.name)))||[]},[null==t?void 0:t.content]),f=(0,E.useCallback)((e,t)=>{if("tool_use"!==e.type)return null;let s=e.partial_json?(0,J.g)(e.partial_json||""):e.input;if(!s||"object"!=typeof s)return null;let a=ec.safeParse(s);if(!a.success)return null;let i=a.data.path;if(!(0,$.Wx)(i))return null;switch(e.name){case"str_replace":return{contentId:i,changeType:"edit",state:{currentContent:t,changes:[{type:"edit",contentId:i,originalHash:a.data.original_hash||"",oldStr:a.data.old_str||"",newStr:a.data.new_str||""}]}};case"update_file":{let e=n(i),s=null==e?void 0:e.view;if(!s)return null;let l={type:"update",contentId:i,originalHash:a.data.original_hash||"",newText:a.data.file_text||""};return el(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]}}}case"create_file":{let e={type:"create",contentId:i,newText:""},s=n(i);return(null==s?void 0:s.view)&&el(s.view,{...e,newText:a.data.file_text||""}),{contentId:i,changeType:e.type,state:{currentContent:t,changes:[]},suggestedChange:e}}case"delete_file":{let e=n(i),s=null==e?void 0:e.view,l={type:"delete",contentId:i,originalHash:a.data.original_hash||""};return s&&el(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]},suggestedChange:l}}default:return null}},[n]),x=(0,E.useCallback)((e,t)=>{let s=n(e),i=null==s?void 0:s.view;i&&(a(e,{isActive:!0,diffSource:t.currentContent}),t.changes.length>0&&function(e,t,s){let n=s;if(t.forEach(e=>{let{oldStr:t,newStr:s}=e;n=n.replace(t,s)}),n!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:n},annotations:[G.YW.addToHistory.of(!1)]});try{ea(e,(0,q.gO)(e.state).toString(),!0)}catch(e){}}}(i,t.changes,t.currentContent))},[n,a]);(0,E.useEffect)(()=>{if(!l||!(null==t?void 0:t.content)||(null==t?void 0:t.uuid)!==r.FC)return;m.length>0&&0===d.current&&!u.current?(i(),o({type:"UPDATE_FILE_EDITS",edits:new Map}),u.current=!0):0===m.length&&(u.current=!1),d.current=m.length;let e=m.map(e=>{if("tool_use"!==e.type)return"";let{name:t,partial_json:s,input:n}=e;return"".concat(t,":").concat(s||JSON.stringify(n))}).join("|");if(e===c.current)return;c.current=e;let s=new Map;m.reduce((e,t)=>{if("tool_use"!==t.type)return e;let a=t.partial_json?(0,J.g)(t.partial_json||""):t.input;if(!a||"object"!=typeof a)return e;let i=ec.safeParse(a);if(!i.success)return e;let l=i.data.path;if(!(0,$.Wx)(l))return e;let r=n(l),o=f(t,r?(0,er.li)(r):"");if(!o)return e;if(o.suggestedChange){let e=s.get(o.contentId)||[];s.set(o.contentId,[...e,o.suggestedChange])}let c=e.get(o.contentId);return c?e.set(o.contentId,{currentContent:c.currentContent,changes:[...c.changes,...o.state.changes]}):(e.set(o.contentId,o.state),e)},new Map).forEach((e,t)=>{x(t,e)}),s.size>0&&o({type:"UPDATE_FILE_EDITS",edits:s})},[l,m,f,x,t,i,o,n])}({lastMessage:ts,projectUuid:ex});let tr=Q&&ts&&ts.content?ts.content[ts.content.length-1]:void 0,to=Q&&(!ts||!(null===(s=ts.content)||void 0===s?void 0:s[0])&&0===ts.attachments.length&&0===ts.files.length&&0===ts.files_v2.length),tc=tr&&("tool_use"===tr.type||"tool_result"===tr.type),td=(0,E.useMemo)(()=>{var e;if(!ts)return;let t=null===(e=ts.content)||void 0===e?void 0:e.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name);if(t){let e=t.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:s}=P.Xd.safeParse(e);return null==s?void 0:s.task_id}},[ts]),tu=!Q&&void 0!==td,{compassStatus:tm}=(0,B.Oz)({organizationUUID:null==ev?void 0:ev.uuid,conversationUUID:V,taskId:td,isShared:!1,enabled:tu}),tf=(0,E.useMemo)(()=>{var e,t;let s=null==ts?void 0:null===(e=ts.content)||void 0===e?void 0:e.some(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name&&!e.is_error&&(0,y.Ml)(null==tm?void 0:tm.status)),n=!(null==ts?void 0:null===(t=ts.content)||void 0===t?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name));return!!(s&&n)},[ts,tm]),tx=(0,D.B4)(),th=(0,E.useMemo)(()=>tx?"writing":to?"thinking":tc||tf?"shimmer":Q?"writing":"static",[to,tc,Q,tx,tf]);sf(Y,to,Q);let{getCreateParamsForConvo:tg}=(0,d.b)();(0,E.useEffect)(()=>{if(ee)return;let e=tg(V);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&eW(e)},[V,eW,tg,ee]);let{data:tp}=(0,R.Yc)(ex),tv=(0,O.U)(),tj=(0,A.nR)(ex),{publishedArtifactsByMessageUuid:ty}=(0,I.L1)(),{mutate:tb,isPending:tw}=(0,i.gK)(V),t_=(0,d.w)(),tN=(0,E.useCallback)((e,t)=>{ez({type:"CLEAR_SELECTED"}),null==K||K(e,t)},[K,ez]),tC=(0,o.wN)(V);(0,tX.j)(V);let tk=null==ts?void 0:null===(n=ts.content)||void 0===n?void 0:n.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),{activeModelOptions:tM}=(0,c.uL)(),tS=F.z.array(F.z.string()),tE=(0,j.Zr)("invite_contest_name","model_prefixes",[],tS);(0,E.useEffect)(()=>{var e,t;if(!Q&&2===et.length&&(null===(e=et[0])||void 0===e?void 0:e.sender)==="human"&&(null===(t=et[1])||void 0===t?void 0:t.sender)==="assistant"&&tE.some(e=>null==tC?void 0:tC.startsWith(e))){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUUID:V,model:tC}});window.dispatchEvent(e)}},[Q,et,tC,V,tE]);let tz=(0,E.useMemo)(()=>{let e=eb.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tM.find(e=>e.model===tC);if(!t||!t.knowledgeCutoff)return e;let s=C.ou.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return eb.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:eb.locale});return eb.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tC,tM,eb]),tZ=(0,E.useMemo)(()=>e2,[!Q&&e2]),tF=e5&&eE.selectedItem?eE.selectedItem:void 0,tI=(0,E.useCallback)(e=>{let{toolUseId:t,input:s,isLastMessage:n,message:i,publishedArtifacts:l,shouldStream:r,toolName:o,toolResult:c,displayData:d,artifactCellType:u,isFirstBlockOfMessage:m,isLastBlockOfMessage:f,context:x}=e;return(0,a.jsx)(sx.P,{toolUseId:t,toolName:o,input:s,message:i,toolResult:c,displayData:d,isLastMessage:n,isStreaming:r,onOpenArtifact:te?tt:void 0,publishedArtifacts:l,artifacts:tZ,onAllow:n&&!c?eg:void 0,artifactCellType:u,isFirstBlockOfMessage:m,isLastBlockOfMessage:f,conversationUUID:V,selectedDrawerItem:tF,context:x})},[tt,te,tZ,eg,V,tF]),tT=(0,E.useCallback)(()=>{eU({})},[]),tR=(0,E.useMemo)(()=>({id:V,messagesSoFar:et.length,tokensSoFar:e$,files:e0,attachmentsSoFar:e1.length,isSampling:Q,isStoppingSampling:tw,model:tC,projectKnowledgebaseTokens:null!=tj?tj:0,conversationSettings:ey}),[e1.length,ey,e$,V,e0,tw,Q,et.length,tC,tj]),tA=(0,E.useMemo)(()=>ts&&"assistant"===ts.sender&&ts.content&&ts.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[ts]),tO=(0,E.useCallback)(()=>{tb()},[tb]);return ep?(0,a.jsx)(t0.g,{autoscrollDisabled:ew||0===et.length,autoscrollRef:e_,mainElement:(0,a.jsx)(tV.x,{conversation:tR,projectUuid:ex,onSend:eW,onCreate:t_,onStopSampling:tO,setPersonalizedStyleCallback:eh,customFileUploadHandler:eH||ed,children:(0,a.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,a.jsx)(se,{conversationUuid:V}),ee?(0,a.jsx)(sj,{className:"pt-2",children:(0,a.jsx)(U.U,{})}):0===et.length?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(sn,{}),(0,a.jsx)(sj,{})]})}):(0,a.jsxs)(sj,{className:"pt-1",children:["",(0,a.jsx)(t1.w,{renderToolUseCell:tI,children:et.map((e,t)=>(0,a.jsx)(U.J,{lastHumanMessageRef:eP.lastHumanMessage,lastAssistantMessageRef:eP.lastAssistantMessage,previousMessage:t>0?et[t-1]:void 0,message:e,conversationUUID:V,conversationSettings:ey,isStreaming:Q,isLastMessage:t===et.length-1,isLastHumanMessage:t===et.length-2,isFirstAssistantMessage:1===t&&"assistant"===e.sender,messageWarningProps:t===et.length-1&&eI||void 0,onOpenArtifact:te?tt:void 0,selectAttachment:e9,changeDisplayedConversationPath:tN,editable:!0,publishedArtifacts:null==ty?void 0:ty[e.uuid],onResize:tT,actionEmitter:eV,onSendContinue:eK,isResearchPending:tf},t))}),(0,a.jsx)("div",{ref:eP.extras,children:(0,a.jsxs)("div",{className:(0,b.Z)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",Q&&"-translate-y-2.5"),children:[(0,a.jsx)("div",{className:"p-1 -translate-x-px",children:(0,a.jsx)(g.p,{state:th})}),2===et.length&&Q&&(null===(h=et[1])||void 0===h?void 0:h.content)&&0===et[1].content.length?(0,a.jsx)(sp,{}):null,(0,a.jsx)("div",{className:(0,b.Z)("text-text-400 pt-5 flex-1 text-right text-[0.65rem] leading-[0.85rem] tracking-tighter sm:text-[0.75rem]",Q&&"pointer-events-none"),children:tf?(0,a.jsx)("span",{className:"inline-block select-none",children:(0,a.jsx)(Z.Z,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,a.jsx)(p.u,{tooltipContent:tz,side:"bottom",disableHoverableContent:!0,className:"max-w-96",children:(0,a.jsx)(M.default,{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,b.Z)("inline-block underline-offset-2 transition-opacity hover:underline select-none",!Q&&"opacity-100 duration-700",Q&&"opacity-0 duration-0"),children:tA?(0,a.jsx)(Z.Z,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,a.jsx)("br",{className:"block sm:hidden"})}}):(0,a.jsx)(Z.Z,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,a.jsx)("br",{className:"block sm:hidden"})}})})})})]})}),ew&&(0,a.jsx)(ss,{newMessageSent:eO,setNewMessageSent:eD,scrollRefs:eP,scrollContainerRef:e_,invalidator:eL})]}),(0,a.jsx)("div",{ref:eP.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:tk?(0,a.jsx)(tY,{conversationUuid:V,message:ts}):(0,a.jsx)(L.x,{ref:eJ,placement:"bottom",disabled:ee})})]})}),drawerElement:(0,a.jsx)(tG,{conversationUUID:V,isOpen:e5,onClose:e7,isStreaming:Q,projectUuid:ex,sendMessage:eW}),isDrawerOpen:e5,headerProps:{conversationUUID:V,name:es,project:tv?tp:void 0,controlsSidebarIsOpen:e5,closeControlsSidebar:e7,openControlsSidebar:e6,isStreaming:Q}}):null}let sj=h.q.div(sg())},213:function(e,t,s){"use strict";s.d(t,{P:function(){return Q}});var n=s(27573),a=s(87033),i=s(10228),l=s(7653),r=s(2949),o=s(46200),c=s(49454),d=s(45790);let u=()=>(0,n.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,n.jsx)(c.k,{size:24}),(0,n.jsx)("p",{className:"font-styrene ml-3 text-sm",children:(0,n.jsx)(d.Z,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var m=s(8392),f=s(59821),x=s(1133),h=s(98649),g=s(7992),p=s(41270),v=s(30833);let j=p.z.object({url:p.z.string()}),y=e=>{let t,{input:s,toolResult:a,isStreaming:i,isFirstBlockOfMessage:r,isLastBlockOfMessage:o}=e,c=null==a?void 0:a.is_error,[u,p]=(0,l.useState)(!1),y=(0,l.useMemo)(()=>{var e;if(c)return;let t=function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.d2.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(a);return null==t?void 0:null===(e=t[0])||void 0===e?void 0:e.title},[c,a]),{data:b}=j.safeParse(s);if(!b)return;let w=b.url,_=(0,x.Ly)(w);return t=i?(0,n.jsx)(d.Z,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:_}}):(0,n.jsx)(d.Z,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:y||w,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.hZ,{isError:c,isStreaming:!!i,text:t,secondaryText:i?void 0:_,handleClick:()=>p(!0),icon:(0,n.jsx)(f.s,{fadeInOnLoad:!0,url:w,size:16}),secondaryIcon:(0,n.jsx)(g.O,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:r,isLastBlockOfMessage:o}),(0,n.jsx)(m.o,{isOpen:u,url:w,onClose:()=>p(!1),onConfirm:()=>{window.open(w,"_blank"),p(!1)}})]})};var b=s(67677),w=s(32006),_=s(22027),N=s(68425),C=s(2230),k=s.n(C),M=s(40950),S=s(56971),E=s(65499);function z(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let Z=e=>{let{isExpanded:t,toolName:s,results:a}=e;return(null==a?void 0:a.length)?(0,n.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,n.jsx)(I,{results:a,isExpanded:t}):(0,n.jsx)(T,{results:a,isExpanded:t})}):null},F={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},I=e=>{let{isExpanded:t,results:s}=e;return(0,n.jsx)(n.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,n.jsx)(N.E.div,{variants:F,children:(0,n.jsx)(b.s,{disabled:!t,icon:(0,n.jsx)(f.s,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!==(s=e.knowledge.url)&&void 0!==s?s:void 0})},e.knowledge.url):null})})},T=e=>{let{isExpanded:t,results:s}=e;return(0,n.jsx)(n.Fragment,{children:s.map(e=>(0,n.jsx)(N.E.div,{variants:F,children:(0,n.jsx)(A,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},R=e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.nC)();return(0,r.MN)()?s?t?i.co.ACCESS_DENIED:i.co.READY:i.co.UNAUTHENTICATED:i.co.DISABLED},A=e=>{let{disabled:t,knowledge:s}=e,a=R({isError:!s});return(0,n.jsx)(S.dF,{syncSourceType:i.Fg.GDRIVE,syncStatus:a,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},O=p.z.object({query:p.z.string(),n:p.z.number().int().optional()}),D=e=>{var t;let{toolName:s,syncSourceType:a,input:i,toolResult:l,isStreaming:r,isFirstBlockOfMessage:o,isLastBlockOfMessage:c}=e,{isExpanded:d,setIsExpanded:u,snappyTransition:m}=(0,E.g)(!1),f=(0,M.Z)(),x=null==l?void 0:l.is_error,g=x?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:z(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return k()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),n=(Array.isArray(s)?s.map(e=>{let t=h.d2.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:z(e),knowledge:e}));return k()(n,e=>e.uuid)}catch(e){return[]}}(l),{data:p}=O.safeParse(i),j="web_search"===s?f.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):f.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!p)return;let y=f.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!==(t=null==g?void 0:g.length)&&void 0!==t?t:0}),b=!g&&r?j:p.query;return(0,n.jsx)(v.qd,{isExpandingDisabled:!!r,isExpanded:d,setIsExpanded:u,isStreaming:!!r,isError:x,text:b,secondaryText:r?void 0:y,icon:"web_search"===s?(0,n.jsx)(_.T,{size:16}):!!a&&(0,n.jsx)(w.j0,{type:a,size:14}),isFirstBlockOfMessage:o,isLastBlockOfMessage:c,children:(0,n.jsx)(v.jE,{isExpanded:d,snappyTransition:m,isScrollable:!0,children:!x&&!!(null==g?void 0:g.length)&&(0,n.jsx)(Z,{isExpanded:d,toolName:s,results:g})})})};var L=s(60757);s(27218),p.z.object({prompt:p.z.string()});var U=s(2210),P=s(82083),B=s(10607);function H(e){var t,s,a,i;let{input:r,toolResult:o,isStreaming:c,isLastMessage:d,onOpenArtifact:u,publishedArtifacts:m,artifacts:f,message:x,artifactCellType:h,selectedArtifactId:g,selectedArtifactVersion:p,isFirstBlockOfMessage:v,isLastBlockOfMessage:j}=e,y=P.kE.parse(r),b=d&&c,{versions:w,..._}=null!==(a=f[null!==(s=y.id)&&void 0!==s?s:""])&&void 0!==a?a:{},N=(0,l.useMemo)(()=>{let e=null==w?void 0:w.findIndex(e=>e.uuid===y.version_uuid);if(-1!==e)return e},[w,y.version_uuid]),C=null===(t=null!==(i=y.content)&&void 0!==i?i:y.new_str)||void 0===t?void 0:t.slice(0,250),k={isClosed:void 0!==o,..._,...y},M=g===k.id&&p===y.version_uuid,S="individual_cell_create"===h||"multi_edit_not_last"!==h;return(0,n.jsx)("div",{className:(0,B.Z)(S&&(v?"pt-2":"pt-3"),S&&(j?"pb-2":"pb-3"),"multi_edit_not_last"===h&&"h-0"),children:(0,n.jsx)(U.qK,{versionNum:N?N+1:void 0,preview:C,versionCount:null==w?void 0:w.length,properties:k,isStreaming:c,isEdit:"individual_cell_create"!==h,isNotLastEdit:"multi_edit_not_last"===h,isLastMessage:d,onOpenArtifact:e=>{u&&u(e,x.uuid,y.version_uuid)},publishedArtifacts:b?U.EY:m,isExpanded:M})})}var J=s(21273);s(70354);var W=s(66829),q=s(32313),G=s(45144),K=s(14395);let Y=e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,G.Tb)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}},V=p.z.object({code:p.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),X=e=>{var t;let{input:s,toolResult:a,isStreaming:i,isFirstBlockOfMessage:r,isLastBlockOfMessage:o}=e,c=(0,M.Z)(),{isExpanded:d,setIsExpanded:u,snappyTransition:m}=(0,E.g)(i),f=null!==(t=V.parse(s).code)&&void 0!==t?t:"",{toolResultLogs:x,toolResultErrors:h}=(0,l.useMemo)(()=>a?Y(a):{toolResultLogs:"",toolResultErrors:""},[a]);return(0,n.jsx)(v.qd,{isExpanded:d,setIsExpanded:u,isStreaming:!!i,icon:(0,n.jsx)(q.d,{size:16}),text:i?c.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):c.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:c.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),isFirstBlockOfMessage:r,isLastBlockOfMessage:o,children:(0,n.jsx)(v.jE,{isExpanded:d,snappyTransition:m,isScrollable:!0,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,n.jsx)(K.O,{language:"javascript",code:f}),(0,n.jsx)(K.O,{title:c.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:x}),!!h&&(0,n.jsx)(K.O,{title:c.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:h,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};function Q(e){let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:c,input:d,message:m,onOpenArtifact:f,publishedArtifacts:x,toolResult:h,artifacts:g,onAllow:p,artifactCellType:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,conversationUUID:w,selectedDrawerItem:_,isShared:N,displayData:C,context:k}=e,M=(0,r.$Z)(),S=(0,o.uH)(),E=(0,a.FL)("pumpernickel_enabled"),{value:z}=(0,a.FL)("prism_enabled");if("end_conversation"===c)return(0,n.jsx)(u,{});let Z=(null==_?void 0:_.type)==="artifact"?_:void 0,F=!!h&&!!_&&"compass"===_.type&&_.data.toolUseId===h.tool_use_id;switch(c){case"artifacts":return(0,n.jsx)(H,{input:d,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:f,publishedArtifacts:x,artifacts:g,message:m,artifactCellType:v,selectedArtifactId:null==Z?void 0:Z.id,selectedArtifactVersion:null==Z?void 0:Z.versionUUID,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"dolphin":return(0,n.jsx)(n.Fragment,{});case"repl":return(0,n.jsx)(X,{input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"drive_search":if(!M)break;return(0,n.jsx)(D,{syncSourceType:i.Fg.GDRIVE,toolName:c,input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"web_search":if(!S)break;return(0,n.jsx)(D,{toolName:c,input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"web_fetch":return(0,n.jsx)(y,{input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"launch_extended_search_task":return(0,n.jsx)(L.DY,{toolUseId:t,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,conversationUUID:w,toolResult:h,isShared:N,isExpanded:F,isStreaming:l,context:k})}return E&&(0,J.v)(C)?(0,n.jsx)(J.i,{...C,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b}):(0,n.jsx)(W.G,{input:d,toolName:c,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b})}s(35102)},14395:function(e,t,s){"use strict";s.d(t,{O:function(){return f}});var n=s(27573),a=s(61995),i=s(20147),l=s(70354),r=s(32737),o=s(17582),c=s(10607),d=s(40950),u=s(45790),m=s(41668);let f=e=>{let{className:t,code:s,codeTagProps:l,language:r,title:d}=e,{codeStyle:u}=(0,i.o)(),{didCopy:f,copyToClipboard:h}=(0,o.m)();return(0,n.jsxs)("div",{className:(0,c.Z)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,n.jsx)(x,{language:r,title:d,handleCopy:()=>{h(s)},didCopy:f}),(0,n.jsx)(m.Z,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:l,language:r,PreTag:"div",style:u,renderer:a.S,wrapLongLines:!0,children:s})]})},x=e=>{let{handleCopy:t,didCopy:s,language:a,title:i}=e,m=(0,d.Z)();return(0,n.jsxs)("div",{className:"flex justify-between items-center h-3",children:[(0,n.jsx)("p",{className:(0,c.Z)("text-text-300 text-[0.6875rem]",i?"font-styrene font-medium":"font-mono font-[450]"),children:i||a}),(0,n.jsx)(r.u,{side:"bottom",tooltipContent:(0,n.jsx)(u.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),children:(0,n.jsx)(l.z,{"aria-label":m.formatMessage({defaultMessage:"Copy to clipboard",id:"aCdAsIsVv0"}),size:"icon_sm",variant:"ghost",className:"!-mr-1 !w-6 !h-6",onClick:t,children:(0,n.jsx)(o.f,{didCopy:s,size:12,className:"text-text-500"})})})]})}},30833:function(e,t,s){"use strict";s.d(t,{hZ:function(){return m},jE:function(){return u},qd:function(){return f}});var n=s(27573),a=s(43566),i=s(28386),l=s(30070),r=s(96346),o=s(10607),c=s(68425),d=s(7653);let u=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:a,children:l,className:r,onTransitionEnd:u,collapsesHalfway:m,setIsExpanded:f}=e,x=(0,d.useRef)(t),h=!!(m&&!t&&f),g=m&&!t;return(0,n.jsx)(c.E.div,{className:(0,o.Z)("overflow-hidden shrink-0",!t&&h&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:x.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:m?.6:0,height:m?72:0}},whileHover:{opacity:1},transition:a?{ease:i.J.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:u,onClick:h?()=>f(!0):void 0,children:(0,n.jsx)("div",{tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,o.Z)("h-full",s&&"overflow-y-auto overflow-x-hidden max-h-[238px]",s&&t&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,hsl(var(--always-black)/100%)_4px,hsl(var(--always-black)/100%)_calc(100%-20px),_hsl(var(--always-black)/0%)_100%)]",r,g&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l})})},m=e=>{let{handleClick:t,isDisabled:s,isExpanded:i,isStreaming:r,isError:d,icon:u,text:m,secondaryIcon:f,secondaryText:x,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,className:p,wrapperClassName:v,children:j}=e,y=s||!t;return(0,n.jsxs)(c.E.div,{initial:{opacity:r?0:1},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,o.Z)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-styrene leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!i&&"hover:bg-bg-000 hover:shadow-sm",h?"mt-2":"mt-3",g?"mb-2":"mb-3",i&&"bg-bg-000 shadow-sm",v),children:[(0,n.jsxs)("button",{onClick:t,className:(0,o.Z)("group/row flex flex-row items-center justify-between gap-4 transition-colors duration-200 rounded-lg text-text-300 hover:text-text-200 h-[2.625rem] py-2 px-3",y?"cursor-default":"cursor-pointer hover:text-text-000",p),disabled:y,children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[!!u&&(0,n.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:u}),(0,n.jsx)("div",{className:"relative bottom-[0.5px] font-styrene text-[0.875rem] text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:r?(0,n.jsx)(a.g,{children:m}):m})]}),(0,n.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:d?(0,n.jsx)(l.v,{size:16,className:"text-danger-000"}):(0,n.jsxs)(n.Fragment,{children:[!!x&&(0,n.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-styrene text-[0.75rem] leading-tight shrink-0 whitespace-nowrap",children:x}),f]})})]},r?"streaming":"non-streaming"),j]})},f=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...a}=e,{isExpanded:i,isError:l}=a,c=t||l;return(0,n.jsx)(m,{...a,isDisabled:c,handleClick:()=>s(!i),secondaryIcon:c?void 0:(0,n.jsx)(r.p,{className:(0,o.Z)("relative bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",i?"-rotate-180":"rotate-0",c&&"opacity-15"),size:12})})}},21273:function(e,t,s){"use strict";s.d(t,{i:function(){return p},v:function(){return g}});var n=s(27573),a=s(53392),i=s(59821),l=s(67677),r=s(32006),o=s(10228),c=s(19984),d=s(10607),u=s(68425),m=s(40950),f=s(14395),x=s(30833),h=s(65499);function g(e){return!!e&&!!e.integrationName&&Object.values(e).some(e=>!!e)}function p(e){var t,s,a;let i,{integrationName:l,icon:r,integrationIcon:o,message:c,result:d,isStreaming:u,isError:f,isExpandingDisabled:g,isFirstBlockOfMessage:p,isLastBlockOfMessage:v,wrapperClassName:j,contentClassName:N,defaultExpanded:C=!1}=e,k=(0,m.Z)(),{isExpanded:M,setIsExpanded:S}=(0,h.g)(C),E=!!d&&!g&&!u&&("rich_content"!==d.type||(null===(t=d.content)||void 0===t?void 0:t.length)>0);return i=d?"rich_content"===d.type?k.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!==(a=null===(s=d.content)||void 0===s?void 0:s.length)&&void 0!==a?a:0}):"JSON":void 0,(0,n.jsx)(x.qd,{isError:f,isExpandingDisabled:!E,isExpanded:M,setIsExpanded:S,isStreaming:!!u,text:null!=c?c:u?k.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):k.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:u?void 0:i,icon:r||(0,n.jsx)(y,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:p,isLastBlockOfMessage:v,wrapperClassName:j,children:(0,n.jsxs)(x.jE,{isExpanded:M,snappyTransition:!0,isScrollable:!0,className:N,children:[E&&(null==d?void 0:d.type)==="rich_content"&&(0,n.jsx)(b,{disabled:!M||u,result:d,integrationName:l}),E&&(null==d?void 0:d.type)==="table"&&(0,n.jsx)(w,{result:d}),E&&(null==d?void 0:d.type)==="json_block"&&(0,n.jsx)(_,{result:d})]})})}let v={"Google Calendar":(0,n.jsx)(r.j0,{type:o.Fg.GCAL,size:16}),Gmail:(0,n.jsx)(r.j0,{type:o.Fg.GMAIL,size:16})},j=["Google Calendar","Gmail","Google Drive"],y=e=>{let{canShowLetterIcon:t,integrationName:s,iconUrl:l}=e;return s&&s in v?v[s]:l?(0,n.jsx)(i.s,{fadeInOnLoad:!0,url:l,size:16}):s&&t?(0,n.jsx)(a._,{letter:s}):(0,n.jsx)(c.J,{size:16,className:"text-text-500"})},b=e=>{let{disabled:t,integrationName:s,result:a}=e,i=!!s&&j.includes(s);return(0,n.jsx)(u.E.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:a.content.map((e,a)=>{let{title:r,subtitles:o,url:c,resource_type:d,icon_url:u}=e;return(0,n.jsx)(l.s,{disabled:t,icon:i?void 0:(0,n.jsx)(y,{integrationName:s,iconUrl:u}),title:r,subtitles:o,url:c,tag:d},a)})})},w=e=>{let{result:t}=e;return(0,n.jsx)(N,{table:t.table})},_=e=>{let{result:t}=e,s=(0,m.Z)();return(0,n.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,n.jsx)(f.O,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},N=e=>{let{table:t}=e;return(0,n.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[a,i]=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:(0,d.Z)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,n.jsx)("p",{className:"font-medium text-text-300 text-xs",children:a})}),(0,n.jsx)("div",{className:(0,d.Z)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,n.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},66829:function(e,t,s){"use strict";s.d(t,{G:function(){return u},K:function(){return d}});var n=s(27573),a=s(53392),i=s(27218),l=s(40950),r=s(14395),o=s(30833),c=s(65499);let d=e=>{let{input:t,toolResult:s}=e,a=(0,l.Z)(),{activeOrganization:o}=(0,i.t)(),c=null==o?void 0:o.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,n.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,n.jsx)(r.O,{title:a.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,n.jsx)(r.O,{title:a.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,n.jsx)("img",{src:"/api/".concat(c,"/files/").concat(e.file_uuid,"/preview"),alt:a.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},u=e=>{let{input:t,toolResult:s,toolName:i,isStreaming:l,isFirstBlockOfMessage:r,isLastBlockOfMessage:u}=e,{isExpanded:m,setIsExpanded:f,snappyTransition:x}=(0,c.g)(l);return(0,n.jsx)(o.qd,{isStreaming:!!l,isExpanded:m,setIsExpanded:f,isFirstBlockOfMessage:r,isLastBlockOfMessage:u,text:i,icon:(0,n.jsx)(a._,{letter:i,size:18}),children:(0,n.jsx)(o.jE,{isExpanded:m,snappyTransition:x,isScrollable:!0,children:(0,n.jsx)(d,{input:t,toolResult:s})})})}},65499:function(e,t,s){"use strict";s.d(t,{g:function(){return a}});var n=s(7653);let a=e=>{let t=(0,n.useRef)(!!e),[s,a]=(0,n.useState)(!!e),[i,l]=(0,n.useState)(!e);return(0,n.useEffect)(()=>{!e&&t.current&&setTimeout(()=>{a(!1),setTimeout(()=>{l(!0)},600)},2e3)},[e]),{isExpanded:s,setIsExpanded:a,snappyTransition:i}}},5751:function(e,t,s){"use strict";s.d(t,{r:function(){return h}});var n=s(27573),a=s(28803),i=s(27218),l=s(5984),r=s(70354),o=s(52939),c=s(82083),d=s(88146),u=s(7653),m=s(40950),f=s(45790),x=s(64452);function h(e){var t,s,h,g,p,v;let{conversationUuid:j,message:y,requestedFeedbackType:b,setRequestedFeedbackType:w,isOpen:_,onClose:N,onSuccess:C,showOptions:k=!0}=e,M=(0,m.Z)(),[S,E]=(0,u.useState)(""),{data:z}=(0,a._C)(j),Z=null==z?void 0:z.chat_messages.some(e=>(0,c.HZ)(e).length>0),F=(0,x.D)(null!==(h=null==z?void 0:z.chat_messages)&&void 0!==h?h:[]).length>0,{mutate:I}=(0,a.Ke)(j,y,!!Z,{onSuccess:C}),T=(0,u.useId)(),R=null!==(g=null===(t=y.content)||void 0===t?void 0:t.some(e=>"thinking"===e.type))&&void 0!==g&&g,A="raven"===(0,i.b9)(),O=null;return(null==z?void 0:null===(s=z.settings)||void 0===s?void 0:s.enabled_web_search)&&(O=null!==(v=null===(p=y.content)||void 0===p?void 0:p.some(e=>"tool_use"===e.type&&"web_search"===e.name))&&void 0!==v&&v?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("option",{value:"flag/web-over",children:(0,n.jsx)(f.Z,{defaultMessage:"Shouldn’t have searched the web",id:"T+mr27AakV"})}),(0,n.jsx)("option",{value:"flag/web-sources",children:(0,n.jsx)(f.Z,{defaultMessage:"Don’t like the cited sources",id:"MBNotx/VaO"})})]}):(0,n.jsx)("option",{value:"flag/web-under",children:(0,n.jsx)(f.Z,{defaultMessage:"Should have searched the web",id:"CS8kdzupd9"})})),(0,n.jsxs)(o.u_,{isOpen:_,title:M.formatMessage({defaultMessage:"Feedback",id:"Ejhdi47Jk5"}),onClose:N,children:[(0,n.jsxs)("div",{className:"mt-4 flex flex-col",children:[(null==b?void 0:b.includes("flag"))&&k&&(0,n.jsxs)(l.Ph,{className:"my-2 max-w-md",placeholder:M.formatMessage({defaultMessage:"Pick an option",id:"BHHAF2oPTc"}),label:M.formatMessage({defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"}),value:b,onChange:e=>{w(e.target.value||"flag")},children:[(0,n.jsx)("option",{value:"flag",children:(0,n.jsx)(f.Z,{defaultMessage:"Select…",id:"q0+99kUbd6"})}),(0,n.jsx)("option",{value:"flag/bug",children:(0,n.jsx)(f.Z,{defaultMessage:"UI bug",id:"0uIYueAyDB"})}),(0,n.jsx)("option",{value:"flag/refusal",children:(0,n.jsx)(f.Z,{defaultMessage:"Overactive refusal",id:"Jl0Mn6yDBI"})}),F&&(0,n.jsx)("option",{value:"flag/file",children:(0,n.jsx)(f.Z,{defaultMessage:"Poor image understanding",id:"227KYxHrx5"})}),(0,n.jsx)("option",{value:"flag/instructions",children:(0,n.jsx)(f.Z,{defaultMessage:"Did not fully follow my request",id:"2uOw8LgMwG"})}),(0,n.jsx)("option",{value:"flag/facts",children:(0,n.jsx)(f.Z,{defaultMessage:"Not factually correct",id:"topE9Q6MGe"})}),(0,n.jsx)("option",{value:"flag/incomplete",children:(0,n.jsx)(f.Z,{defaultMessage:"Incomplete response",id:"ZNEcy7OM5r"})}),R&&(0,n.jsx)("option",{value:"flag/thoughts",children:(0,n.jsx)(f.Z,{defaultMessage:"Issue with thought process",id:"zOab+24EWo"})}),O,(0,n.jsx)("option",{value:"flag/other",children:(0,n.jsx)(f.Z,{defaultMessage:"Other",id:"/VnDMl81rh"})})]}),(0,n.jsx)("label",{htmlFor:T,className:"text-text-400 mb-2 text-sm",children:(0,n.jsx)(f.Z,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),(0,n.jsx)(l.Kx,{id:T,className:"text-sm",placeholder:(null==b?void 0:b.includes("flag"))?M.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}):M.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),value:S,onChange:e=>{E(e.target.value)}})]}),(0,n.jsx)("p",{className:"text-text-500 mt-3 italic leading-tight",children:(0,n.jsx)("small",{children:(0,n.jsx)(f.Z,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn More</link>",id:"laRJ009b4f",values:{link:e=>(0,n.jsx)(d.default,{target:"_blank",rel:"noopener",href:A?"https://privacy.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback":"https://privacy.anthropic.com/en/articles/10023565-how-does-anthropic-use-submitted-feedback",className:"text-accent-secondary-100 font-medium hover:underline",children:e})}})})}),(0,n.jsxs)(o.dm,{children:[(0,n.jsx)(r.z,{onClick:()=>{b&&(I({type:b,reason:S||void 0}),N())},children:(0,n.jsx)(f.Z,{defaultMessage:"Submit",id:"wSZR47Y5kj"})}),(0,n.jsx)(r.z,{variant:"secondary",onClick:N,children:(0,n.jsx)(f.Z,{defaultMessage:"Cancel",id:"47FYwba+bI"})})]})]})}},67995:function(e,t,s){"use strict";function n(e){let t;try{t=JSON.parse(e)}catch(e){}return t}s.d(t,{I:function(){return n}})},19834:function(e,t,s){"use strict";s.d(t,{z:function(){return y},Q:function(){return j}});var n=s(28803),a=s(51789),i=s(18916),l=s(80762),r=s(87033),o=s(58183),c=s(7653),d=s(51375),u=s(23098),m=s(5161),f=s(51432);async function x(e,t){let s;try{s=await t.callback(e)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}return{is_error:s.isError,content:s.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return h({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw Error("Missing MIME type for embedded resource");return h({mimeType:t.mimeType,base64Data:t.blob})}}}throw Error("Unsupported content type: ".concat(e.type))})}}function h(e){let{mimeType:t,base64Data:s}=e;if(!m.wI[t])throw Error("Unsupported image type: ".concat(t));let n=m.wI[t];return{type:"image",file_name:"".concat((0,f.H)(),".").concat(n),source:{media_type:t,type:"base64",data:s}}}var g=s(93558);async function p(e,t){let s=g.KX.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}else throw Error("Error parsing input: ".concat(s.error.message))}var v=s(67995);function j(){let{mutateAsync:e}=(0,n.fc)(),t=function(){let{executeReplCode:e}=(0,a.r)(),{mcpTools:t}=(0,d.cH)();return(0,c.useCallback)(async(s,n)=>{let a=(0,v.I)(n);if("repl"===s)return await p(a,e);{let e=null==t?void 0:t.find(e=>e.name===s);if(e)return await x(a,e)}},[e,t])}();return(0,c.useCallback)(async function(s,n,a,i){let{overriddenResult:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};l.f("Tools: Using tool ".concat(n," with input ").concat(i));try{let o=null!=r?r:await t(n,i);if(void 0===o){l.f("Tools: Unable to find tool with name ".concat(n));return}l.f("Tools: Result for tool ".concat(n,": ").concat(o)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:a,...o})}catch(i){let t=i instanceof Error?i.message:String(i);l.f("Tools: Error for tool ".concat(n,": ").concat(t)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:a,content:[{type:"text",text:t}]})}},[t,e])}let y=(e,t)=>{let s=function(){let e=(0,o.useDynamicConfig)("apps_redacted_strings_paprika"),t=(0,o.useDynamicConfig)("apps_redacted_strings_sherlock");return(0,c.useMemo)(()=>({...e.value,...t.value}),[t.value,e.value])}(),{servers:n}=(0,d.cH)(),{value:a}=(0,i.h)(null!=e?e:{}),{value:l}=(0,r.FL)("tool_use_artifacts_ga"),m=(0,u.PE)(t);return(0,c.useCallback)(()=>{let t=[];for(let s of n)for(let n of s.tools){var i,r;(null==e?void 0:null===(i=e.enabled_mcp_tools)||void 0===i?void 0:i[(0,d.q)(s.uuid,n.name)])!==!1&&t.push({name:n.name,description:null!==(r=n.description)&&void 0!==r?r:n.name,input_schema:n.inputSchema,...(null==s?void 0:s.type)==="remote"&&{mcp_server_uuid:s.uuid}})}let o=null==s?void 0:s.echo_forest_path;return o&&t.push({type:(null==s?void 0:s.dream_circuit_wave)||"",name:o}),(l||a)&&t.push({type:"artifacts_v0",name:"artifacts"}),a&&t.push({type:"repl_v0",name:"repl"}),m&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[n,null==e?void 0:e.enabled_mcp_tools,a,s,l,m])}},64452:function(e,t,s){"use strict";s.d(t,{D:function(){return i},q:function(){return a}});var n=s(7653);function a(e){let t=[];for(let n of e){var s;for(let e of null!==(s=n.files_v2)&&void 0!==s?s:n.files)"file_kind"in e&&t.push(e)}return t}let i=e=>(0,n.useMemo)(()=>a(e),[e])},60757:function(e,t,s){"use strict";s.d(t,{DY:function(){return Z},Xd:function(){return z}});var n=s(27573),a=s(53146),i=s.n(a),l=s(53392),r=s(5362),o=s(27218),c=s(70354),d=s(52939),u=s(22523),m=s(43566),f=s(28386),x=s(87033),h=s(98649),g=s(30070),p=s(18843),v=s(10607),j=s(68425),y=s(8927),b=s(7653),w=s(40950),_=s(45790),N=s(41270),C=s(51375),k=s(48894),M=s(47082),S=s(63690),E=s(34236);let z=N.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},N.z.object({task_id:N.z.string()}));function Z(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:a=!1,conversationUUID:i,toolResult:l,isShared:c,isExpanded:d=!1,isStreaming:u=!1,context:m}=e,{value:f}=(0,x.FL)("papi_mcp"),{activeOrganization:g}=(0,o.t)(),{dispatchChatResource:p}=(0,M.Y)(),{setIsDrawerExpanded:j}=(0,k.b)(),{decisionState:y,approveTool:_,denyTool:N}=function(e,t,s,n){let[a,i]=(0,b.useState)("pending"),l=!!(e&&t&&n),{isPending:o}=(0,r.WE)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:l}),c=(0,r.uC)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!o),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:a,isStatePending:o,approveTool:(0,b.useCallback)(()=>{c({tool_use_id:s,is_approved:!0})},[c,s]),denyTool:(0,b.useCallback)(()=>{c({tool_use_id:s,is_approved:!1})},[c,s])}}(null==g?void 0:g.uuid,i,t,u),C=u?"approved"===y:l&&!(null==l?void 0:l.is_error),E=f&&(null==m?void 0:m.tools.length)&&u&&"pending"===y,Z=(0,b.useMemo)(()=>{if(!(null==l?void 0:l.content))return;let e=l.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=z.safeParse(e);return null==t?void 0:t.task_id},[null==l?void 0:l.content]),{compassStatus:F,isLoading:R,error:O}=(0,S.Oz)({organizationUUID:null==g?void 0:g.uuid,conversationUUID:i,taskId:Z,isShared:c,enabled:C}),D=!F,L=(0,b.useCallback)(()=>{D||(j(!0),p({type:"OPEN_COMPASS_STATUS",data:{conversationUUID:i,organizationUUID:null==g?void 0:g.uuid,isShared:c,toolUseId:null==l?void 0:l.tool_use_id,taskId:Z}}))},[D,p,i,null==g?void 0:g.uuid,j,c,l,Z]),U=(null==F?void 0:F.status)||h.IN.Starting,P=!!O||!!(null==l?void 0:l.is_error),B=(0,w.Z)(),{title:H,subtitle:J}=(0,b.useMemo)(()=>{let e,t;if(P)return{title:B.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})};let s=(null==F?void 0:F.total_sources)||0,n=0===s?B.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):B.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:s}),a=B.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:s}),i=(0,S.MT)(F),l=i||B.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),r=i||B.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(U){case h.IN.Starting:{let t=[B.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),B.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),B.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),B.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),B.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),B.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),B.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),B.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),B.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),B.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),B.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case h.IN.Planning:e=l,t=B.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case h.IN.InitiatingAgents:e=l,t=B.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case h.IN.Searching:e=l,t=n;break;case h.IN.CreatingArtifact:e=l,t=B.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case h.IN.Completed:t=a,e=r;break;case h.IN.Cancelled:e=l,t=B.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case h.IN.TimedOut:case h.IN.Failed:e=B.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),t=a}return{title:e,subtitle:t}},[B,U,F,P]);return E?(0,n.jsx)(A,{tools:m.tools,onCancel:N,onApprove:_}):(0,n.jsx)("div",{className:(0,v.Z)("my-3",s?"mt-2":"mt-3",a?"mb-2":"mb-3"),children:R?(0,n.jsxs)("div",{className:"w-full p-4 text-text-000 font-styrene rounded-xl border border-border-300 shadow-xs",children:[(0,n.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,n.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,n.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,n.jsxs)("button",{className:(0,v.Z)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-styrene rounded-xl border shadow-xs overflow-hidden",!D&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",d?"!border-accent-secondary-200":"border-border-300"),disabled:D,onClick:L,children:[(0,n.jsx)(I,{title:H,compassStatus:F,useShimmer:U===h.IN.Starting,isError:P||U===h.IN.Failed||U===h.IN.TimedOut,isExpanded:d}),(0,n.jsx)(T,{subtitle:J,compassStatus:F,isError:U===h.IN.Cancelled,isExpanded:d})]})})}function F(e){let{className:t,text:s,useShimmer:a}=e,[l,r]=(0,b.useState)(s),[o,c]=(0,b.useState)(!1),[d,u]=(0,b.useState)("");(0,b.useEffect)(()=>{if(s!==l){u(l),r(s),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[s,l]);let f=a?m.g:b.Fragment;return(0,n.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,v.Z)("relative overflow-hidden",t)||""),children:[(0,n.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@-webkit-keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-moz-keyframes slideUpFadeOut{0%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}100%{-moz-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-o-keyframes slideUpFadeOut{0%{-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);-moz-transform:translatey(-100%);-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-webkit-keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}}@-moz-keyframes slideUpFadeIn{0%{-moz-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}}@-o-keyframes slideUpFadeIn{0%{-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-o-transform:translatey(0);transform:translatey(0);opacity:1}}@keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);-moz-transform:translatey(100%);-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}}"}),o&&(0,n.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:(0,n.jsx)(f,{className:"jsx-34e91f3cef6c43c9",children:d})}),(0,n.jsx)("div",{style:o?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:(0,n.jsx)(f,{className:"jsx-34e91f3cef6c43c9",children:l})})]})}function I(e){let{title:t,isError:s,compassStatus:a,useShimmer:i,isExpanded:l}=e,[r,o]=(0,b.useState)(!1),c=(0,S.PF)(a),d=(0,b.useRef)(c);(0,b.useEffect)(()=>{c&&!d.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),d.current=c)},[c]);let u=!l&&r;return(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,n.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[u&&!!c&&(0,n.jsx)(j.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,n.jsx)(R,{thought:c})}),(0,n.jsx)(y.M,{initial:!1,children:!(u&&c)&&(0,n.jsxs)(j.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:f.J.inOutQuart},className:(0,v.Z)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,n.jsx)(g.v,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,n.jsx)("p",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,n.jsx)(F,{text:t,useShimmer:!!i&&!s})})]})})]}),!!a&&(0,n.jsx)(p.T,{size:12,className:"text-text-500 mt-4"})]})}function T(e){var t,s;let{subtitle:a,isError:i,compassStatus:l,isExpanded:r=!1}=e,o=(null==l?void 0:l.status)===h.IN.CreatingArtifact||(null==l?void 0:l.status)===h.IN.Completed,c=(0,b.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,S.eB)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return a?(0,n.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!c.length&&(0,n.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,n.jsx)(S.AS,{hrefs:c})}),(null==l?void 0:l.status)===h.IN.Completed&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.Z,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,n.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,n.jsx)(F,{text:a,useShimmer:!r&&!o&&!i,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,n.jsx)("div",{className:"text-text-500",children:(0,n.jsx)(S.WC,{startedAt:null!==(t=null==l?void 0:l.started_at)&&void 0!==t?t:null,completedAt:null!==(s=null==l?void 0:l.finished_at)&&void 0!==s?s:null})})]})]}):null}function R(e){let{thought:t}=e;return(0,n.jsx)("div",{className:"h-9 w-full",children:(0,n.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,n.jsx)(j.E.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:f.J.inOutBase},children:(0,n.jsx)(S.xL,{thought:t})})})})}function A(e){let{tools:t,onCancel:s,onApprove:a}=e,{servers:i}=(0,C.cH)();return(0,n.jsx)(d.u_,{modalSize:"xl",isOpen:!0,onClose:s,title:(0,n.jsx)(_.Z,{defaultMessage:"Claude may use the following custom integrations while researching",id:"OKJu4YENMc"}),children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 rounded-lg my-4 relative",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4 p-4 max-h-[300px] overflow-y-auto",children:i.map(e=>{let s=t.filter(t=>t.server_uuid===e.uuid).map(e=>e.tool_name),a=e.tools.filter(e=>s.includes(e.name));return a.length?a.map(t=>(0,n.jsx)(u.X2,{className:"!py-0",children:(0,n.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,n.jsx)(l._,{letter:e.name,size:30,fontSize:11,className:"shrink-0 font-medium mt-1"}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("div",{className:"text-sm font-mono",style:{fontWeight:700},children:t.name}),(0,n.jsx)(E.D,{text:t.description,className:"text-[0.9rem] !text-text-500"})]})]})},t.name)):null})}),(0,n.jsx)("div",{className:"absolute bottom-0 left-2 right-2 h-6 bg-gradient-to-t from-bg-200 to-bg-200/0 pointer-events-none z-10"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-accent-secondary-900 rounded-lg bg-accent-secondary-900/30",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsx)(g.v,{className:"text-accent-secondary-000",size:16,weight:"bold"}),(0,n.jsx)("h4",{className:"text-accent-secondary-000 font-medium",children:(0,n.jsx)(_.Z,{defaultMessage:"You are enabling Claude to retrieve content from your connected apps.",id:"RPQTc1f34V"})})]}),(0,n.jsx)("p",{className:"text-text-300",children:(0,n.jsx)(_.Z,{defaultMessage:"Please ensure you have all appropriate permissions and trust these tools before continuing. <link>Learn more</link> about safely using Research with connected apps.",id:"b86SF7HKhH",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/11175166-about-custom-integrations-using-remote-mcp",target:"_blank",rel:"noopener noreferrer",children:e})}})})]}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(c.z,{variant:"outline",onClick:s,children:(0,n.jsx)(_.Z,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,n.jsx)(c.z,{onClick:a,children:(0,n.jsx)(_.Z,{defaultMessage:"Research with {count, plural, one {# tool} other {# tools}}",id:"H0wjvrIsuM",values:{count:t.length}})})]})]})})}},63690:function(e,t,s){"use strict";s.d(t,{AS:function(){return N},Fd:function(){return w},MT:function(){return M},Oz:function(){return k},PF:function(){return z},WC:function(){return F},eB:function(){return C},ii:function(){return S},xD:function(){return _},xL:function(){return I}});var n=s(27573),a=s(28803),i=s(53392),l=s(59821),r=s(2210),o=s(5362),c=s(32006),d=s(10228),u=s(98649),m=s(22027),f=s(13140),x=s(58183),h=s(10607),g=s(68425),p=s(43290),v=s(7653),j=s(40950),y=s(41270),b=s(91217);let w={read_gmail_profile:"Gmail",search_gmail_messages:"Gmail",read_gmail_message:"Gmail",search_gmail_threads:"Gmail",read_gmail_thread:"Gmail",list_gcal_calendars:"Google Calendar",fetch_gcal_event:"Google Calendar",list_gcal_events:"Google Calendar",google_drive_search:"Google Drive",google_drive_fetch:"Google Drive"};function _(e){let{name:t,size:s=16}=e;if("web_search"===t)return(0,n.jsx)(m.T,{size:s});if("web_fetch"===t)return(0,n.jsx)(f.a,{size:s});let a=w[t];return"Google Drive"===a||"Google Drive"===t?(0,n.jsx)("div",{className:"flex items-center justify-center",style:{width:s,height:s},children:(0,n.jsx)(c.j0,{type:d.Fg.GDRIVE,size:s-2})}):"Gmail"===a||"Gmail"===t?(0,n.jsx)("div",{className:"flex items-center justify-center",style:{width:s,height:s},children:(0,n.jsx)(c.j0,{type:d.Fg.GMAIL,size:s-2})}):"Google Calendar"===a||"Google Calendar"===t?(0,n.jsx)("div",{className:"flex items-center justify-center",style:{width:s,height:s},children:(0,n.jsx)(c.j0,{type:d.Fg.GCAL,size:s-2})}):(0,n.jsx)(i._,{letter:t,size:s})}function N(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,n.jsx)(g.E.div,{className:(0,h.Z)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,n.jsx)(l.s,{url:e,shouldFillBackground:!0,size:14})},t));return(0,n.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function C(e){let{agents:t,n:s=5}=e,n=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls)if("web_search"===e.tool_name&&e.metadata&&Array.isArray(e.metadata)){for(let t of e.metadata)if("string"==typeof t)try{let e=new URL(t);if(n.add(e.origin),n.size>=s)return Array.from(n).slice(0,s)}catch(e){}}return Array.from(n)}function k(e){var t,s;let{organizationUUID:n,conversationUUID:i,taskId:l,isShared:r,enabled:c}=e,[d,m]=(0,v.useState)(!0),f=(0,x.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),h=null!==(s=null===(t=f[0])||void 0===t?void 0:t.intervalSeconds)&&void 0!==s?s:30,[g,j]=(0,v.useState)(h),y=(0,a.cc)(i),{setCurrentCompassTask:w}=(0,b.r)(),_=r?"/api/organizations/".concat(n,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(n,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:N,isLoading:C,error:k}=(0,o.WE)(_,{refetchInterval:!!d&&1e3*g,enabled:!!(c&&i&&n&&l),meta:{noToast:!0}}),M=(null==N?void 0:N.status)!==void 0&&!(0,u.Ml)(null==N?void 0:N.status);return(0,v.useEffect)(()=>{if(c&&i&&n&&l){if(M)m(!1),w(void 0),y();else if(k){if(!(null==N?void 0:N.started_at)){m(!1);return}let e=p.ou.fromISO(N.started_at).plus({minutes:45});m(p.ou.now()<e)}else N&&!M&&w(l)}},[c,l,M,k,y,n,i,N,w]),(0,v.useEffect)(()=>{if(!(null==N?void 0:N.started_at)||!d)return;let e=setInterval(()=>{let e=function(e,t){let s=p.ou.fromISO(e),n=p.ou.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||n<e.durationSeconds)return e.intervalSeconds;return 30}(N.started_at,f);e!==g&&j(e)},1e3*g);return()=>clearInterval(e)},[null==N?void 0:N.started_at,d,f,g]),{compassStatus:N,isLoading:C,error:k,completed:M}}let M=e=>{var t;return null==e?void 0:null===(t=e.agents[0])||void 0===t?void 0:t.name};function S(e){let t=(0,j.Z)();return M(e)||(e.status!==u.IN.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let E=y.z.object({thought:y.z.string()});function z(e){let t=null==e?void 0:e.agents[0];return(0,v.useMemo)(()=>{var e,s;let n=null==t?void 0:null===(s=t.annotated_snippets[0])||void 0===s?void 0:null===(e=s.tool_calls)||void 0===e?void 0:e.find(e=>"think"===e.tool_name);if(null==n?void 0:n.tool_input)try{let e=JSON.parse(n.tool_input),{data:t}=E.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function Z(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),n=Math.floor(s/60);return n>0?"".concat(n,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function F(e){let{startedAt:t,completedAt:s}=e,[a,i]=(0,v.useState)(()=>p.ou.now());if((0,v.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(p.ou.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=p.ou.fromISO(t);if(s){let e=p.ou.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,n.jsx)(n.Fragment,{children:Z(e)})}let r=a.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,n.jsx)(n.Fragment,{children:Z(r)})}function I(e){let{thought:t,className:s}=e;return t?(0,n.jsx)("div",{className:(0,h.Z)("text-base text-text-100 font-tiempos",s),children:(0,n.jsx)(r.ux,{text:t})}):null}},37607:function(e,t,s){"use strict";s.d(t,{PageHeader:function(){return m}});var n=s(41596),a=s(27573),i=s(9788),l=s(85069),r=s(88755),o=s(10607),c=s(20355);function d(){let e=(0,n._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return d=function(){return e},e}let u=i.q.div(d());function m(e){let{children:t,className:s,contentClassName:n,sticky:i,fixed:d,mdTitle:m,large:f,narrow:x}=e,{isMobile:h,isExpanded:g}=(0,c.S)(),p=(0,r.Q)(l.t6),v=!t&&!m,j=f&&!p;return(0,a.jsxs)("header",{className:(0,o.Z)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",d&&"fixed top-0 z-header",p?l.eM:"h-12",p&&[!g&&"pl-[133px]",!v&&l.Gg],j&&["mx-auto md:h-24 md:items-end",x?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,children:[!p&&(i||d)&&(0,a.jsx)(u,{}),(0,a.jsx)("div",{className:(0,o.Z)("flex w-full items-center justify-between gap-4",p?"pt-0.5":"",p&&!g?"pl-3":"pl-11 lg:pl-8",p&&!(h&&g)&&"draggable",n,j?"px-4 md:pl-8":"pr-3"),children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:(0,o.Z)("text-text-200 flex items-center gap-2 text-center font-medium leading-tight tracking-tight max-md:hidden min-w-0",!p&&"font-copernicus",!p&&(j?"text-2xl":"text-lg")),children:(0,a.jsx)("span",{className:"truncate",children:m})}),(0,a.jsx)("div",{}),t]}):t})]})}},45571:function(e,t,s){"use strict";s.d(t,{Dy:function(){return x},Jh:function(){return m}});var n=s(41596),a=s(27573),i=s(28803),l=s(9788),r=s(70354),o=s(7653),c=s(45790);function d(){let e=(0,n._)(["\n  w-full\n  tabular-nums\n  text-left\n  text-base\n  disabled:pointer-events-none\n  disabled:shadow-none\n  disabled:drop-shadow-none"]);return d=function(){return e},e}let u=e=>{let[t,s]=(0,o.useState)([]),[n,a]=(0,o.useState)(null),{data:l}=(0,i.QR)({limit:i.bf,enabled:!!n}),[r,c]=(0,o.useState)([]),{data:d,error:u}=(0,i._C)(null!=n?n:"");return(0,o.useEffect)(()=>{if(!l)return;if(d&&d.uuid===n)t.some(e=>e.uuid===d.uuid)||s(e=>[...e,d]);else{if(!u)return;c(e=>[...e,n])}let i=l.find(e=>!t.some(t=>t.uuid===e.uuid)&&!r.includes(e.uuid));i?a(i.uuid):e(t)},[d,u,r,n,t,l,e]),{totalConversations:null==l?void 0:l.length,numExported:t.length,numFailed:r.length,startExporting:()=>{l&&l.length&&a(l[0].uuid)}}},m=(0,o.forwardRef)((e,t)=>{let[s,n]=(0,o.useState)(!1),[i,l]=(0,o.useState)(null),{totalConversations:r,numExported:d,numFailed:m,startExporting:x}=u(e=>{n(!1),l(JSON.stringify(e,null,2))});return s?(0,a.jsx)(f,{ref:t,disabled:!0,...e,children:m>0?(0,a.jsx)(c.Z,{defaultMessage:"Exporting: {numExported} / {totalConversations} ({numFailed} failed)",id:"hKNwlNeKOf",values:{numExported:d,totalConversations:r,numFailed:m}}):(0,a.jsx)(c.Z,{defaultMessage:"Exporting: {numExported} / {totalConversations}",id:"EAIBTT4RJD",values:{numExported:d,totalConversations:r}})}):i?(0,a.jsx)(f,{ref:t,...e,onClick:()=>{let e=new Blob([i],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="conversations.json",s.click()},children:(0,a.jsx)(c.Z,{defaultMessage:"Download conversations",id:"BS3OuP1PiM"})}):(0,a.jsx)(f,{ref:t,...e,onClick:()=>{n(!0),x()},children:(0,a.jsx)(c.Z,{defaultMessage:"Export conversations",id:"0GrSEx4ynQ"})})});m.displayName="ExportConversationsWidget";let f=l.q.button(d()),x=e=>{let{conversationUUID:t}=e,{data:s}=(0,i.Rq)(t);return(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="conversation.json",n.click()},children:(0,a.jsx)(c.Z,{defaultMessage:"Download conversation",id:"VBmA8/nsFU"})})}},70278:function(e,t,s){"use strict";s.d(t,{c:function(){return l}});var n=s(64617),a=s(88495),i=s(67363);function l(e){let t=e.trim();return(0,n.HA)(t,{extensions:[(0,a.x)()],htmlExtensions:[(0,i.E)()]})}},37199:function(e,t,s){"use strict";s.d(t,{i:function(){return c},s:function(){return o}});var n=s(5362),a=s(53949),i=s(7653);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let n=null!==(t=s.get(e.file_name))&&void 0!==t?t:[];n.push(e),s.set(e.file_name,n)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let n=s.filter(e=>e.file_kind===a.Y.Blob);return 0===n.length?null:n[n.length-1]}function o(){let e=function(){let e=(0,n.OJ)();return(0,i.useCallback)(async(t,s,n,a,i)=>{let l=r(t,s);if(!l&&a){let s=await e("/api/organizations/".concat(n,"/projects/").concat(a,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(n,"/projects/").concat(a,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(n,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(n,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>2147483648-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,n,a,i,r)=>a?function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let n=s[s.length-1];if(n){let e=n.extracted_content;return new TextEncoder().encode(e)}return null}(t,s)||await e(t,n,a,i,r):null,[e])}function c(e,t,s,n,a){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,n,a),[e,t,s,n,l,a])}},51789:function(e,t,s){"use strict";s.d(t,{r:function(){return i},y:function(){return a}});var n=s(7653);let a=(0,n.createContext)(null),i=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},80727:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var n=s(77879);let a={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,n.ac)(a[e])}},1679:function(){}}]);